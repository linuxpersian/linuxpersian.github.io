# بررسی تخصصی فرآیند بوتیبل‌شدن فایل‌های ISO: از سطح دیسک تا بوت‌لودر

در این مقاله تخصصی بررسی می‌کنیم که **چگونه یک فایل ISO به طور واقعی قابل بوت می‌شود**، و چه مکانیزم‌هایی در پشت‌صحنه باعث می‌شوند سیستم بتواند آن را به عنوان یک سیستم‌عامل یا نصب‌کننده راه‌اندازی کند.

---

## 🌀 فایل ISO چیست، دقیقاً؟

### تعریف:

**ISO (با پسوند `.iso`)** یک **Image از یک دیسک نوری (CD/DVD)** است که شامل:

* ساختار فایل‌سیستمی دیسک (معمولاً ISO9660، Joliet یا UDF)
* سکتورهای بوت ویژه (برای پشتیبانی از BIOS یا UEFI)

**فایل ISO فقط شامل فایل‌ها نیست؛ بلکه سکتورها، layout، و حتی boot code نیز در آن درج شده است.**

---

## 🧠 بوت‌ شدن یک فایل ISO: نگاه از سطح پایین

برای اینکه یک فایل ISO **قابل بوت باشد**، باید شامل **ساختار و داده‌هایی خاص در سکتورهای ابتدایی آن** باشد که توسط سخت‌افزار و بایوس (BIOS یا UEFI) شناخته شوند.

### 💾 مرحله 1: ساختار بوت در ISO

| بوت‌مود  | ساختار مورد نیاز در ISO                                                    |
| -------- | -------------------------------------------------------------------------- |
| **BIOS** | وجود Master Boot Record (MBR) و El Torito Boot Catalog                     |
| **UEFI** | داشتن EFI System Partition و فایل اجرایی `BOOTX64.EFI` در مسیر `EFI/BOOT/` |

---

## 🔍 El Torito Specification (استاندارد بوت ISO برای BIOS)

فایل ISO برای BIOS با کمک استاندارد **El Torito** بوتیبل می‌شود. این استاندارد توسط IBM و Phoenix در سال 1995 ارائه شد.

### ✅ چه چیزی داخل ISO اضافه می‌شود؟

* **Boot Catalog** (درون ISO): جدول اطلاعات مربوط به فایل‌های بوت
* **Boot Image**: فایلی که نقش "فایل بوت اولیه" را بازی می‌کند، معمولاً یک floppy image یا فایل شبیه آن.

### فرآیند بوت برای BIOS:

1. سیستم توسط BIOS راه‌اندازی می‌شود.
2. BIOS سکتورهای ابتدایی ISO را بررسی می‌کند (تا El Torito catalog را پیدا کند).
3. BIOS به فایل boot image اشاره‌شده در catalog می‌پرد و آن را به RAM بارگذاری می‌کند.
4. کنترل را به آن کد انتقال می‌دهد. این فایل معمولاً شامل stage اول bootloader است، مانند `ISOLINUX` یا `GRUB`.

---

## 🧬 فرآیند برای UEFI Boot

در حالت UEFI، ISO باید شامل:

* یک EFI System Partition (ESP) با فرمت FAT32
* دایرکتوری `EFI/BOOT/`
* فایل اجرایی `BOOTX64.EFI` (برای سیستم‌های 64بیتی)

### فرآیند بوت UEFI:

1. UEFI firmware حافظه flash سیستم را اجرا می‌کند.
2. دنبال پارتیشن EFI در دیسک می‌گردد.
3. به مسیر `EFI/BOOT/BOOTX64.EFI` می‌رود.
4. آن را اجرا می‌کند (فایلی که معمولاً GRUB EFI یا Systemd-boot است).

---

## ⚙️ ابزارهایی که ISO را روی USB بوتیبل می‌کنند، دقیقاً چه می‌کنند؟

ابزارهایی مانند `dd`, `Rufus`, `Etcher`, `Ventoy` یا `UNetbootin` صرفاً فایل‌ها را کپی نمی‌کنند. عملکرد آن‌ها به دو دسته تقسیم می‌شود:

### 🧱 حالت 1: `dd` یا کپی سطح پایین (block-level)

* ISO را سکتور به سکتور روی USB کپی می‌کند.
* دقیقاً همان layout و boot sector را حفظ می‌کند.
* ساختار بوت El Torito یا EFI باقی می‌ماند.
* USB تبدیل به دیسکی می‌شود که دقیقاً مثل CD بوتیبل عمل می‌کند.

### 🛠 حالت 2: ابزارهایی با هوش بیشتر (مانند Rufus)

* ISO را Mount می‌کنند.
* فایل‌ها را روی یک پارتیشن FAT32 روی USB استخراج می‌کنند.
* سپس:

  * **برای BIOS:** `syslinux` یا `GRUB` را نصب می‌کنند.
  * **برای UEFI:** یک ESP واقعی می‌سازند و `BOOTX64.EFI` را در محل مناسب قرار می‌دهند.
  * گاهی `MBR` را هم می‌نویسند (boot sector 446 bytes)

### 📌 نتیجه:

> ابزار بوتیبل‌سازی **بیشتر از صرفاً استخراج فایل‌ها عمل می‌کنند**: آن‌ها boot sector، پارتیشن‌ها، ساختار EFI، و گاهی حتی فایل‌های بوت خاص را می‌سازند یا کپی می‌کنند تا اطمینان حاصل شود که سیستم بتواند USB را به‌درستی بوت کند.

---

## 🔬 خلاصه فنی فرآیند از دید سخت‌افزار تا اجرای کرنل

```
+---------------------------+
| BIOS / UEFI Firmware      |
+---------------------------+
          |
          ↓
+---------------------------+
| شناسایی دیسک / USB        |
| بررسی Boot Sector / EFI   |
+---------------------------+
          |
          ↓
+---------------------------+
| بارگذاری Bootloader       |
| (مثلاً GRUB, ISOLINUX)    |
+---------------------------+
          |
          ↓
+---------------------------+
| Bootloader Menu           |
| انتخاب کرنل / Initrd      |
+---------------------------+
          |
          ↓
+---------------------------+
| بارگذاری Kernel           |
| اجرای Init System         |
+---------------------------+
```

---

## 🧠 نتیجه‌گیری

| سؤال                                          | پاسخ                                                                              |
| --------------------------------------------- | --------------------------------------------------------------------------------- |
| آیا فایل ISO فقط شامل فایل‌هاست؟              | خیر؛ شامل ساختار سکتوری، boot code، catalog، و گاهی پارتیشن EFI است.              |
| آیا ابزارها صرفاً فایل‌ها را استخراج می‌کنند؟ | خیر؛ آن‌ها bootloader نصب می‌کنند، سکتورها می‌نویسند، و ساختار EFI ایجاد می‌کنند. |
| چگونه BIOS یک ISO را بوت می‌کند؟              | از طریق El Torito Boot Catalog و فایل boot image                                  |
| چگونه UEFI یک ISO را بوت می‌کند؟              | با استفاده از EFI System Partition و فایل BOOTX64.EFI                             |

---
