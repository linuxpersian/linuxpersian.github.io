<!DOCTYPE html>
<html dir="rtl" lang="fa">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ویویر مارک‌دان - ویکی لینوکس فارسی</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/9.1.2/marked.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-bash.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-markup.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;600;700;800&display=swap');
        
        :root {
            /* رنگ‌های اصلی */
            --primary: #6750A4;
            --on-primary: #FFFFFF;
            --primary-container: #EADDFF;
            --on-primary-container: #21005D;
            
            /* رنگ‌های ثانویه */
            --secondary: #625B71;
            --on-secondary: #FFFFFF;
            --secondary-container: #E8DEF8;
            --on-secondary-container: #1D192B;
            
            /* رنگ‌های ترشیاری */
            --tertiary: #7D5260;
            --on-tertiary: #FFFFFF;
            --tertiary-container: #FFD8E4;
            --on-tertiary-container: #31111D;
            
            /* رنگ‌های خطا */
            --error: #B3261E;
            --on-error: #FFFFFF;
            --error-container: #F9DEDC;
            --on-error-container: #410E0B;
            
            /* رنگ‌های پس‌زمینه */
            --background: #FFFBFE;
            --on-background: #1C1B1F;
            --surface: #FFFBFE;
            --on-surface: #1C1B1F;
            --surface-variant: #E7E0EC;
            --on-surface-variant: #49454F;
            --outline: #79747E;
            --outline-variant: #CAC4D0;
            --shadow: #000000;
            --inverse-surface: #313033;
            --inverse-on-surface: #F4EFF4;
            --inverse-primary: #D0BCFF;
            --surface-tint: #6750A4;
            
            /* رنگ‌های موفقیت و هشدار */
            --success: #388E3C;
            --on-success: #FFFFFF;
            --warning: #F57C00;
            --on-warning: #FFFFFF;
            
            /* تم‌های رنگی جدید */
            --theme-blue: #1E88E5;
            --theme-green: #43A047;
            --theme-red: #E53935;
            --theme-orange: #FB8C00;
            --theme-purple: #8E24AA;
            --theme-teal: #00897B;
            --theme-amber: #FFB300;
            --theme-pink: #D81B60;
            --theme-indigo: #3949AB;
        }
        
        body.dark-mode {
            --primary: #D0BCFF;
            --on-primary: #381E72;
            --primary-container: #4F378B;
            --on-primary-container: #EADDFF;
            --secondary: #CCC2DC;
            --on-secondary: #332D41;
            --secondary-container: #4A4458;
            --on-secondary-container: #E8DEF8;
            --tertiary: #EFB8C8;
            --on-tertiary: #492532;
            --tertiary-container: #633B48;
            --on-tertiary-container: #FFD8E4;
            --error: #F2B8B5;
            --on-error: #601410;
            --error-container: #8C1D18;
            --on-error-container: #F9DEDC;
            --background: #1C1B1F;
            --on-background: #E6E1E6;
            --surface: #1C1B1F;
            --on-surface: #E6E1E6;
            --surface-variant: #49454F;
            --on-surface-variant: #CAC4D0;
            --outline: #938F99;
            --inverse-surface: #E6E1E6;
            --inverse-on-surface: #313033;
            --inverse-primary: #6750A4;
            --surface-tint: #D0BCFF;
            --success: #4CAF50;
            --on-success: #FFFFFF;
            --warning: #FF9800;
            --on-warning: #FFFFFF;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Vazirmatn', sans-serif;
            background: linear-gradient(135deg, var(--primary-container) 0%, var(--tertiary-container) 100%);
            color: var(--on-background);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            transition: all 0.3s ease;
        }
        
        /* انیمیشن‌های کلی */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideDown {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        @keyframes shimmer {
            0% { background-position: -1000px 0; }
            100% { background-position: 1000px 0; }
        }
        
        @keyframes highlight {
            0% { background-color: rgba(255, 255, 0, 0.4); }
            100% { background-color: rgba(255, 255, 0, 0); }
        }
        
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
        
        @keyframes glow {
            0% { box-shadow: 0 0 5px var(--primary); }
            50% { box-shadow: 0 0 20px var(--primary), 0 0 30px var(--primary); }
            100% { box-shadow: 0 0 5px var(--primary); }
        }
        
        /* نوار پیشرفت خواندن */
        .reading-progress {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--outline-variant);
            z-index: 1000;
        }
        
        .reading-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--tertiary));
            width: 0%;
            transition: width 0.3s ease;
        }
        
        /* کانتینر اصلی */
        .container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 2rem;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            transition: all 0.3s ease;
            width: 90%;
            max-width: 1200px;
            margin: 2rem auto;
            padding: 2rem;
            position: relative;
            overflow: hidden;
            animation: fadeIn 0.5s ease;
        }
        
        .dark-mode .container {
            background: rgba(28, 27, 31, 0.95);
        }
        
        /* هدر */
        .header {
            background: var(--surface);
            border-bottom: 1px solid var(--outline-variant);
            padding: 1.5rem;
            border-radius: 1.5rem 1.5rem 0 0;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            position: sticky;
            top: 0;
            z-index: 100;
            animation: slideDown 0.5s ease;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .header-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--on-surface);
            flex-grow: 1;
            text-align: center;
            background: linear-gradient(90deg, var(--primary), var(--tertiary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        /* نوار ابزار */
        .toolbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            animation: slideDown 0.6s ease;
        }
        
        .toolbar-section {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }
        
        /* دکمه‌ها */
        .btn {
            background: var(--secondary-container);
            color: var(--on-secondary-container);
            border: none;
            border-radius: 1rem;
            padding: 0.6rem 1rem;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            position: relative;
            overflow: hidden;
        }
        
        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        
        .btn:hover::before {
            width: 300px;
            height: 300px;
        }
        
        .btn:hover {
            background: var(--primary);
            color: var(--on-primary);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(103, 80, 164, 0.3);
        }
        
        .btn-primary {
            background: var(--primary);
            color: var(--on-primary);
            box-shadow: 0 2px 8px rgba(103, 80, 164, 0.3);
        }
        
        .btn-primary:hover {
            box-shadow: 0 4px 12px rgba(103, 80, 164, 0.4);
        }
        
        .btn-icon {
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 50%;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* جستجو */
        .search-container {
            position: relative;
            width: 100%;
            max-width: 500px;
        }
        
        .search-input {
            width: 100%;
            background: var(--surface-variant);
            color: var(--on-surface-variant);
            border: 2px solid var(--outline-variant);
            border-radius: 2rem;
            padding: 0.8rem 1rem 0.8rem 3rem;
            font-size: 1rem;
            transition: all 0.3s ease;
        }
        
        .search-input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(103, 80, 164, 0.1);
            outline: none;
        }
        
        .search-btn {
            position: absolute;
            left: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            background: var(--primary);
            color: var(--on-primary);
            border: none;
            border-radius: 50%;
            width: 2rem;
            height: 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .search-btn:hover {
            transform: translateY(-50%) scale(1.1);
            box-shadow: 0 2px 8px rgba(103, 80, 164, 0.4);
        }
        
        /* محتوای اصلی */
        .content-wrapper {
            display: flex;
            gap: 2rem;
            animation: fadeIn 0.7s ease;
        }
        
        .main-content {
            flex: 1;
            min-width: 0;
        }
        
        .sidebar {
            width: 300px;
            flex-shrink: 0;
            position: sticky;
            top: 120px;
            height: fit-content;
            max-height: calc(100vh - 140px);
            overflow-y: auto;
        }
        
        /* مارک‌دان */
        .markdown-content {
            background: var(--surface);
            border-radius: 1.5rem;
            padding: 2rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            line-height: 1.8;
            direction: rtl;
            text-align: justify;
            position: relative;
            overflow: hidden;
        }
        
        .markdown-content::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100px;
            height: 100px;
            background: linear-gradient(135deg, var(--primary), var(--tertiary));
            opacity: 0.1;
            border-radius: 0 0 0 100%;
        }
        
        .markdown-content h1 {
            color: var(--primary);
            font-size: 2.2rem;
            font-weight: 700;
            margin: 1.5rem 0 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 3px solid var(--primary);
            position: relative;
        }
        
        .markdown-content h1::after {
            content: '';
            position: absolute;
            bottom: -3px;
            right: 0;
            width: 50px;
            height: 3px;
            background: var(--tertiary);
        }
        
        .markdown-content h2 {
            color: var(--on-surface);
            font-size: 1.8rem;
            font-weight: 600;
            margin: 1.5rem 0 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--outline-variant);
        }
        
        .markdown-content h3 {
            color: var(--on-surface);
            font-size: 1.5rem;
            font-weight: 600;
            margin: 1.5rem 0 0.8rem;
        }
        
        .markdown-content p {
            margin-bottom: 1rem;
            text-align: justify;
        }
        
        .markdown-content ul, .markdown-content ol {
            margin: 1rem 0;
            padding-right: 1.5rem;
        }
        
        .markdown-content li {
            margin-bottom: 0.5rem;
            position: relative;
        }
        
        .markdown-content li::before {
            content: '•';
            color: var(--primary);
            font-weight: bold;
            position: absolute;
            right: -1rem;
        }
        
        .markdown-content blockquote {
            border-right: 4px solid var(--primary);
            margin: 1.5rem 0;
            padding: 1rem 1.5rem;
            background: var(--primary-container);
            border-radius: 0 1rem 1rem 0;
            font-style: italic;
            position: relative;
        }
        
        .markdown-content blockquote::before {
            content: '"';
            font-size: 3rem;
            color: var(--primary);
            opacity: 0.3;
            position: absolute;
            top: -10px;
            right: 10px;
        }
        
        .markdown-content code {
            background: var(--surface-variant);
            padding: 0.2rem 0.5rem;
            border-radius: 0.3rem;
            font-family: monospace;
            font-size: 0.9em;
            color: var(--primary);
        }
        
        .markdown-content pre {
            background: var(--surface-variant);
            padding: 1.5rem;
            border-radius: 1rem;
            overflow-x: auto;
            margin: 1.5rem 0;
            position: relative;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .markdown-content pre code {
            background: none;
            padding: 0;
            color: inherit;
        }
        
        .markdown-content table {
            width: 100%;
            border-collapse: collapse;
            margin: 1.5rem 0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            border-radius: 1rem;
            overflow: hidden;
        }
        
        .markdown-content th, .markdown-content td {
            border: 1px solid var(--outline-variant);
            padding: 0.8rem;
            text-align: right;
        }
        
        .markdown-content th {
            background: var(--secondary-container);
            font-weight: 600;
            color: var(--on-secondary-container);
        }
        
        .markdown-content tr:nth-child(even) {
            background: var(--surface-variant);
        }
        
        .markdown-content img {
            max-width: 100%;
            height: auto;
            border-radius: 1rem;
            margin: 1.5rem 0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .markdown-content img:hover {
            transform: scale(1.02);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        }
        
        .markdown-content a {
            color: var(--primary);
            text-decoration: none;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .markdown-content a::after {
            content: '';
            position: absolute;
            bottom: -2px;
            right: 0;
            width: 0;
            height: 2px;
            background: var(--primary);
            transition: width 0.3s ease;
        }
        
        .markdown-content a:hover {
            color: var(--primary-container);
        }
        
        .markdown-content a:hover::after {
            width: 100%;
        }
        
        /* نوار کناری */
        .sidebar-section {
            background: var(--surface);
            border-radius: 1.5rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
        }
        
        .sidebar-section:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.12);
        }
        
        .sidebar-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--on-surface);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        /* تگ‌ها */
        .tag-cloud {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }
        
        .tag {
            background: var(--secondary-container);
            color: var(--on-secondary-container);
            padding: 0.4rem 0.8rem;
            border-radius: 1rem;
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .tag::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        
        .tag:hover::before {
            width: 100px;
            height: 100px;
        }
        
        .tag:hover {
            background: var(--primary);
            color: var(--on-primary);
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 4px 8px rgba(103, 80, 164, 0.3);
        }
        
        .tag.active {
            background: var(--primary);
            color: var(--on-primary);
            animation: pulse 2s infinite;
        }
        
        /* فهرست مطالب */
        .toc {
            max-height: 400px;
            overflow-y: auto;
            padding-right: 0.5rem;
        }
        
        .toc::-webkit-scrollbar {
            width: 6px;
        }
        
        .toc::-webkit-scrollbar-track {
            background: var(--surface-variant);
            border-radius: 3px;
        }
        
        .toc::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 3px;
        }
        
        .toc-item {
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--outline-variant);
            transition: all 0.3s ease;
        }
        
        .toc-item:hover {
            padding-right: 0.5rem;
        }
        
        .toc-item:last-child {
            border-bottom: none;
        }
        
        .toc-link {
            color: var(--on-surface-variant);
            text-decoration: none;
            display: block;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .toc-link::before {
            content: '▶';
            position: absolute;
            right: -1rem;
            top: 50%;
            transform: translateY(-50%);
            font-size: 0.7rem;
            opacity: 0;
            transition: all 0.3s ease;
        }
        
        .toc-link:hover {
            color: var(--primary);
            padding-right: 0.5rem;
        }
        
        .toc-link:hover::before {
            opacity: 1;
            right: -1.5rem;
        }
        
        .toc-link.active {
            color: var(--primary);
            font-weight: 600;
            padding-right: 0.5rem;
        }
        
        .toc-link.active::before {
            opacity: 1;
            right: -1.5rem;
        }
        
        /* اطلاعات مقاله */
        .meta-info {
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
        }
        
        .meta-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--on-surface-variant);
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }
        
        .meta-item:hover {
            color: var(--primary);
            transform: translateX(-5px);
        }
        
        .meta-item i {
            color: var(--primary);
            transition: all 0.3s ease;
        }
        
        .meta-item:hover i {
            transform: scale(1.2);
        }
        
        /* دکمه‌های شناور */
        .fab {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: var(--primary);
            color: var(--on-primary);
            border: none;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            transition: all 0.3s ease;
            z-index: 100;
            animation: float 3s ease-in-out infinite;
        }
        
        .fab:hover {
            transform: scale(1.1) rotate(15deg);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
            animation: glow 2s ease-in-out infinite;
        }
        
        /* مودال‌ها */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(5px);
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s ease forwards;
        }
        
        .modal-content {
            background: var(--surface);
            padding: 2rem;
            border-radius: 2rem;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            animation: slideUp 0.3s ease forwards;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.2);
        }
        
        .close-button {
            position: absolute;
            top: 15px;
            left: 20px;
            color: var(--outline);
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .close-button:hover {
            color: var(--on-surface);
            transform: rotate(90deg);
        }
        
        /* اعلان‌ها */
        .toast-container {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 2000;
            display: flex;
            flex-direction: column;
            gap: 10px;
            pointer-events: none;
        }
        
        .toast {
            background: var(--inverse-surface);
            color: var(--inverse-on-surface);
            padding: 12px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            opacity: 0;
            transform: translateY(20px);
            animation: toast-fade-in 0.3s forwards, toast-fade-out 0.3s 2.7s forwards;
            min-width: 250px;
            text-align: center;
            font-size: 0.9rem;
            pointer-events: auto;
            position: relative;
            overflow: hidden;
        }
        
        .toast::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--primary);
        }
        
        .toast.error::before {
            background: var(--error);
        }
        
        .toast.success::before {
            background: var(--success);
        }
        
        .toast.error {
            background: var(--error);
            color: var(--on-error);
        }
        
        .toast.success {
            background: var(--success);
            color: var(--on-success);
        }
        
        @keyframes toast-fade-in {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes toast-fade-out {
            from { opacity: 1; transform: translateY(0); }
            to { opacity: 0; transform: translateY(20px); }
        }
        
        /* تم‌های رنگی */
        .theme-selector {
            display: flex;
            gap: 0.5rem;
            margin: 1rem 0;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .theme-option {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .theme-option:hover {
            transform: scale(1.1);
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
        }
        
        .theme-option.active {
            border-color: var(--on-surface);
            transform: scale(1.2);
        }
        
        .theme-option.active::after {
            content: '✓';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-weight: bold;
            text-shadow: 0 0 3px rgba(0, 0, 0, 0.5);
        }
        
        .theme-default { background: var(--primary); }
        .theme-blue { background: var(--theme-blue); }
        .theme-green { background: var(--theme-green); }
        .theme-red { background: var(--theme-red); }
        .theme-orange { background: var(--theme-orange); }
        .theme-purple { background: var(--theme-purple); }
        .theme-teal { background: var(--theme-teal); }
        .theme-amber { background: var(--theme-amber); }
        .theme-pink { background: var(--theme-pink); }
        .theme-indigo { background: var(--theme-indigo); }
        
        /* حالت‌های نمایش */
        .view-mode-controls {
            display: flex;
            gap: 0.5rem;
        }
        
        .view-mode-btn {
            background: var(--surface-variant);
            color: var(--on-surface-variant);
            border: none;
            border-radius: 0.5rem;
            padding: 0.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .view-mode-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        
        .view-mode-btn:hover::before {
            width: 100px;
            height: 100px;
        }
        
        .view-mode-btn:hover {
            background: var(--primary);
            color: var(--on-primary);
            transform: translateY(-2px);
        }
        
        .view-mode-btn.active {
            background: var(--primary);
            color: var(--on-primary);
            animation: pulse 2s infinite;
        }
        
        /* حالت خواندن */
        body.reading-mode .sidebar {
            display: none;
        }
        
        body.reading-mode .markdown-content {
            max-width: 800px;
            margin: 0 auto;
            font-size: 1.1rem;
            line-height: 2;
        }
        
        /* حالت شب */
        body.night-mode {
            --primary: #BB86FC;
            --on-primary: #000000;
            --primary-container: #EADDFF;
            --on-primary-container: #21005D;
            --background: #121212;
            --on-background: #E6E1E6;
            --surface: #1E1E1E;
            --on-surface: #E6E1E6;
            --surface-variant: #49454F;
            --on-surface-variant: #CAC4D0;
        }
        
        /* حالت تمرکز */
        body.focus-mode .header,
        body.focus-mode .toolbar,
        body.focus-mode .sidebar {
            display: none;
        }
        
        body.focus-mode .container {
            max-width: 900px;
            margin: 1rem auto;
        }
        
        /* هایلایت جستجو */
        .search-highlight {
            background: rgba(255, 255, 0, 0.4);
            padding: 0 2px;
            border-radius: 2px;
            animation: highlight 1s ease;
        }
        
        /* کپی کد */
        .copy-code-btn {
            position: absolute;
            top: 10px;
            left: 10px;
            background: var(--primary);
            color: var(--on-primary);
            border: none;
            border-radius: 0.5rem;
            padding: 0.4rem 0.8rem;
            font-size: 0.8rem;
            cursor: pointer;
            opacity: 0;
            transition: all 0.3s ease;
        }
        
        pre:hover .copy-code-btn {
            opacity: 1;
        }
        
        .copy-code-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 2px 8px rgba(103, 80, 164, 0.4);
        }
        
        /* لایت‌باکس تصاویر */
        .lightbox {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            justify-content: center;
            align-items: center;
            cursor: pointer;
            animation: fadeIn 0.3s ease;
        }
        
        .lightbox img {
            max-width: 90%;
            max-height: 90%;
            border-radius: 1rem;
            box-shadow: 0 0 30px rgba(255, 255, 255, 0.2);
            animation: slideUp 0.5s ease;
        }
        
        /* نظرات */
        .comments-section {
            margin-top: 3rem;
            animation: fadeIn 0.8s ease;
        }
        
        .comment-form {
            background: var(--surface-variant);
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 2rem;
            position: relative;
            overflow: hidden;
        }
        
        .comment-form::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100px;
            height: 100px;
            background: linear-gradient(135deg, var(--primary), var(--tertiary));
            opacity: 0.1;
            border-radius: 0 0 0 100%;
        }
        
        .comment-input {
            width: 100%;
            background: var(--surface);
            color: var(--on-surface);
            border: 2px solid var(--outline-variant);
            border-radius: 1rem;
            padding: 1rem;
            font-size: 1rem;
            resize: vertical;
            min-height: 100px;
            margin-bottom: 1rem;
            transition: all 0.3s ease;
        }
        
        .comment-input:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(103, 80, 164, 0.1);
        }
        
        .comment {
            background: var(--surface);
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .comment::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--primary), var(--tertiary));
            opacity: 0.1;
            border-radius: 0 0 0 50%;
        }
        
        .comment:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);
        }
        
        .comment-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .comment-author {
            font-weight: 600;
            color: var(--on-surface);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .comment-author::before {
            content: '👤';
            font-size: 1.2rem;
        }
        
        .comment-date {
            font-size: 0.85rem;
            color: var(--on-surface-variant);
        }
        
        .comment-text {
            color: var(--on-surface);
            line-height: 1.6;
        }
        
        /* ریسپانسیو */
        @media (max-width: 1024px) {
            .content-wrapper {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                order: 2;
                position: static;
                max-height: none;
            }
            
            .main-content {
                order: 1;
            }
        }
        
        @media (max-width: 768px) {
            .container {
                width: 95%;
                padding: 1rem;
            }
            
            .header-content {
                flex-direction: column;
                gap: 1rem;
            }
            
            .header-title {
                font-size: 1.5rem;
                text-align: center;
            }
            
            .toolbar {
                justify-content: center;
            }
            
            .search-container {
                max-width: 100%;
            }
            
            .markdown-content {
                padding: 1.5rem;
            }
            
            .markdown-content h1 {
                font-size: 1.8rem;
            }
            
            .markdown-content h2 {
                font-size: 1.5rem;
            }
            
            .fab {
                bottom: 15px;
                right: 15px;
                width: 48px;
                height: 48px;
            }
        }
        
        /* دسترسی‌پذیری */
        .skip-link {
            position: absolute;
            top: -40px;
            left: 0;
            background: var(--primary);
            color: var(--on-primary);
            padding: 8px;
            text-decoration: none;
            border-radius: 0 0 4px 0;
            z-index: 100;
            transition: top 0.3s ease;
        }
        
        .skip-link:focus {
            top: 0;
        }
        
        /* انیمیشن‌های لودینگ */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 200px;
            flex-direction: column;
            gap: 1rem;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid var(--outline-variant);
            border-top: 5px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* چاپ */
        @media print {
            body {
                background: white;
                color: black;
            }
            
            .container {
                box-shadow: none;
                margin: 0;
                padding: 0;
            }
            
            .header, .toolbar, .sidebar, .fab, .reading-progress {
                display: none;
            }
            
            .markdown-content {
                box-shadow: none;
                padding: 0;
            }
        }
        
        /* شماره خطوط کد */
        .line-numbers .line-numbers-rows {
            position: absolute;
            pointer-events: none;
            top: 1em;
            font-size: 100%;
            left: -3.8em;
            width: 3em;
            letter-spacing: -1px;
            border-right: 1px solid #999;
            user-select: none;
        }
        
        .line-numbers-rows > span:before {
            content: counter(linenumber);
            counter-increment: linenumber;
            display: block;
            text-align: right;
            color: #999;
        }
    </style>
</head>
<body>
    <!-- نوار پیشرفت خواندن -->
    <div class="reading-progress">
        <div class="reading-progress-bar" id="readingProgressBar"></div>
    </div>
    
    <!-- لینک پرش به محتوا برای دسترسی‌پذیری -->
    <a href="#content" class="skip-link">پرش به محتوا</a>
    
    <!-- کانتینر اعلان‌ها -->
    <div class="toast-container" id="toastContainer" aria-live="polite" aria-atomic="true"></div>
    
    <!-- هدر -->
    <header class="header">
        <div class="header-content">
            <a href="index.html" class="btn btn-primary">
                <i class="fas fa-home"></i>
                صفحه اصلی
            </a>
            <h1 class="header-title" id="articleTitle">در حال بارگذاری...</h1>
            <div class="toolbar-section">
                <button class="btn btn-icon" onclick="toggleDarkMode()" title="تغییر حالت تاریک">
                    <i class="fas fa-moon"></i>
                </button>
                <button class="btn btn-icon" onclick="shareArticle()" title="اشتراک‌گذاری">
                    <i class="fas fa-share-alt"></i>
                </button>
                <button class="btn btn-icon" onclick="window.print()" title="چاپ">
                    <i class="fas fa-print"></i>
                </button>
                <button class="btn btn-icon" onclick="downloadMarkdown()" title="دانلود">
                    <i class="fas fa-download"></i>
                </button>
            </div>
        </div>
    </header>
    
    <!-- نوار ابزار -->
    <div class="toolbar">
        <div class="toolbar-section">
            <!-- جستجو -->
            <div class="search-container">
                <input type="text" class="search-input" id="searchInput" placeholder="جستجو در مقاله..." aria-label="جستجو در مقاله">
                <button class="search-btn" onclick="searchInArticle()" aria-label="جستجو">
                    <i class="fas fa-search"></i>
                </button>
            </div>
        </div>
        
        <div class="toolbar-section">
            <!-- حالت‌های نمایش -->
            <div class="view-mode-controls">
                <button class="view-mode-btn active" onclick="setViewMode('normal')" title="حالت عادی">
                    <i class="fas fa-file-alt"></i>
                </button>
                <button class="view-mode-btn" onclick="setViewMode('reading')" title="حالت خواندن">
                    <i class="fas fa-book-open"></i>
                </button>
                <button class="view-mode-btn" onclick="setViewMode('night')" title="حالت شب">
                    <i class="fas fa-moon"></i>
                </button>
                <button class="view-mode-btn" onclick="setViewMode('focus')" title="حالت تمرکز">
                    <i class="fas fa-eye"></i>
                </button>
            </div>
            
            <!-- کنترل فونت -->
            <button class="btn btn-icon" onclick="decreaseFontSize()" title="کاهش اندازه فونت">
                <i class="fas fa-minus"></i>
            </button>
            <button class="btn btn-icon" onclick="increaseFontSize()" title="افزایش اندازه فونت">
                <i class="fas fa-plus"></i>
            </button>
            
            <!-- TTS -->
            <button class="btn btn-icon" onclick="toggleTTS()" title="متن به گفتار">
                <i class="fas fa-volume-up"></i>
            </button>
            
            <!-- تنظیمات -->
            <button class="btn btn-icon" onclick="openModal('settingsModal')" title="تنظیمات">
                <i class="fas fa-cog"></i>
            </button>
        </div>
    </div>
    
    <!-- محتوای اصلی -->
    <div class="container">
        <div class="content-wrapper" id="content">
            <!-- محتوای اصلی -->
            <main class="main-content">
                <div id="markdownContent" class="markdown-content">
                    <div class="loading flex flex-col items-center justify-center py-16">
                        <div class="spinner mb-4"></div>
                        <p class="text-gray-600">در حال بارگذاری مقاله...</p>
                    </div>
                </div>
                
                <!-- بخش نظرات -->
                <div class="comments-section">
                    <h2>نظرات و بازخورد</h2>
                    
                    <!-- فرم نظر -->
                    <div class="comment-form">
                        <h3>ارسال نظر</h3>
                        <textarea class="comment-input" id="commentInput" placeholder="نظر خود را اینجا بنویسید..." aria-label="متن نظر"></textarea>
                        <button class="btn btn-primary" onclick="submitComment()">
                            <i class="fas fa-paper-plane"></i>
                            ارسال نظر
                        </button>
                    </div>
                    
                    <!-- لیست نظرات -->
                    <div id="commentsList">
                        <!-- نظرات از طریق جاوا اسکریپت بارگذاری می‌شوند -->
                    </div>
                </div>
            </main>
            
            <!-- نوار کناری -->
            <aside class="sidebar">
                <!-- فهرست مطالب -->
                <div class="sidebar-section">
                    <h3 class="sidebar-title">
                        <i class="fas fa-list"></i>
                        فهرست مطالب
                    </h3>
                    <div class="toc" id="tableOfContents">
                        <!-- فهرست مطالب از طریق جاوا اسکریپت تولید می‌شود -->
                    </div>
                </div>
                
                <!-- تگ‌ها -->
                <div class="sidebar-section">
                    <h3 class="sidebar-title">
                        <i class="fas fa-tags"></i>
                        تگ‌ها
                    </h3>
                    <div class="tag-cloud" id="tagsCloud">
                        <!-- تگ‌ها از طریق جاوا اسکریپت تولید می‌شوند -->
                    </div>
                </div>
                
                <!-- اطلاعات مقاله -->
                <div class="sidebar-section">
                    <h3 class="sidebar-title">
                        <i class="fas fa-info-circle"></i>
                        اطلاعات مقاله
                    </h3>
                    <div class="meta-info">
                        <div class="meta-item">
                            <i class="fas fa-calendar"></i>
                            <span id="metaDate">در حال بارگذاری...</span>
                        </div>
                        <div class="meta-item">
                            <i class="fas fa-clock"></i>
                            <span id="metaReadingTime">در حال بارگذاری...</span>
                        </div>
                        <div class="meta-item">
                            <i class="fas fa-file-word"></i>
                            <span id="metaWordCount">در حال بارگذاری...</span>
                        </div>
                        <div class="meta-item">
                            <i class="fas fa-eye"></i>
                            <span id="metaViews">در حال بارگذاری...</span>
                        </div>
                        <div class="meta-item">
                            <i class="fas fa-star"></i>
                            <span id="metaRating">در حال بارگذاری...</span>
                        </div>
                    </div>
                </div>
                
                <!-- مقالات مرتبط -->
                <div class="sidebar-section">
                    <h3 class="sidebar-title">
                        <i class="fas fa-bookmark"></i>
                        مقالات مرتبط
                    </h3>
                    <div id="relatedArticles">
                        <!-- مقالات مرتبط از طریق جاوا اسکریپت بارگذاری می‌شوند -->
                    </div>
                </div>
            </aside>
        </div>
    </div>
    
    <!-- دکمه‌های شناور -->
    <button class="fab" onclick="scrollToTop()" title="بازگشت به بالا">
        <i class="fas fa-arrow-up"></i>
    </button>
    
    <button class="fab" style="bottom: 90px;" onclick="toggleBookmark()" title="نشان‌گذاری">
        <i class="fas fa-bookmark" id="bookmarkIcon"></i>
    </button>
    
    <!-- لایت‌باکس تصاویر -->
    <div class="lightbox" id="lightbox" onclick="closeLightbox()">
        <img src="" alt="" id="lightboxImage">
    </div>
    
    <!-- مودال تنظیمات -->
    <div id="settingsModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="settingsModalTitle">
        <div class="modal-content">
            <span class="close-button" onclick="closeModal('settingsModal')" aria-label="بستن">&times;</span>
            <h3 id="settingsModalTitle" class="text-2xl font-bold mb-4">تنظیمات</h3>
            
            <!-- تم رنگی -->
            <div class="mb-4">
                <h4 class="text-lg font-semibold mb-2">تم رنگی</h4>
                <div class="theme-selector">
                    <div class="theme-option theme-default active" onclick="setTheme('default')"></div>
                    <div class="theme-option theme-blue" onclick="setTheme('blue')"></div>
                    <div class="theme-option theme-green" onclick="setTheme('green')"></div>
                    <div class="theme-option theme-red" onclick="setTheme('red')"></div>
                    <div class="theme-option theme-orange" onclick="setTheme('orange')"></div>
                    <div class="theme-option theme-purple" onclick="setTheme('purple')"></div>
                    <div class="theme-option theme-teal" onclick="setTheme('teal')"></div>
                    <div class="theme-option theme-amber" onclick="setTheme('amber')"></div>
                    <div class="theme-option theme-pink" onclick="setTheme('pink')"></div>
                    <div class="theme-option theme-indigo" onclick="setTheme('indigo')"></div>
                </div>
            </div>
            
            <!-- تنظیمات فونت -->
            <div class="mb-4">
                <h4 class="text-lg font-semibold mb-2">تنظیمات فونت</h4>
                <div class="flex items-center gap-4">
                    <label>
                        <input type="checkbox" id="justifyText" checked> تراز متن
                    </label>
                    <label>
                        <input type="checkbox" id="lineNumbers" checked> شماره خطوط کد
                    </label>
                </div>
            </div>
            
            <!-- تنظیمات پیشرفته -->
            <div class="mb-4">
                <h4 class="text-lg font-semibold mb-2">تنظیمات پیشرفته</h4>
                <div class="flex items-center gap-4">
                    <label>
                        <input type="checkbox" id="autoSave" checked> ذخیره خودکار موقعیت
                    </label>
                    <label>
                        <input type="checkbox" id="loadImages" checked> بارگذاری تصاویر
                    </label>
                </div>
            </div>
            
            <button class="btn btn-primary w-full" onclick="saveSettings()">
                <i class="fas fa-save"></i>
                ذخیره تنظیمات
            </button>
        </div>
    </div>
    
    <script>
        // متغیرهای اصلی
        let currentFile = null;
        let currentContent = null;
        let isDarkMode = false;
        let fontSize = 16;
        let ttsEnabled = false;
        let currentViewMode = 'normal';
        let isBookmarked = false;
        let searchHighlights = [];
        let currentSearchIndex = 0;
        let allFileNames = [];
        
        // سیستم تگ‌ها
        const tagSystem = {
            // تگ‌های کامل با کلمات کلیدی
            allTags: {
                // توزیع‌ها
                'ubuntu': {
                    name: 'اوبونتو',
                    keywords: ['ubuntu', 'اوبونتو', 'ابونتو', 'ubunto']
                },
                'arch': {
                    name: 'آرچ لینوکس',
                    keywords: ['arch', 'آرچ', 'ارچ', 'arch linux']
                },
                'fedora': {
                    name: 'فدورا',
                    keywords: ['fedora', 'فدورا', 'fedora linux']
                },
                'debian': {
                    name: 'دبیان',
                    keywords: ['debian', 'دبیان', 'دبیان گنو/لینوکس']
                },
                'centos': {
                    name: 'سن‌تی‌او‌اس',
                    keywords: ['centos', 'سنتوس', 'cent os']
                },
                'opensuse': {
                    name: 'اوپن‌سوزه',
                    keywords: ['opensuse', 'اوپن سوزه', 'suse', 'سوزه']
                },
                'mint': {
                    name: 'لینوکس مینت',
                    keywords: ['mint', 'مینت', 'linux mint']
                },
                'manjaro': {
                    name: 'مانجارو',
                    keywords: ['manjaro', 'مانجارو', 'manjaro linux']
                },
                'elementary': {
                    name: 'المنتری',
                    keywords: ['elementary', 'المنتری', 'elementary os']
                },
                'zorin': {
                    name: 'زورین',
                    keywords: ['zorin', 'زورین', 'zorin os']
                },
                
                // دستورات
                'bash': {
                    name: 'بش',
                    keywords: ['bash', 'بش', 'shell', 'شل', 'terminal', 'ترمینال']
                },
                'grep': {
                    name: 'گریپ',
                    keywords: ['grep', 'گریپ', 'جستجو در متن']
                },
                'sed': {
                    name: 'سد',
                    keywords: ['sed', 'سد', 'ویرایش جریانی']
                },
                'awk': {
                    name: 'آوک',
                    keywords: ['awk', 'آوک', 'پردازش متن']
                },
                'find': {
                    name: 'فایند',
                    keywords: ['find', 'فایند', 'یافتن فایل']
                },
                'chmod': {
                    name: 'چمود',
                    keywords: ['chmod', 'چمود', 'تغییر مجوز']
                },
                'chown': {
                    name: 'چاون',
                    keywords: ['chown', 'چاون', 'تغییر مالک']
                },
                'ssh': {
                    name: 'اس‌اس‌اچ',
                    keywords: ['ssh', 'اس اس اچ', 'اتصال امن']
                },
                'scp': {
                    name: 'اس‌سی‌پی',
                    keywords: ['scp', 'اس سی پی', 'کپی امن']
                },
                'rsync': {
                    name: 'آرسینک',
                    keywords: ['rsync', 'آر سینک', 'همگام‌سازی از راه دور']
                },
                
                // سرورها
                'apache': {
                    name: 'آپاچی',
                    keywords: ['apache', 'آپاچی', 'httpd', 'وب سرور']
                },
                'nginx': {
                    name: 'انجین‌اکس',
                    keywords: ['nginx', 'انجین اکس', 'وب سرور']
                },
                'mysql': {
                    name: 'مای‌اس‌کیوال',
                    keywords: ['mysql', 'مای اس کیوال', 'دیتابیس']
                },
                'postgresql': {
                    name: 'پستگرس‌کیوال',
                    keywords: ['postgresql', 'پستگرس', 'دیتابیس']
                },
                'mongodb': {
                    name: 'مانگو‌دی‌بی',
                    keywords: ['mongodb', 'مانگو دی بی', 'دیتابیس']
                },
                'redis': {
                    name: 'ریدیس',
                    keywords: ['redis', 'ریدیس', 'حافظه نهان']
                },
                'ftp': {
                    name: 'اف‌تی‌پی',
                    keywords: ['ftp', 'اف تی پی', 'انتقال فایل']
                },
                'samba': {
                    name: 'سامبا',
                    keywords: ['samba', 'سامبا', 'اشتراک فایل']
                },
                'bind': {
                    name: 'بایند',
                    keywords: ['bind', 'بایند', 'دی‌ان‌اس']
                },
                'postfix': {
                    name: 'پستفیکس',
                    keywords: ['postfix', 'پستفیکس', 'سرور ایمیل']
                },
                
                // محیط دسکتاپ
                'gnome': {
                    name: 'گنوم',
                    keywords: ['gnome', 'گنوم', 'محیط دسکتاپ']
                },
                'kde': {
                    name: 'کدی‌ای',
                    keywords: ['kde', 'کدی ای', 'پلاسما', 'محیط دسکتاپ']
                },
                'xfce': {
                    name: 'اکس‌اف‌سی‌ای',
                    keywords: ['xfce', 'اکس اف سی ای', 'محیط دسکتاپ']
                },
                'lxde': {
                    name: 'ال‌اکس‌دی‌ای',
                    keywords: ['lxde', 'ال اکس دی ای', 'محیط دسکتاپ']
                },
                'cinnamon': {
                    name: 'سینامون',
                    keywords: ['cinnamon', 'سینامون', 'محیط دسکتاپ']
                },
                'mate': {
                    name: 'میت',
                    keywords: ['mate', 'میت', 'محیط دسکتاپ']
                },
                'budgie': {
                    name: 'باجی',
                    keywords: ['budgie', 'باجی', 'محیط دسکتاپ']
                },
                'pantheon': {
                    name: 'پانتئون',
                    keywords: ['pantheon', 'پانتئون', 'محیط دسکتاپ']
                },
                'deepin': {
                    name: 'دیپین',
                    keywords: ['deepin', 'دیپین', 'محیط دسکتاپ']
                },
                'unity': {
                    name: 'یونیتی',
                    keywords: ['unity', 'یونیتی', 'محیط دسکتاپ']
                },
                
                // امنیت
                'firewall': {
                    name: 'فایروال',
                    keywords: ['firewall', 'فایروال', 'iptables', 'ufw']
                },
                'selinux': {
                    name: 'اس‌ای‌لینوکس',
                    keywords: ['selinux', 'اس ای لینوکس', 'امنیت']
                },
                'apparmor': {
                    name: 'اپ‌آرمور',
                    keywords: ['apparmor', 'اپ آرمور', 'امنیت']
                },
                'fail2ban': {
                    name: 'فیل‌تو‌بن',
                    keywords: ['fail2ban', 'فیل تو بن', 'امنیت']
                },
                'clamav': {
                    name: 'کلماو',
                    keywords: ['clamav', 'کلماو', 'آنتی‌ویروس']
                },
                'gpg': {
                    name: 'جی‌پی‌جی',
                    keywords: ['gpg', 'جی پی جی', 'رمزنگاری']
                },
                'openssl': {
                    name: 'اوپن‌اس‌اس‌ال',
                    keywords: ['openssl', 'اوپن اس اس ال', 'رمزنگاری']
                },
                'vpn': {
                    name: 'وی‌پی‌ان',
                    keywords: ['vpn', 'وی پی ان', 'شبکه خصوصی مجازی']
                },
                'tor': {
                    name: 'تور',
                    keywords: ['tor', 'تور', 'ناشناس بودن']
                },
                'audit': {
                    name: 'ادیت',
                    keywords: ['audit', 'ادیت', 'بازرسی امنیتی']
                },
                
                // شبکه
                'networking': {
                    name: 'شبکه',
                    keywords: ['networking', 'شبکه', 'network', 'نتورک']
                },
                'netplan': {
                    name: 'نت‌پلن',
                    keywords: ['netplan', 'نت پلن', 'پیکربندی شبکه']
                },
                'networkmanager': {
                    name: 'مدیریت شبکه',
                    keywords: ['networkmanager', 'مدیریت شبکه', 'nmcli']
                },
                'dhcp': {
                    name: 'دی‌اچ‌سی‌پی',
                    keywords: ['dhcp', 'دی اچ سی پی', 'اختصاص آی‌پی']
                },
                'dns': {
                    name: 'دی‌ان‌اس',
                    keywords: ['dns', 'دی ان اس', 'سیستم نام دامنه']
                },
                'proxy': {
                    name: 'پراکسی',
                    keywords: ['proxy', 'پراکسی', 'میانجی']
                },
                'vlan': {
                    name: 'ولان',
                    keywords: ['vlan', 'ولان', 'شبکه محلی مجازی']
                },
                'bridge': {
                    name: 'بریج',
                    keywords: ['bridge', 'بریج', 'پل شبکه']
                },
                'bonding': {
                    name: 'باندینگ',
                    keywords: ['bonding', 'باندینگ', 'اتصال چند شبکه']
                },
                'wifi': {
                    name: 'وای‌فای',
                    keywords: ['wifi', 'وای فای', 'بی‌سیم']
                },
                
                // توسعه
                'git': {
                    name: 'گیت',
                    keywords: ['git', 'گیت', 'کنترل نسخه']
                },
                'github': {
                    name: 'گیت‌هاب',
                    keywords: ['github', 'گیت هاب', 'مخزن کد']
                },
                'docker': {
                    name: 'داکر',
                    keywords: ['docker', 'داکر', 'کانتینر']
                },
                'kubernetes': {
                    name: 'کوبرنتیز',
                    keywords: ['kubernetes', 'کوبرنتیز', 'کوبز', 'ارکستر کانتینر']
                },
                'vagrant': {
                    name: 'واگرنت',
                    keywords: ['vagrant', 'واگرنت', 'ماشین مجازی']
                },
                'ansible': {
                    name: 'انسیبل',
                    keywords: ['ansible', 'انسیبل', 'اتوماسیون']
                },
                'jenkins': {
                    name: 'جنکینز',
                    keywords: ['jenkins', 'جنکینز', 'یکپارچه‌سازی']
                },
                'npm': {
                    name: 'ان‌پی‌ام',
                    keywords: ['npm', 'ان پی ام', 'مدیریت پکیج']
                },
                'yarn': {
                    name: 'یارن',
                    keywords: ['yarn', 'یارن', 'مدیریت پکیج']
                },
                'composer': {
                    name: 'کامپوزر',
                    keywords: ['composer', 'کامپوزر', 'مدیریت پکیج']
                },
                'gradle': {
                    name: 'گریدل',
                    keywords: ['gradle', 'گریدل', 'ساخت خودکار']
                },
                
                // سخت‌افزار
                'drivers': {
                    name: 'درایورها',
                    keywords: ['drivers', 'درایور', 'راه‌انداز']
                },
                'gpu': {
                    name: 'جی‌پی‌یو',
                    keywords: ['gpu', 'جی پی یو', 'کارت گرافیک']
                },
                'cpu': {
                    name: 'سی‌پی‌یو',
                    keywords: ['cpu', 'سی پی یو', 'پردازنده']
                },
                'ram': {
                    name: 'رم',
                    keywords: ['ram', 'رم', 'حافظه']
                },
                'storage': {
                    name: 'ذخیره‌سازی',
                    keywords: ['storage', 'ذخیره سازی', 'هارد دیسک', 'اس‌اس‌دی']
                },
                'usb': {
                    name: 'یواس‌بی',
                    keywords: ['usb', 'یو اس بی', 'اتصال یواس‌بی']
                },
                'bluetooth': {
                    name: 'بلوتوث',
                    keywords: ['bluetooth', 'بلوتوث', 'اتصال بلوتوث']
                },
                'printer': {
                    name: 'پرینتر',
                    keywords: ['printer', 'پرینتر', 'چاپگر']
                },
                'scanner': {
                    name: 'اسکنر',
                    keywords: ['scanner', 'اسکنر', 'اسکن']
                },
                'webcam': {
                    name: 'وب‌کم',
                    keywords: ['webcam', 'وب کم', 'دوربین وب']
                },
                
                // مجازی‌سازی
                'virtualbox': {
                    name: 'ورچوال‌باکس',
                    keywords: ['virtualbox', 'ورچوال باکس', 'ماشین مجازی']
                },
                'vmware': {
                    name: 'وی‌ام‌ور',
                    keywords: ['vmware', 'وی ام ور', 'ماشین مجازی']
                },
                'kvm': {
                    name: 'کی‌وی‌ام',
                    keywords: ['kvm', 'کی وی ام', 'ماشین مجازی']
                },
                'qemu': {
                    name: 'کیوای‌ام‌یو',
                    keywords: ['qemu', 'کیو ایمو', 'شبیه‌ساز']
                },
                'xen': {
                    name: 'زن',
                    keywords: ['xen', 'زن', 'هایپروایزر']
                },
                'hyper-v': {
                    name: 'هایپر-وی',
                    keywords: ['hyper-v', 'هایپر وی', 'هایپروایزر']
                },
                'proxmox': {
                    name: 'پروکس‌موکس',
                    keywords: ['proxmox', 'پروکس موکس', 'هایپروایزر']
                },
                'lxc': {
                    name: 'ال‌اکس‌سی',
                    keywords: ['lxc', 'ال اکس سی', 'کانتینر لینوکس']
                },
                'openvz': {
                    name: 'اوپن‌وی‌زی',
                    keywords: ['openvz', 'اوپن وی زی', 'کانتینر']
                },
                'vagrant': {
                    name: 'واگرنت',
                    keywords: ['vagrant', 'واگرنت', 'محیط توسعه']
                },
                
                // ابر
                'aws': {
                    name: 'ای‌دبلیواس',
                    keywords: ['aws', 'ای دبلیو اس', 'آماzon web services']
                },
                'azure': {
                    name: 'آژور',
                    keywords: ['azure', 'آژور', 'مایکروسافت آژور']
                },
                'gcp': {
                    name: 'جی‌سی‌پی',
                    keywords: ['gcp', 'جی سی پی', 'google cloud platform']
                },
                'openstack': {
                    name: 'اوپن‌استک',
                    keywords: ['openstack', 'اوپن استک', 'ابر خصوصی']
                },
                'cloud-init': {
                    name: 'کلاد-اینیت',
                    keywords: ['cloud-init', 'کلاد اینیت', 'پیکربندی ابری']
                },
                'terraform': {
                    name: 'ترافورم',
                    keywords: ['terraform', 'ترافورم', 'زیرساخت به صورت کد']
                },
                'packer': {
                    name: 'پکر',
                    keywords: ['packer', 'پکر', 'ساخت ماشین ابری']
                },
                'consul': {
                    name: 'کانسول',
                    keywords: ['consul', 'کانسول', 'کشف سرویس']
                },
                'vault': {
                    name: 'ولت',
                    keywords: ['vault', 'ولت', 'مدیریت اسرار']
                },
                'nomad': {
                    name: 'نومد',
                    keywords: ['nomad', 'نومد', 'ارکستر']
                }
            },
            
            // استخراج تگ‌ها از محتوا
            extractTags: function(content) {
                const tags = [];
                const text = content.toLowerCase();
                
                // بررسی تمام تگ‌ها
                for (const [tagId, tagData] of Object.entries(this.allTags)) {
                    for (const keyword of tagData.keywords) {
                        if (text.includes(keyword.toLowerCase())) {
                            tags.push({
                                id: tagId,
                                name: tagData.name
                            });
                            break;
                        }
                    }
                }
                
                // حذف تگ‌های تکراری
                return tags.filter((tag, index, self) =>
                    index === self.findIndex(t => t.id === tag.id)
                );
            },
            
            // دریافت نام تگ بر اساس شناسه
            getTagName: function(tagId) {
                return this.allTags[tagId]?.name || tagId;
            }
        };
        
        // نمایش وضعیت بارگذاری
        function showLoading() {
            document.getElementById('markdownContent').innerHTML = `
                <div class="loading flex flex-col items-center justify-center py-16">
                    <div class="spinner mb-4"></div>
                    <p class="text-gray-600">در حال بارگذاری مقاله...</p>
                </div>
            `;
        }
        
        // تابع اصلی برای مقداردهی اولیه
        async function init() {
            console.log('Initializing viewer...');
            loadPreferences();
            showLoading();
            await loadAllFileNames();
            await loadFile();
            setupEventListeners();
            generateTableOfContents();
            updateViewCount();
            loadComments();
            loadRelatedArticles();
            setupReadingProgress();
        }
        
        // بارگذاری تنظیمات
        function loadPreferences() {
            isDarkMode = localStorage.getItem('isDarkMode') === 'true';
            fontSize = parseInt(localStorage.getItem('fontSize') || '16');
            currentViewMode = localStorage.getItem('viewMode') || 'normal';
            
            // اعمال تنظیمات
            if (isDarkMode) {
                document.body.classList.add('dark-mode');
            }
            
            setViewMode(currentViewMode);
            setFontSize(fontSize);
        }
        
        // بارگذاری لیست تمام فایل‌ها
        async function loadAllFileNames() {
            try {
                const GITHUB_API_BASE = 'https://api.github.com/repos/linuxpersian/linuxpersian.github.io/contents/wiki/source';
                const response = await fetch(GITHUB_API_BASE);
                
                if (!response.ok) {
                    throw new Error(`خطای HTTP در بارگذاری لیست فایل‌ها! وضعیت: ${response.status}`);
                }
                
                const files = await response.json();
                allFileNames = files
                    .filter(file => file.name.endsWith('.md'))
                    .map(file => file.name)
                    .sort(); // مرتب‌سازی الفبایی برای ناوبری بعدی/قبلی
                
                console.log('All file names loaded:', allFileNames);
            } catch (error) {
                console.error('خطا در بارگذاری لیست فایل‌ها:', error);
                showToast('خطا در بارگذاری لیست فایل‌ها برای ناوبری.', 'error');
            }
        }
        
        // بارگذاری فایل
        async function loadFile() {
            try {
                const urlParams = new URLSearchParams(window.location.search);
                let fileName = urlParams.get('file');
                
                if (!fileName) {
                    showError('نام فایل مشخص نشده است.');
                    return;
                }
                
                // اطمینان از اینکه نام فایل دارای پسوند .md است
                if (!fileName.endsWith('.md')) {
                    fileName += '.md';
                }
                
                currentFile = fileName;
                
                // استفاده از آدرس صحیح گیت‌هاب
                const GITHUB_RAW_BASE = 'https://raw.githubusercontent.com/linuxpersian/linuxpersian.github.io/main/wiki/source';
                const fileUrl = `${GITHUB_RAW_BASE}/${fileName}`;
                
                console.log('Loading file from:', fileUrl);
                
                const response = await fetch(fileUrl);
                
                if (!response.ok) {
                    if (response.status === 404) {
                        throw new Error('فایل مورد نظر یافت نشد. ممکن است حذف شده یا نام آن تغییر کرده باشد.');
                    } else {
                        throw new Error(`خطا در بارگذاری فایل: ${response.status} - ${response.statusText}`);
                    }
                }
                
                const content = await response.text();
                currentContent = content;
                
                // استخراج عنوان
                const titleMatch = content.match(/^#\s+(.+)$/m);
                const title = titleMatch ? titleMatch[1].trim() : fileName.replace('.md', '');
                
                document.getElementById('articleTitle').textContent = title;
                document.title = `${title} - ویکی لینوکس فارسی`;
                
                // پردازش و نمایش محتوا
                displayContent(content);
                
                // استخراج و نمایش تگ‌ها
                const tags = tagSystem.extractTags(content);
                displayTags(tags);
                
                // به‌روزرسانی اطلاعات متا
                updateMetadata(content);
                
                // بررسی وضعیت نشان‌گذاری
                checkBookmarkStatus();
                
                // بازیابی موقعیت خواندن
                restoreReadingPosition();
                
                showToast('مقاله با موفقیت بارگذاری شد.', 'success');
            } catch (error) {
                console.error('Error loading file:', error);
                showError(`خطا در بارگذاری مقاله: ${error.message}`);
            }
        }
        
        // نمایش محتوا
        function displayContent(content) {
            try {
                // پیکربندی marked.js
                marked.setOptions({
                    breaks: true,
                    gfm: true,
                    headerIds: true,
                    headerPrefix: 'heading-'
                });
                
                // تبدیل مارک‌دان به HTML
                let html = marked.parse(content);
                
                // پردازش HTML برای RTL و استایل‌ها
                html = processHTML(html);
                
                // نمایش محتوا
                document.getElementById('markdownContent').innerHTML = html;
                
                // هایلایت کردن کد
                Prism.highlightAll();
                
                // افزودن دکمه کپی به کدها
                addCopyButtons();
                
                // افزودن رویداد به تصاویر برای لایت‌باکس
                setupImageLightbox();
            } catch (error) {
                console.error('Error processing content:', error);
                showError('خطا در پردازش محتوای مقاله.');
            }
        }
        
        // پردازش HTML
        function processHTML(html) {
            // تنظیم جهت متن
            html = html.replace(/<p>/g, '<p dir="auto">');
            html = html.replace(/<h[1-6]>/g, '<h$1 dir="auto">');
            html = html.replace(/<li>/g, '<li dir="auto">');
            html = html.replace(/<blockquote>/g, '<blockquote dir="auto">');
            
            // استایل‌های تصاویر
            html = html.replace(/<img/g, '<img class="rounded-lg shadow-lg my-4 cursor-pointer"');
            
            // استایل‌های جداول
            html = html.replace(/<table>/g, '<table class="w-full border-collapse my-6">');
            html = html.replace(/<th>/g, '<th class="border px-4 py-2 bg-gray-100 dark:bg-gray-700">');
            html = html.replace(/<td>/g, '<td class="border px-4 py-2">');
            
            // استایل‌های کد
            html = html.replace(/<pre>/g, '<pre class="rounded-lg overflow-x-auto my-4">');
            html = html.replace(/<code>/g, '<code class="rounded">');
            
            return html;
        }
        
        // افزودن دکمه کپی به کدها
        function addCopyButtons() {
            document.querySelectorAll('pre').forEach(pre => {
                const button = document.createElement('button');
                button.className = 'copy-code-btn';
                button.textContent = 'کپی';
                button.onclick = () => copyCode(pre);
                pre.appendChild(button);
            });
        }
        
        // کپی کردن کد
        function copyCode(pre) {
            const code = pre.querySelector('code');
            const text = code.textContent;
            
            navigator.clipboard.writeText(text).then(() => {
                showToast('کد با موفقیت کپی شد.', 'success');
            }).catch(err => {
                console.error('Error copying code:', err);
                showToast('خطا در کپی کردن کد.', 'error');
            });
        }
        
        // تنظیم لایت‌باکس تصاویر
        function setupImageLightbox() {
            document.querySelectorAll('.markdown-content img').forEach(img => {
                img.addEventListener('click', () => {
                    document.getElementById('lightboxImage').src = img.src;
                    document.getElementById('lightbox').style.display = 'flex';
                });
            });
        }
        
        // بستن لایت‌باکس
        function closeLightbox() {
            document.getElementById('lightbox').style.display = 'none';
        }
        
        // تولید فهرست مطالب
        function generateTableOfContents() {
            const headings = document.querySelectorAll('.markdown-content h1, .markdown-content h2, .markdown-content h3');
            const toc = document.getElementById('tableOfContents');
            
            if (headings.length === 0) {
                toc.innerHTML = '<p class="text-gray-500">فهرست مطالبی یافت نشد.</p>';
                return;
            }
            
            toc.innerHTML = '';
            
            headings.forEach((heading, index) => {
                const level = parseInt(heading.tagName.substring(1));
                const text = heading.textContent;
                const id = heading.id || `heading-${index}`;
                
                heading.id = id;
                
                const item = document.createElement('div');
                item.className = 'toc-item';
                item.style.paddingRight = `${(level - 1) * 1}rem`;
                
                const link = document.createElement('a');
                link.href = `#${id}`;
                link.className = 'toc-link';
                link.textContent = text;
                link.onclick = (e) => {
                    e.preventDefault();
                    heading.scrollIntoView({ behavior: 'smooth' });
                    
                    // به‌روزرسانی لینک فعال
                    document.querySelectorAll('.toc-link').forEach(l => l.classList.remove('active'));
                    link.classList.add('active');
                };
                
                item.appendChild(link);
                toc.appendChild(item);
            });
        }
        
        // نمایش تگ‌ها
        function displayTags(tags) {
            const tagsContainer = document.getElementById('tagsCloud');
            
            if (tags.length === 0) {
                tagsContainer.innerHTML = '<p class="text-gray-500">تگی یافت نشد.</p>';
                return;
            }
            
            tagsContainer.innerHTML = '';
            
            tags.forEach(tag => {
                const tagElement = document.createElement('span');
                tagElement.className = 'tag';
                tagElement.textContent = tag.name;
                tagElement.onclick = () => filterByTag(tag.id);
                tagsContainer.appendChild(tagElement);
            });
        }
        
        // فیلتر بر اساس تگ
        function filterByTag(tagId) {
            showToast(`نمایش مقالات مرتبط با: ${tagSystem.getTagName(tagId)}`, 'info');
            // در اینجا می‌توان منطق فیلتر کردن را پیاده‌سازی کرد
        }
        
        // به‌روزرسانی اطلاعات متا
        function updateMetadata(content) {
            // محاسبه زمان خواندن
            const wordsPerMinute = 200;
            const wordCount = content.split(/\s+/).length;
            const readingTime = Math.ceil(wordCount / wordsPerMinute);
            
            // به‌روزرسانی نمایش
            document.getElementById('metaDate').textContent = new Date().toLocaleDateString('fa-IR');
            document.getElementById('metaReadingTime').textContent = `${readingTime} دقیقه`;
            document.getElementById('metaWordCount').textContent = `${wordCount.toLocaleString('fa-IR')} کلمه`;
            document.getElementById('metaViews').textContent = '1,234 بازدید';
            document.getElementById('metaRating').textContent = '4.7/5';
        }
        
        // بررسی وضعیت نشان‌گذاری
        function checkBookmarkStatus() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarks') || '[]');
            isBookmarked = bookmarks.includes(currentFile);
            
            const icon = document.getElementById('bookmarkIcon');
            if (isBookmarked) {
                icon.classList.add('fas');
                icon.classList.remove('far');
            } else {
                icon.classList.add('far');
                icon.classList.remove('fas');
            }
        }
        
        // تغییر وضعیت نشان‌گذاری
        function toggleBookmark() {
            const bookmarks = JSON.parse(localStorage.getItem('bookmarks') || '[]');
            
            if (isBookmarked) {
                // حذف از نشان‌ها
                const index = bookmarks.indexOf(currentFile);
                if (index > -1) {
                    bookmarks.splice(index, 1);
                }
                showToast('از نشان‌ها حذف شد.', 'info');
            } else {
                // افزودن به نشان‌ها
                bookmarks.push(currentFile);
                showToast('به نشان‌ها افزوده شد.', 'success');
            }
            
            localStorage.setItem('bookmarks', JSON.stringify(bookmarks));
            isBookmarked = !isBookmarked;
            checkBookmarkStatus();
        }
        
        // بازیابی موقعیت خواندن
        function restoreReadingPosition() {
            const position = localStorage.getItem(`readingPosition_${currentFile}`);
            if (position) {
                window.scrollTo(0, parseInt(position));
            }
        }
        
        // ذخیره موقعیت خواندن
        function saveReadingPosition() {
            if (currentFile) {
                localStorage.setItem(`readingPosition_${currentFile}`, window.scrollY);
            }
        }
        
        // جستجو در مقاله
        function searchInArticle() {
            const query = document.getElementById('searchInput').value.toLowerCase().trim();
            
            if (!query) {
                clearSearchHighlights();
                return;
            }
            
            // پاک کردن هایلایت‌های قبلی
            clearSearchHighlights();
            
            // جستجو و هایلایت
            const content = document.getElementById('markdownContent');
            const walker = document.createTreeWalker(
                content,
                NodeFilter.SHOW_TEXT,
                null,
                false
            );
            
            const regex = new RegExp(`(${query})`, 'gi');
            searchHighlights = [];
            
            while (walker.nextNode()) {
                const node = walker.currentNode;
                const text = node.textContent;
                
                if (text.toLowerCase().includes(query)) {
                    const span = document.createElement('span');
                    span.innerHTML = text.replace(regex, '<span class="search-highlight">$1</span>');
                    node.parentNode.replaceChild(span, node);
                    
                    // ذخیره موقعیت‌های هایلایت
                    const highlights = span.querySelectorAll('.search-highlight');
                    highlights.forEach(highlight => {
                        searchHighlights.push(highlight);
                    });
                }
            }
            
            // اسکرول به اولین نتیجه
            if (searchHighlights.length > 0) {
                currentSearchIndex = 0;
                searchHighlights[currentSearchIndex].scrollIntoView({ behavior: 'smooth', block: 'center' });
                showToast(`${searchHighlights.length} نتیجه یافت شد.`, 'success');
            } else {
                showToast('هیچ نتیجه‌ای یافت نشد.', 'error');
            }
        }
        
        // پاک کردن هایلایت‌های جستجو
        function clearSearchHighlights() {
            const highlights = document.querySelectorAll('.search-highlight');
            highlights.forEach(highlight => {
                const parent = highlight.parentNode;
                parent.replaceChild(document.createTextNode(highlight.textContent), highlight);
                parent.normalize();
            });
            searchHighlights = [];
        }
        
        // تنظیم رویدادها
        function setupEventListeners() {
            // رویداد اسکرول برای ذخیره موقعیت خواندن و نوار پیشرفت
            window.addEventListener('scroll', () => {
                if (document.getElementById('autoSave')?.checked) {
                    saveReadingPosition();
                }
                updateReadingProgress();
            });
            
            // رویداد کلید برای جستجو
            document.getElementById('searchInput').addEventListener('keyup', (e) => {
                if (e.key === 'Enter') {
                    searchInArticle();
                }
                if (e.key === 'Escape') {
                    clearSearchHighlights();
                    document.getElementById('searchInput').value = '';
                }
            });
            
            // رویداد تغییر اندازه فونت
            document.getElementById('justifyText')?.addEventListener('change', (e) => {
                const content = document.getElementById('markdownContent');
                if (e.target.checked) {
                    content.style.textAlign = 'justify';
                } else {
                    content.style.textAlign = 'right';
                }
            });
            
            // رویداد تغییر شماره خطوط کد
            document.getElementById('lineNumbers')?.addEventListener('change', (e) => {
                const codes = document.querySelectorAll('pre code');
                codes.forEach(code => {
                    if (e.target.checked) {
                        // افزودن شماره خطوط
                        const lines = code.textContent.split('\n');
                        const numberedLines = lines.map((line, i) => {
                            return `<span class="line-number">${i + 1}</span>${line}`;
                        }).join('\n');
                        code.innerHTML = numberedLines;
                    } else {
                        // حذف شماره خطوط
                        const lines = code.innerHTML.split('\n');
                        const cleanLines = lines.map(line => {
                            return line.replace(/<span class="line-number">\d+<\/span>/, '');
                        }).join('\n');
                        code.innerHTML = cleanLines;
                    }
                });
            });
            
            // رویدادهای کیبورد
            document.addEventListener('keydown', (e) => {
                // Ctrl/Cmd + K برای جستجو
                if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
                    e.preventDefault();
                    document.getElementById('searchInput').focus();
                }
                
                // Ctrl/Cmd + D برای حالت تاریک
                if ((e.ctrlKey || e.metaKey) && e.key === 'd') {
                    e.preventDefault();
                    toggleDarkMode();
                }
                
                // Ctrl/Cmd + P برای چاپ
                if ((e.ctrlKey || e.metaKey) && e.key === 'p') {
                    e.preventDefault();
                    window.print();
                }
                
                // Ctrl/Cmd + S برای ذخیره
                if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                    e.preventDefault();
                    downloadMarkdown();
                }
                
                // Ctrl/Cmd + B برای نشان‌گذاری
                if ((e.ctrlKey || e.metaKey) && e.key === 'b') {
                    e.preventDefault();
                    toggleBookmark();
                }
                
                // F3 برای جستجوی بعدی
                if (e.key === 'F3' && searchHighlights.length > 0) {
                    e.preventDefault();
                    navigateSearchResults(1);
                }
                
                // Shift + F3 برای جستجوی قبلی
                if (e.key === 'F3' && e.shiftKey && searchHighlights.length > 0) {
                    e.preventDefault();
                    navigateSearchResults(-1);
                }
            });
        }
        
        // ناوبری نتایج جستجو
        function navigateSearchResults(direction) {
            if (searchHighlights.length === 0) return;
            
            currentSearchIndex += direction;
            
            if (currentSearchIndex >= searchHighlights.length) {
                currentSearchIndex = 0;
            } else if (currentSearchIndex < 0) {
                currentSearchIndex = searchHighlights.length - 1;
            }
            
            searchHighlights[currentSearchIndex].scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
        
        // تغییر حالت نمایش
        function setViewMode(mode) {
            currentViewMode = mode;
            localStorage.setItem('viewMode', mode);
            
            // حذف تمام کلاس‌های حالت
            document.body.classList.remove('reading-mode', 'night-mode', 'focus-mode');
            
            // افزودن کلاس حالت جدید
            switch (mode) {
                case 'reading':
                    document.body.classList.add('reading-mode');
                    break;
                case 'night':
                    document.body.classList.add('night-mode');
                    break;
                case 'focus':
                    document.body.classList.add('focus-mode');
                    break;
            }
            
            // به‌روزرسانی دکمه‌های فعال
            document.querySelectorAll('.view-mode-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.closest('.view-mode-btn').classList.add('active');
        }
        
        // تغییر حالت تاریک
        function toggleDarkMode() {
            isDarkMode = !isDarkMode;
            localStorage.setItem('isDarkMode', isDarkMode);
            
            if (isDarkMode) {
                document.body.classList.add('dark-mode');
            } else {
                document.body.classList.remove('dark-mode');
            }
        }
        
        // تغییر اندازه فونت
        function setFontSize(size) {
            fontSize = size;
            localStorage.setItem('fontSize', size);
            document.getElementById('markdownContent').style.fontSize = `${size}px`;
        }
        
        function increaseFontSize() {
            if (fontSize < 24) {
                setFontSize(fontSize + 2);
            }
        }
        
        function decreaseFontSize() {
            if (fontSize > 12) {
                setFontSize(fontSize - 2);
            }
        }
        
        // متن به گفتار (TTS)
        function toggleTTS() {
            if (!ttsEnabled) {
                startTTS();
            } else {
                stopTTS();
            }
        }
        
        function startTTS() {
            if ('speechSynthesis' in window) {
                const content = document.getElementById('markdownContent').innerText;
                const utterance = new SpeechSynthesisUtterance(content);
                utterance.lang = 'fa-IR';
                utterance.rate = 0.9;
                
                speechSynthesis.speak(utterance);
                ttsEnabled = true;
                
                showToast('شروع خواندن متن...', 'info');
                
                utterance.onend = () => {
                    ttsEnabled = false;
                    showToast('پایان خواندن متن.', 'info');
                };
            } else {
                showToast('مرورگر شما از متن به گفتار پشتیبانی نمی‌کند.', 'error');
            }
        }
        
        function stopTTS() {
            speechSynthesis.cancel();
            ttsEnabled = false;
            showToast('توقف خواندن متن.', 'info');
        }
        
        // اشتراک‌گذاری مقاله
        function shareArticle() {
            if (navigator.share) {
                navigator.share({
                    title: document.getElementById('articleTitle').textContent,
                    text: 'مقاله جالبی از ویکی لینوکس فارسی',
                    url: window.location.href
                })
                .then(() => showToast('مقاله با موفقیت به اشتراک گذاشته شد.', 'success'))
                .catch((error) => console.log('Error sharing:', error));
            } else {
                // کپی کردن لینک به کلیپ‌بورد
                navigator.clipboard.writeText(window.location.href)
                    .then(() => showToast('لینک مقاله کپی شد.', 'success'))
                    .catch(() => showToast('خطا در کپی لینک.', 'error'));
            }
        }
        
        // دانلود مارک‌دان
        function downloadMarkdown() {
            if (!currentContent) {
                showToast('محتوایی برای دانلود وجود ندارد.', 'error');
                return;
            }
            
            const blob = new Blob([currentContent], { type: 'text/markdown' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = currentFile;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showToast('فایل با موفقیت دانلود شد.', 'success');
        }
        
        // اسکرول به بالا
        function scrollToTop() {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        }
        
        // باز کردن مودال
        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'flex';
        }
        
        // بستن مودال
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }
        
        // تنظیم تم رنگی
        function setTheme(theme) {
            // حذف کلاس فعال از تمام گزینه‌ها
            document.querySelectorAll('.theme-option').forEach(option => {
                option.classList.remove('active');
            });
            
            // افزودن کلاس فعال به گزینه انتخاب شده
            document.querySelector(`.theme-${theme}`).classList.add('active');
            
            // در اینجا می‌توان منطق تغییر تم را پیاده‌سازی کرد
            localStorage.setItem('theme', theme);
            showToast(`تم ${theme} اعمال شد.`, 'success');
        }
        
        // ذخیره تنظیمات
        function saveSettings() {
            const settings = {
                isDarkMode: isDarkMode,
                fontSize: fontSize,
                viewMode: currentViewMode,
                theme: localStorage.getItem('theme') || 'default',
                justifyText: document.getElementById('justifyText')?.checked || false,
                lineNumbers: document.getElementById('lineNumbers')?.checked || false,
                autoSave: document.getElementById('autoSave')?.checked || true,
                loadImages: document.getElementById('loadImages')?.checked || true
            };
            
            localStorage.setItem('settings', JSON.stringify(settings));
            closeModal('settingsModal');
            showToast('تنظیمات با موفقیت ذخیره شد.', 'success');
        }
        
        // نمایش اعلان
        function showToast(message, type = 'info') {
            const toastContainer = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            
            toastContainer.appendChild(toast);
            
            // حذف اعلان پس از 3 ثانیه
            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => {
                    toastContainer.removeChild(toast);
                }, 300);
            }, 3000);
        }
        
        // نمایش خطا
        function showError(message) {
            showToast(message, 'error');
            document.getElementById('markdownContent').innerHTML = `
                <div class="error-message p-8 bg-red-50 dark:bg-red-900/20 rounded-lg text-center">
                    <i class="fas fa-exclamation-triangle text-red-500 text-4xl mb-4"></i>
                    <h2 class="text-xl font-bold text-red-700 dark:text-red-300 mb-2">خطا در بارگذاری مقاله</h2>
                    <p class="text-red-600 dark:text-red-400">${message}</p>
                    <button class="mt-4 px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition" onclick="window.history.back()">
                        بازگشت
                    </button>
                </div>
            `;
        }
        
        // به‌روزرسانی تعداد بازدید
        function updateViewCount() {
            // در یک پیاده‌سازی واقعی، این اطلاعات از سرور دریافت می‌شود
            // اینجا فقط یک نمایش شبیه‌سازی شده است
            const viewsElement = document.getElementById('metaViews');
            if (viewsElement) {
                const currentViews = parseInt(viewsElement.textContent.replace(/[^\d]/g, ''));
                const newViews = currentViews + 1;
                viewsElement.textContent = `${newViews.toLocaleString('fa-IR')} بازدید`;
            }
        }
        
        // بارگذاری نظرات
        function loadComments() {
            const commentsList = document.getElementById('commentsList');
            
            // در یک پیاده‌سازی واقعی، نظرات از سرور دریافت می‌شوند
            // اینجا چند نظر نمونه نمایش داده می‌شود
            const sampleComments = [
                {
                    author: 'علی رضایی',
                    date: '۱۴۰۲/۰۵/۱۰',
                    text: 'مقاله بسیار مفیدی بود. ممنون از توضیحات کامل شما.'
                },
                {
                    author: 'سارا محمدی',
                    date: '۱۴۰۲/۰۵/۰۸',
                    text: 'من از این راهنما برای راه‌اندازی سرور خود استفاده کردم و خیلی مفید بود.'
                },
                {
                    author: 'رضا قاسمی',
                    date: '۱۴۰۲/۰۵/۰۵',
                    text: 'آیا می‌توانید نسخه پیشرفته‌تری از این مقاله منتشر کنید؟'
                }
            ];
            
            commentsList.innerHTML = '';
            
            sampleComments.forEach(comment => {
                const commentElement = document.createElement('div');
                commentElement.className = 'comment';
                commentElement.innerHTML = `
                    <div class="comment-header">
                        <div class="comment-author">${comment.author}</div>
                        <div class="comment-date">${comment.date}</div>
                    </div>
                    <div class="comment-text">${comment.text}</div>
                `;
                commentsList.appendChild(commentElement);
            });
        }
        
        // ارسال نظر
        function submitComment() {
            const commentInput = document.getElementById('commentInput');
            const commentText = commentInput.value.trim();
            
            if (!commentText) {
                showToast('لطفاً متن نظر خود را وارد کنید.', 'error');
                return;
            }
            
            // در یک پیاده‌سازی واقعی، نظر به سرور ارسال می‌شود
            // اینجا فقط یک نمایش شبیه‌سازی شده است
            const commentsList = document.getElementById('commentsList');
            const newComment = document.createElement('div');
            newComment.className = 'comment';
            newComment.innerHTML = `
                <div class="comment-header">
                    <div class="comment-author">کاربر مهمان</div>
                    <div class="comment-date">${new Date().toLocaleDateString('fa-IR')}</div>
                </div>
                <div class="comment-text">${commentText}</div>
            `;
            
            commentsList.insertBefore(newComment, commentsList.firstChild);
            commentInput.value = '';
            
            showToast('نظر شما با موفقیت ارسال شد.', 'success');
        }
        
        // بارگذاری مقالات مرتبط
        function loadRelatedArticles() {
            const relatedContainer = document.getElementById('relatedArticles');
            
            // در یک پیاده‌سازی واقعی، مقالات مرتبط از سرور دریافت می‌شوند
            // اینجا چند مقاله نمونه نمایش داده می‌شود
            const sampleArticles = [
                {
                    title: 'نصب اوبونتو ۲۲.۰۴',
                    url: 'viewer.html?file=ubuntu-install.md'
                },
                {
                    title: 'پیکربندی فایروال در لینوکس',
                    url: 'viewer.html?file=firewall-config.md'
                },
                {
                    title: 'مدیریت کاربران در لینوکس',
                    url: 'viewer.html?file=user-management.md'
                }
            ];
            
            relatedContainer.innerHTML = '';
            
            sampleArticles.forEach(article => {
                const articleElement = document.createElement('div');
                articleElement.className = 'mb-2';
                articleElement.innerHTML = `
                    <a href="${article.url}" class="text-blue-600 hover:text-blue-800 hover:underline">
                        ${article.title}
                    </a>
                `;
                relatedContainer.appendChild(articleElement);
            });
        }
        
        // تنظیم نوار پیشرفت خواندن
        function setupReadingProgress() {
            window.addEventListener('scroll', updateReadingProgress);
        }
        
        // به‌روزرسانی نوار پیشرفت خواندن
        function updateReadingProgress() {
            const scrollTop = window.pageYOffset;
            const docHeight = document.body.scrollHeight - window.innerHeight;
            const scrollPercent = (scrollTop / docHeight) * 100;
            
            document.getElementById('readingProgressBar').style.width = `${scrollPercent}%`;
        }
        
        // اجرای تابع مقداردهی اولیه پس از بارگذاری صفحه
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
