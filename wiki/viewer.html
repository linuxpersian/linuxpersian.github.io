<!DOCTYPE html>
<html dir="rtl" lang="fa">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ویویر مارک‌دان - ویکی لینوکس فارسی</title>
    <!-- Tailwind CSS CDN for modern styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Marked.js for markdown parsing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/4.3.0/marked.min.js"></script>
    <!-- Prism.js for syntax highlighting -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-bash.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-markup.min.js"></script>
    <!-- Add more Prism components as needed for various code languages -->

    <style>
        /* Custom CSS for Material 3 inspired design */
        @import url('https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;600;700&display=swap');

        :root {
            --md-sys-color-primary: #6750A4;
            --md-sys-color-on-primary: #FFFFFF;
            --md-sys-color-primary-container: #EADDFF;
            --md-sys-color-on-primary-container: #21005D;
            --md-sys-color-secondary: #625B71;
            --md-sys-color-on-secondary: #FFFFFF;
            --md-sys-color-secondary-container: #E8DEF8;
            --md-sys-color-on-secondary-container: #1D192B;
            --md-sys-color-tertiary: #7D5260;
            --md-sys-color-on-tertiary: #FFFFFF;
            --md-sys-color-tertiary-container: #FFD8E4;
            --md-sys-color-on-tertiary-container: #31111D;
            --md-sys-color-error: #B3261E;
            --md-sys-color-on-error: #FFFFFF;
            --md-sys-color-error-container: #F9DEDC;
            --md-sys-color-on-error-container: #410E0B;
            --md-sys-color-background: #FFFBFE;
            --md-sys-color-on-background: #1C1B1F;
            --md-sys-color-surface: #FFFBFE;
            --md-sys-color-on-surface: #1C1B1F;
            --md-sys-color-surface-variant: #E7E0EC;
            --md-sys-color-on-surface-variant: #49454F;
            --md-sys-color-outline: #79747E;
            --md-sys-color-shadow: #000000;
            --md-sys-color-inverse-surface: #313033;
            --md-sys-color-inverse-on-surface: #F4EFF4;
            --md-sys-color-inverse-primary: #D0BCFF;
            --md-sys-color-surface-tint: #6750A4;
            --md-sys-color-outline-variant: #CAC4D0;
            --md-sys-color-scrim: #000000;
            --md-sys-color-success: #388E3C;
            --md-sys-color-on-success: #FFFFFF;
            --md-sys-color-warning: #F57C00;
            --md-sys-color-on-warning: #FFFFFF;
        }

        body.dark-mode {
            --md-sys-color-primary: #D0BCFF;
            --md-sys-color-on-primary: #381E72;
            --md-sys-color-primary-container: #4F378B;
            --md-sys-color-on-primary-container: #EADDFF;
            --md-sys-color-secondary: #CCC2DC;
            --md-sys-color-on-secondary: #332D41;
            --md-sys-color-secondary-container: #4A4458;
            --md-sys-color-on-secondary-container: #E8DEF8;
            --md-sys-color-tertiary: #EFB8C8;
            --md-sys-color-on-tertiary: #492532;
            --md-sys-color-tertiary-container: #633B48;
            --md-sys-color-on-tertiary-container: #FFD8E4;
            --md-sys-color-error: #F2B8B5;
            --md-sys-color-on-error: #601410;
            --md-sys-color-error-container: #8C1D18;
            --md-sys-color-on-error-container: #F9DEDC;
            --md-sys-color-background: #1C1B1F;
            --md-sys-color-on-background: #E6E1E6;
            --md-sys-color-surface: #1C1B1F;
            --md-sys-color-on-surface: #E6E1E6;
            --md-sys-color-surface-variant: #49454F;
            --md-sys-color-on-surface-variant: #CAC4D0;
            --md-sys-color-outline: #938F99;
            --md-sys-color-shadow: #000000;
            --md-sys-color-inverse-surface: #E6E1E6;
            --md-sys-color-inverse-on-surface: #313033;
            --md-sys-color-inverse-primary: #6750A4;
            --md-sys-color-surface-tint: #D0BCFF;
            --md-sys-color-outline-variant: #49454F;
            --md-sys-color-scrim: #000000;
            --md-sys-color-success: #4CAF50;
            --md-sys-color-on-success: #FFFFFF;
            --md-sys-color-warning: #FF9800;
            --md-sys-color-on-warning: #FFFFFF;
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: 'Vazirmatn', sans-serif; /* Applied Vazirmatn font to the entire body */
            background: linear-gradient(135deg, var(--md-sys-color-primary-container) 0%, var(--md-sys-color-tertiary-container) 100%);
            color: var(--md-sys-color-on-background);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            padding: 0;
            margin: 0;
            overflow-x: hidden;
            position: relative;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background:
                radial-gradient(circle at 20% 80%, rgba(103, 80, 164, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(125, 82, 96, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(98, 91, 113, 0.05) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            body {
                padding: 0.5rem;
            }

            .container {
                width: 100% !important;
                max-width: 100% !important;
                margin: 0.5rem 0 !important;
                padding: 1rem !important;
                border-radius: 1rem !important;
            }

            .header h1 {
                font-size: 2.5rem !important;
            }

            .header p {
                font-size: 1rem !important;
            }

            .search-input {
                width: 100% !important;
                max-width: 100% !important;
            }

            .file-grid {
                grid-template-columns: 1fr !important;
                gap: 1rem !important;
            }

            .controls-row {
                flex-direction: column !important;
                gap: 0.75rem !important;
            }

            .view-controls, .sort-controls {
                width: 100% !important;
                justify-content: center !important;
            }
        }

        @media (max-width: 1024px) {
            .container {
                width: 95%;
                max-width: 95%;
            }

            .file-grid.grid-view {
                grid-template-columns: repeat(2, 1fr) !important;
            }
        }

        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--md-sys-color-surface-variant);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--md-sys-color-primary);
            border-radius: 10px;
            transition: background 0.3s ease;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--md-sys-color-on-primary-container);
        }

        /* Animations */
        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInScale {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.7;
            }
        }

        @keyframes shimmer {
            0% {
                background-position: -468px 0;
            }
            100% {
                background-position: 468px 0;
            }
        }

        .animate-fade-in-down {
            animation: fadeInDown 0.8s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }

        .animate-fade-in-up {
            animation: fadeInUp 0.6s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }

        .animate-fade-in-scale {
            animation: fadeInScale 0.5s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }

        /* Container */
        .container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 2rem;
            box-shadow:
                0 20px 25px -5px rgba(0, 0, 0, 0.1),
                0 10px 10px -5px rgba(0, 0, 0, 0.04),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            width: 90%;
            max-width: 1200px;
            margin: 2rem auto;
            padding: 2rem;
            position: relative;
            overflow: hidden;
        }

        .dark-mode .container {
            background: rgba(28, 27, 31, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Header */
        .header {
            text-align: center; /* Ensures content inside header is centered */
            margin-bottom: 3rem;
        }

        .header h1 {
            color: var(--md-sys-color-on-background); /* Black/dark color */
            font-size: 4.5rem; /* Larger font size */
            font-weight: 800;
            margin-bottom: 1rem;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            letter-spacing: -0.02em;
        }

        .header p {
            color: var(--md-sys-color-on-background); /* Black/dark color */
            font-size: 1.75rem; /* Larger font size */
            font-weight: 400;
            line-height: 1.6;
            opacity: 0.8;
        }

        /* Search Section */
        .search-section {
            margin-bottom: 3rem;
            text-align: center; /* Ensures the search container is centered */
        }

        .search-container {
            position: relative;
            width: 100%;
            max-width: 700px;
            margin: 0 auto 2rem; /* Ensures it's centered */
        }

        .search-input {
            width: 100%;
            background: var(--md-sys-color-surface);
            color: var(--md-sys-color-on-surface);
            border: 2px solid var(--md-sys-color-outline-variant);
            border-radius: 2rem;
            /* Adjusted padding for left-aligned buttons */
            padding: 1rem 1.5rem 1rem 4rem;
            font-size: 1.1rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .search-input:focus {
            border-color: var(--md-sys-color-primary);
            box-shadow: 0 0 0 3px rgba(103, 80, 164, 0.1), 0 4px 12px rgba(0, 0, 0, 0.15);
            outline: none;
            transform: translateY(-1px);
        }

        .search-btn, .clear-search-btn {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            border: none;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .search-btn {
            /* Changed from right to left */
            left: 0.75rem;
            width: 2.5rem;
            height: 2.5rem;
            background: var(--md-sys-color-primary);
            color: var(--md-sys-color-on-primary);
            box-shadow: 0 2px 8px rgba(103, 80, 164, 0.3);
        }

        .search-btn:hover {
            transform: translateY(-50%) scale(1.05);
            box-shadow: 0 4px 12px rgba(103, 80, 164, 0.4);
        }

        .clear-search-btn {
            /* Changed from right to left */
            left: 3.5rem;
            width: 2rem;
            height: 2rem;
            background: var(--md-sys-color-surface-variant);
            color: var(--md-sys-color-on-surface-variant);
            font-size: 1rem;
        }

        .clear-search-btn:hover {
            background: var(--md-sys-color-error);
            color: var(--md-sys-color-on-error);
            transform: translateY(-50%) scale(1.1);
        }

        /* Controls */
        .controls-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 1rem;
            /* Removed flex-wrap */
        }

        .view-controls, .sort-controls {
            display: flex;
            gap: 0.75rem;
            align-items: center;
        }

        /* Buttons */
        .m3-button {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.75rem 1.5rem;
            border-radius: 1.5rem;
            font-weight: 500;
            font-size: 0.9rem;
            line-height: 1.2;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-decoration: none;
            position: relative;
            overflow: hidden;
            user-select: none;
            border: none;
            white-space: nowrap;
            gap: 0.5rem;
        }

        .m3-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: currentColor;
            opacity: 0;
            transition: opacity 0.2s ease;
            pointer-events: none;
            border-radius: inherit;
        }

        .m3-button:hover::before {
            opacity: 0.08;
        }

        .m3-button:active {
            transform: scale(0.96);
        }

        .m3-button-filled {
            background: var(--md-sys-color-primary);
            color: var(--md-sys-color-on-primary);
            box-shadow: 0 2px 8px rgba(103, 80, 164, 0.3);
        }

        .m3-button-filled:hover {
            box-shadow: 0 4px 12px rgba(103, 80, 164, 0.4);
            transform: translateY(-1px);
        }

        .m3-button-tonal {
            background: var(--md-sys-color-secondary-container);
            color: var(--md-sys-color-on-secondary-container);
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.1);
        }

        .m3-button-tonal:hover {
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            transform: translateY(-1px);
        }

        .m3-button-outlined {
            background: transparent;
            color: var(--md-sys-color-primary);
            border: 2px solid var(--md-sys-color-outline);
        }

        .m3-button-outlined:hover {
            background: rgba(103, 80, 164, 0.05);
            border-color: var(--md-sys-color-primary);
        }

        .m3-button-text {
            background: transparent;
            color: var(--md-sys-color-primary);
            padding: 0.5rem 1rem;
        }

        .m3-button-text:hover {
            background: rgba(103, 80, 164, 0.05);
        }

        /* View Mode Buttons */
        .view-mode-btn.active {
            background: var(--md-sys-color-primary) !important;
            color: var(--md-sys-color-on-primary) !important;
            box-shadow: 0 2px 8px rgba(103, 80, 164, 0.3) !important;
        }

        /* Sort Select */
        .sort-select {
            padding: 0.75rem 3rem 0.75rem 1.5rem;
            border-radius: 1.5rem;
            font-weight: 500;
            font-size: 0.9rem;
            cursor: pointer;
            background: var(--md-sys-color-secondary-container);
            color: var(--md-sys-color-on-secondary-container);
            border: 2px solid var(--md-sys-color-outline-variant);
            appearance: none;
            background-image: url('data:image/svg+xml;charset=UTF-8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2220%22%20height%3D%2220%22%20viewBox%3D%220%200%2020%2020%22%20fill%3D%22none%22%20stroke%3D%22%2349454F%22%20stroke-width%3D%222%22%20stroke-linecap%3D%22round%22%20stroke-linejoin%3D%22round%22%3E%3Cpolyline%20points%3D%226%209%2012%2015%2018%209%22%3E%3C%2Fpolyline%3E%3C%2Fsvg%3E');
            background-repeat: no-repeat;
            background-position: left 1rem center;
            background-size: 1.2em;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.1);
        }

        .sort-select:focus {
            border-color: var(--md-sys-color-primary);
            box-shadow: 0 0 0 3px rgba(103, 80, 164, 0.1), 0 2px 8px rgba(0, 0, 0, 0.15);
            outline: none;
        }

        /* File Grid */
        .files-section {
            margin-bottom: 3rem;
        }

        .section-title {
            color: var(--md-sys-color-on-background); /* Changed color to match body text */
            font-size: 2rem; /* Smaller font size */
            font-weight: 700;
            margin-bottom: 2rem;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .file-grid {
            display: grid; /* Base display for grid */
            gap: 1.5rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .file-grid.grid-view {
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
        }

        .file-grid.list-view {
            grid-template-columns: 1fr;
        }

        .file-card {
            background: var(--md-sys-color-surface);
            border: 1px solid var(--md-sys-color-outline-variant);
            border-radius: 1.5rem;
            padding: 1.75rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            opacity: 1; /* Ensure visibility by default */
            transform: translateY(0); /* Ensure position by default */
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .file-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--md-sys-color-primary), var(--md-sys-color-tertiary));
            transform: scaleX(0);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .file-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            border-color: var(--md-sys-color-primary);
        }

        .file-card:hover::before {
            transform: scaleX(1);
        }

        .file-card.animate {
            animation: fadeInUp 0.6s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }

        .file-title {
            font-size: 1.4rem;
            font-weight: 600;
            color: var(--md-sys-color-on-surface);
            margin-bottom: 0.75rem;
            line-height: 1.3;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .file-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-bottom: 1rem;
            font-size: 0.85rem;
            color: var(--md-sys-color-on-surface-variant);
        }

        .file-meta span {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            padding: 0.25rem 0.5rem;
            background: var(--md-sys-color-surface-variant);
            border-radius: 0.75rem;
            font-weight: 500;
        }

        .file-preview {
            color: var(--md-sys-color-on-surface);
            line-height: 1.6;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
            font-size: 0.95rem;
        }

        /* List View Specific */
        .file-card.list-view {
            display: flex;
            gap: 1.5rem;
            align-items: flex-start;
            padding: 1.5rem;
        }

        .file-card.list-view .file-icon {
            flex-shrink: 0;
            width: 3.5rem;
            height: 3.5rem;
            border-radius: 1rem;
            background: var(--md-sys-color-primary-container);
            color: var(--md-sys-color-on-primary-container);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .file-card.list-view .file-content {
            flex: 1;
            min-width: 0;
        }

        .file-card.list-view .file-title {
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
        }

        .file-card.list-view .file-meta {
            margin-bottom: 0.75rem;
        }

        .file-card.list-view .file-preview {
            -webkit-line-clamp: 2;
        }

        /* Skeleton Loading */
        .skeleton-card {
            background: var(--md-sys-color-surface-variant);
            border-radius: 1.5rem;
            padding: 1.75rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            position: relative;
            overflow: hidden;
        }

        .skeleton-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -468px;
            width: 468px;
            height: 100%;
            background: linear-gradient(90deg,
                transparent 0%,
                rgba(255, 255, 255, 0.2) 50%,
                transparent 100%);
            animation: shimmer 1.2s infinite ease-in-out;
        }

        .skeleton-title, .skeleton-meta, .skeleton-preview {
            background: var(--md-sys-color-outline-variant);
            border-radius: 0.5rem;
            margin-bottom: 0.75rem;
        }

        .skeleton-title {
            height: 1.5rem;
            width: 80%;
        }

        .skeleton-meta {
            height: 1rem;
            width: 60%;
        }

        .skeleton-preview {
            height: 3rem;
            width: 100%;
        }

        /* Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 1rem;
            margin-top: 3rem;
            flex-wrap: wrap;
        }

        .page-btn:disabled {
            background: var(--md-sys-color-surface-variant) !important;
            color: var(--md-sys-color-outline) !important;
            border-color: var(--md-sys-color-outline-variant) !important;
            cursor: not-allowed !important;
            transform: none !important;
            box-shadow: none !important;
        }

        #pageJumpInput {
            width: 4rem;
            text-align: center;
            padding: 0.5rem;
            border: 2px solid var(--md-sys-color-outline);
            border-radius: 0.75rem;
            background: var(--md-sys-color-surface);
            color: var(--md-sys-color-on-surface);
            font-weight: 500;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        #pageJumpInput:focus {
            border-color: var(--md-sys-color-primary);
            box-shadow: 0 0 0 2px rgba(103, 80, 164, 0.1);
            outline: none;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(8px);
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }

        .modal-content {
            background: var(--md-sys-color-surface);
            padding: 2rem;
            border-radius: 2rem;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            animation: fadeInScale 0.3s cubic-bezier(0.4, 0, 0.2, 1) forwards;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.2);
            border: 1px solid var(--md-sys-color-outline-variant);
        }

        .close-button {
            position: absolute;
            top: 15px;
            right: 20px;
            color: var(--md-sys-color-outline);
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .close-button:hover,
        .close-button:focus {
            color: var(--md-sys-color-on-surface);
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes zoomIn {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .m3-button {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.625rem 1.5rem;
            border-radius: 1.25rem;
            font-weight: 500;
            font-size: 0.875rem;
            line-height: 1.25rem;
            cursor: pointer;
            transition: background-color 0.2s ease, color 0.2s ease, box-shadow 0.2s ease, transform 0.2s ease;
            text-decoration: none;
            position: relative;
            overflow: hidden;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            border: none;
        }

        .m3-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: currentColor;
            opacity: 0;
            transition: opacity 0.2s ease;
            pointer-events: none;
        }

        .m3-button:hover::before {
            opacity: 0.08;
        }

        .m3-button:active::before {
            opacity: 0.12;
        }

        .m3-button-filled {
            background-color: var(--md-sys-color-primary);
            color: var(--md-sys-color-on-primary);
            box-shadow: 0px 1px 3px rgba(0, 0, 0, 0.1), 0px 1px 2px rgba(0, 0, 0, 0.06);
        }

        .m3-button-filled:hover {
            box-shadow: 0px 2px 6px rgba(0, 0, 0, 0.15), 0px 1px 2px rgba(0, 0, 0, 0.08);
        }

        .m3-button-filled:active {
            box-shadow: 0px 1px 3px rgba(0, 0, 0, 0.1), 0px 1px 2px rgba(0, 0, 0, 0.06);
            transform: scale(0.98);
        }

        .m3-button-tonal {
            background-color: var(--md-sys-color-secondary-container);
            color: var(--md-sys-color-on-secondary-container);
            box-shadow: 0px 1px 3px rgba(0, 0, 0, 0.1), 0px 1px 2px rgba(0, 0, 0, 0.06);
        }

        .m3-button-tonal:hover {
            box-shadow: 0px 2px 6px rgba(0, 0, 0, 0.15), 0px 1px 2px rgba(0, 0, 0, 0.08);
        }

        .m3-button-tonal:active {
            box-shadow: 0px 1px 3px rgba(0, 0, 0, 0.1), 0px 1px 2px rgba(0, 0, 0, 0.06);
            transform: scale(0.98);
        }

        .m3-button-outlined {
            background-color: transparent;
            color: var(--md-sys-color-primary);
            border: 1px solid var(--md-sys-color-outline);
            box-shadow: none;
        }

        .m3-button-outlined:hover {
            background-color: rgba(var(--md-sys-color-primary-rgb), 0.08);
            box-shadow: none;
        }

        .m3-button-outlined:active {
            background-color: rgba(var(--md-sys-color-primary-rgb), 0.12);
            transform: scale(0.98);
        }

        .m3-button-text {
            background-color: transparent;
            color: var(--md-sys-color-primary);
            box-shadow: none;
            padding: 0.625rem 0.75rem;
            border-radius: 0.5rem;
        }

        .m3-button-text:hover {
            background-color: rgba(var(--md-sys-color-primary-rgb), 0.08);
            box-shadow: none;
        }

        .m3-button-text:active {
            background-color: rgba(var(--md-sys-color-primary-rgb), 0.12);
            transform: scale(0.98);
        }

        .m3-fab {
            background-color: var(--md-sys-color-primary-container);
            color: var(--md-sys-color-on-primary-container);
            border-radius: 1rem;
            width: 48px;
            height: 48px;
            padding: 0;
            box-shadow: 0px 3px 6px rgba(0, 0, 0, 0.2), 0px 2px 4px rgba(0, 0, 0, 0.12);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .m3-fab:hover {
            box-shadow: 0px 6px 10px rgba(0, 0, 0, 0.2), 0px 3px 6px rgba(0, 0, 0, 0.15);
        }

        .m3-fab:active {
            box-shadow: 0px 3px 6px rgba(0, 0, 0, 0.2), 0px 2px 4px rgba(0, 0, 0, 0.12);
            transform: scale(0.98);
        }

        .container {
            background-color: var(--md-sys-color-surface);
            color: var(--md-sys-color-on-surface);
            border-radius: 1.5rem;
            box-shadow: 0px 5px 10px rgba(0, 0, 0, 0.2);
            transition: background-color 0.3s ease, color 0.3s ease, box-shadow 0.3s ease;
            width: 900px;
            max-width: 900px;
        }

        .header h1 {
            color: var(--md-sys-color-on-background); /* Updated color to black/dark */
            text-shadow: none;
            font-size: 4.5rem; /* Larger font size for main title */
        }

        .header p {
            color: var(--md-sys-color-on-background); /* Updated color to black/dark */
            font-size: 1.75rem; /* Larger font size for description */
        }

        .search-input {
            background-color: var(--md-sys-color-surface-variant);
            color: var(--md-sys-color-on-surface-variant);
            border: 1px solid var(--md-sys-color-outline);
            border-radius: 1.75rem;
            /* Adjusted padding for left-aligned buttons */
            padding-left: 3.5rem;
            padding-right: 1.5rem;
            width: 600px; /* Wider search input */
            max-width: 600px;
        }

        .search-input:focus {
            border-color: var(--md-sys-color-primary);
            box-shadow: 0 0 0 2px rgba(var(--md-sys-color-primary-rgb), 0.2);
            background-color: var(--md-sys-color-surface);
        }

        .search-btn, .clear-search-btn {
            border-radius: 1.25rem;
            box-shadow: none;
            transition: all 0.2s cubic-bezier(0.2, 0.0, 0, 1.0);
        }

        .search-btn {
            background-color: var(--md-sys-color-primary);
            color: var(--md-sys-color-on-primary);
            padding: 0.75rem;
            font-size: 14px;
        }
        .search-btn:hover {
            background-color: var(--md-sys-color-primary);
            opacity: 0.9;
        }
        .search-btn:active {
            transform: scale(0.95);
        }

        .clear-search-btn {
            background-color: var(--md-sys-color-surface-variant);
            color: var(--md-sys-color-on-surface-variant);
            padding: 0.5rem;
            font-size: 0.75rem;
        }
        .clear-search-btn:hover {
            background-color: var(--md-sys-color-outline-variant);
        }
        .clear-search-btn:active {
            transform: scale(0.95);
        }

        .view-mode-btn {
            @apply m3-button m3-button-tonal;
        }

        .view-mode-btn.active {
            @apply m3-button-filled;
        }

        .sort-select {
            padding: 0.625rem 1.5rem;
            border-radius: 1.25rem;
            font-weight: 500;
            font-size: 0.875rem;
            line-height: 1.25rem;
            cursor: pointer;
            background-color: var(--md-sys-color-secondary-container);
            color: var(--md-sys-color-on-secondary-container);
            border: 1px solid var(--md-sys-color-outline);
            appearance: none; /* Remove default select arrow */
            background-image: url('data:image/svg+xml;charset=UTF-8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2220%22%20height%3D%2220%22%20viewBox%3D%220%200%2020%2020%22%20fill%3D%22none%22%20stroke%3D%22%2349454F%22%20stroke-width%3D%222%22%20stroke-linecap%3D%22round%22%20stroke-linejoin%3D%22round%22%3E%3Cpolyline%20points%3D%226%209%2012%2015%2018%209%22%3E%3C%2Fpolyline%3E%3C%2Fsvg%3E');
            background-repeat: no-repeat;
            background-position: left 1rem center;
            background-size: 1em;
            padding-left: 2.5rem; /* Space for custom arrow */
        }

        .sort-select:focus {
            border-color: var(--md-sys-color-primary);
            box-shadow: 0 0 0 2px rgba(var(--md-sys-color-primary-rgb), 0.2);
            outline: none;
        }

        #sortDropdownContent {
            background-color: var(--md-sys-color-surface);
            border: 1px solid var(--md-sys-color-outline-variant);
            border-radius: 0.75rem;
            box-shadow: 0px 2px 5px rgba(0, 0, 0, 0.1);
            padding: 8px 0;
        }

        #sortDropdownContent a {
            color: var(--md-sys-color-on-surface);
            display: block;
            padding: 8px 16px;
            transition: background-color 0.1s ease;
            text-decoration: none;
        }

        #sortDropdownContent a:hover {
            background-color: var(--md-sys-color-surface-variant);
        }

        .section-title {
            color: var(--md-sys-color-on-background); /* Updated color to black/dark */
        }

        #fileCount {
            color: var(--md-sys-color-on-background); /* Updated color to black/dark */
            font-size: 1.25rem; /* Smaller font size */
        }

        .pagination .page-btn {
            @apply m3-button m3-button-outlined;
        }

        .pagination .page-btn:disabled {
            background-color: var(--md-sys-color-surface-variant);
            color: var(--md-sys-color-outline);
            border-color: var(--md-sys-color-outline-variant);
            cursor: not-allowed;
            box-shadow: none;
            transform: none;
            opacity: 1;
        }

        #pageInfo {
            color: var(--md-sys-color-on-surface);
        }

        footer {
            color: var(--md-sys-color-on-surface-variant);
        }

        footer button, footer a {
            @apply m3-button m3-button-text;
            color: var(--md-sys-color-primary);
        }

        #scrollToTopBtn {
            @apply m3-fab;
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 99;
            background-color: var(--md-sys-color-primary);
            color: var(--md-sys-color-on-primary);
            box-shadow: 0px 6px 10px rgba(0, 0, 0, 0.2), 0px 3px 6px rgba(0, 0, 0, 0.15);
            font-size: 1.5rem; /* Larger emoji size for FAB */
        }

        #scrollToTopBtn:hover {
            box-shadow: 0px 8px 12px rgba(0, 0, 0, 0.25), 0px 4px 8px rgba(0, 0, 0, 0.18);
        }

        .primary-rgb { --md-sys-color-primary-rgb: 103, 80, 164; }
        .on-primary-rgb { --md-sys-color-on-primary-rgb: 255, 255, 255; }
        .secondary-rgb { --md-sys-color-secondary-rgb: 98, 91, 113; }
        .on-secondary-rgb { --md-sys-color-on-secondary-rgb: 255, 255, 255; }
        .secondary-container-rgb { --md-sys-color-secondary-container-rgb: 232, 222, 248; }
        .on-secondary-container-rgb { --md-sys-color-on-secondary-container-rgb: 29, 25, 43; }
        .outline-rgb { --md-sys-color-outline-rgb: 121, 116, 126; }
        .outline-variant-rgb { --md-sys-color-outline-variant-rgb: 202, 196, 208; }
        .surface-variant-rgb { --md-sys-color-surface-variant-rgb: 231, 224, 236; }
        .on-surface-variant-rgb { --md-sys-color-on-surface-variant-rgb: 73, 69, 79; }
        .surface-rgb { --md-sys-color-surface-rgb: 255, 251, 254; }
        .on-surface-rgb { --md-sys-color-on-surface-rgb: 28, 27, 31; }

        .toast-container {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 2000;
            display: flex;
            flex-direction: column;
            gap: 10px;
            pointer-events: none;
        }

        .toast {
            background-color: var(--md-sys-color-inverse-surface);
            color: var(--md-sys-color-inverse-on-surface);
            padding: 12px 20px;
            border-radius: 8px;
            box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2);
            opacity: 0;
            transform: translateY(20px);
            animation: toast-fade-in 0.3s forwards, toast-fade-out 0.3s 2.7s forwards;
            min-width: 250px;
            text-align: center;
            font-size: 0.9rem;
            pointer-events: auto;
        }

        .toast.error {
            background-color: var(--md-sys-color-error);
            color: var(--md-sys-color-on-error);
        }

        @keyframes toast-fade-in {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes toast-fade-out {
            from { opacity: 1; transform: translateY(0); }
            to { opacity: 0; transform: translateY(20px); }
        }

        .settings-modal-content .input-group {
            margin-bottom: 15px;
        }

        .settings-modal-content label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: var(--md-sys-color-on-surface-variant);
        }

        .settings-modal-content input[type="number"],
        .settings-modal-content select {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--md-sys-color-outline);
            border-radius: 8px;
            background-color: var(--md-sys-color-surface-variant);
            color: var(--md-sys-color-on-surface-variant);
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }

        .settings-modal-content input[type="number"]:focus,
        .settings-modal-content select:focus {
            border-color: var(--md-sys-color-primary);
            box-shadow: 0 0 0 2px rgba(var(--md-sys-color-primary-rgb), 0.2);
            outline: none;
        }

        .sort-dialog-content .radio-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 20px;
        }

        .sort-dialog-content .radio-item {
            display: flex;
            align-items: center;
            padding: 10px;
            border-radius: 8px;
            background-color: var(--md-sys-color-surface-variant);
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .sort-dialog-content .radio-item:hover {
            background-color: var(--md-sys-color-outline-variant);
        }

        .sort-dialog-content input[type="radio"] {
            margin-left: 10px;
            transform: scale(1.2);
            accent-color: var(--md-sys-color-primary);
        }

        .sort-dialog-content label {
            font-weight: 500;
            color: var(--md-sys-color-on-surface-variant);
            cursor: pointer;
        }

        /* Viewer specific styles */
        .header-viewer {
            background-color: var(--md-sys-color-surface);
            border-bottom: 1px solid var(--md-sys-color-outline-variant);
            padding: 15px 20px;
            box-shadow: 0px 1px 3px rgba(0, 0, 0, 0.1), 0px 1px 2px rgba(0, 0, 0, 0.06); /* M3 elevation 1 */
            position: sticky;
            top: 0;
            z-index: 100;
            transition: background-color 0.3s ease, box-shadow 0.3s ease;
            width: 100%; /* Ensure header spans full width */
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap; /* Allow wrapping on smaller screens */
        }

        .header-viewer .nav-section,
        .header-viewer .controls-section {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .header-viewer .file-title {
            font-size: 1.8rem; /* Larger title for the article */
            font-weight: 700;
            color: var(--md-sys-color-on-surface);
            flex-grow: 1; /* Allow title to take up space */
            text-align: center; /* Center title */
        }

        .header-viewer .control-btn {
            padding: 0.75rem 1rem; /* Adjust padding for controls */
            border-radius: 0.75rem; /* Slightly less rounded for controls */
        }

        .markdown-content h1, .markdown-content h2, .markdown-content h3, .markdown-content h4, .markdown-content h5, .markdown-content h6 {
            color: var(--md-sys-color-on-surface);
            margin-top: 2.5rem; /* 40px */
            margin-bottom: 1.5rem; /* 24px */
            font-weight: 700;
            line-height: 1.2;
            transition: color 0.3s ease;
        }

        .markdown-content h1 {
            color: var(--md-sys-color-primary);
            border-bottom: 3px solid var(--md-sys-color-primary);
            padding-bottom: 0.625rem; /* 10px */
            font-size: 2.5em; /* 40px */
        }

        .markdown-content h2 {
            border-bottom: 2px solid var(--md-sys-color-outline-variant);
            padding-bottom: 0.5rem; /* 8px */
            font-size: 2em; /* 32px */
        }

        .markdown-content h3 {
            font-size: 1.6em; /* 25.6px */
        }

        .markdown-content p {
            margin-bottom: 1rem; /* 16px */
            text-align: justify; /* Justify text for better readability in Persian */
        }

        .markdown-content ul, .markdown-content ol {
            margin: 1rem 0;
            padding-right: 1.5rem; /* 24px for list indentation */
        }

        .markdown-content li {
            margin-bottom: 0.5rem; /* 8px */
        }

        .markdown-content blockquote {
            border-right: 4px solid var(--md-sys-color-primary); /* Primary color for quote border */
            margin: 1.5rem 0;
            padding: 1rem 1.25rem; /* 16px 20px */
            background-color: var(--md-sys-color-surface-variant);
            border-radius: 0.75rem; /* More rounded for M3 */
            font-style: italic;
            color: var(--md-sys-color-on-surface-variant);
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }

        .markdown-content code {
            background-color: var(--md-sys-color-surface-variant);
            padding: 0.125rem 0.375rem; /* 2px 6px */
            border-radius: 0.25rem; /* 4px */
            font-family: 'Fira Code', 'Courier New', monospace; /* Use a monospaced font for code */
            font-size: 0.9em;
            transition: background-color 0.3s ease;
            color: var(--md-sys-color-on-surface-variant);
        }

        .markdown-content pre {
            background-color: var(--md-sys-color-surface-variant);
            padding: 1.25rem; /* 20px */
            border-radius: 0.75rem; /* More rounded for M3 */
            overflow-x: auto; /* Enable horizontal scrolling for long code lines */
            margin: 1.5rem 0;
            border: 1px solid var(--md-sys-color-outline-variant);
            position: relative; /* For copy button positioning */
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }

        .markdown-content pre code {
            background: none; /* Remove background as it's handled by pre */
            padding: 0;
            font-size: 0.9em;
            line-height: 1.5;
            direction: ltr; /* Ensure code blocks are LTR (left-to-right) */
            text-align: left;
        }

        .markdown-content table {
            width: 100%;
            border-collapse: collapse;
            margin: 1.5rem 0;
            box-shadow: 0px 1px 3px rgba(0, 0, 0, 0.1), 0px 1px 2px rgba(0, 0, 0, 0.06); /* M3 elevation 1 */
            border-radius: 0.75rem; /* More rounded */
            overflow: hidden; /* Ensures rounded corners apply to content */
        }

        .markdown-content th, .markdown-content td {
            border: 1px solid var(--md-sys-color-outline-variant);
            padding: 0.75rem; /* 12px */
            text-align: right; /* Align text to the right for RTL */
        }

        .markdown-content th {
            background-color: var(--md-sys-color-secondary-container);
            font-weight: bold;
            color: var(--md-sys-color-on-secondary-container);
        }

        .markdown-content a {
            color: var(--md-sys-color-primary);
            text-decoration: none;
            transition: color 0.3s ease;
        }

        .markdown-content a:hover {
            text-decoration: underline;
            color: var(--md-sys-color-primary-container);
        }

        .markdown-content img {
            max-width: 100%;
            height: auto;
            border-radius: 0.75rem; /* More rounded */
            margin: 1.5rem 0;
            box-shadow: 0px 1px 3px rgba(0, 0, 0, 0.1), 0px 1px 2px rgba(0, 0, 0, 0.06); /* M3 elevation 1 */
            display: block; /* Center images */
            margin-left: auto;
            margin-right: auto;
        }

        /* Copy code button styles. */
        .copy-code-btn {
            position: absolute;
            top: 10px;
            left: 10px;
            background-color: rgba(0, 0, 0, 0.6);
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8em;
            opacity: 0; /* Hidden by default */
            transition: opacity 0.3s ease;
        }

        pre:hover .copy-code-btn {
            opacity: 1; /* Show on hover */
        }

        .copy-code-btn.copied {
            background-color: #28a745; /* Green when copied */
        }

        /* Modal overlay styles. */
        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 1000; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgba(0,0,0,0.6); /* Black w/ opacity */
            backdrop-filter: blur(8px); /* Blur background behind modal */
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s ease-out forwards; /* Fade-in animation */
        }

        /* Modal content box styles. */
        .modal-content {
            background-color: var(--md-sys-color-surface);
            margin: auto;
            padding: 30px;
            border-radius: 1.5rem; /* More rounded for M3 */
            width: 90%; /* Fixed width for non-responsive design */
            max-width: 600px; /* Max width for consistency */
            box-shadow: 0px 5px 15px rgba(0,0,0,0.3);
            position: relative;
            animation: zoomIn 0.3s ease-out forwards; /* Zoom-in animation */
            color: var(--md-sys-color-on-surface); /* Text color on surface */
        }

        /* Close button for modals. */
        .close-button {
            position: absolute;
            top: 15px;
            right: 20px;
            color: var(--md-sys-color-outline);
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .close-button:hover,
        .close-button:focus {
            color: var(--md-sys-color-on-surface);
        }

        /* Keyframe animation for modal fade-in. */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Keyframe animation for modal zoom-in. */
        @keyframes zoomIn {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        /* Material 3 button base styles. */
        /* This class defines common properties for all Material 3 button types. */
        .m3-button {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.625rem 1.5rem; /* 10px vertical, 24px horizontal padding */
            border-radius: 1.25rem; /* 20px, creating a pill shape */
            font-weight: 500; /* Medium font weight */
            font-size: 0.875rem; /* 14px font size */
            line-height: 1.25rem; /* 20px line height */
            cursor: pointer;
            transition: background-color 0.2s ease, color 0.2s ease, box-shadow 0.2s ease, transform 0.2s ease;
            text-decoration: none; /* Remove underline for anchor buttons */
            position: relative;
            overflow: hidden; /* For ripple effect (though not fully implemented here) */
            user-select: none; /* Prevent text selection on click */
            -webkit-tap-highlight-color: transparent; /* Remove tap highlight on mobile */
            border: none; /* Default to no border, specific types will add */
        }

        /* State layer for hover effect. */
        /* This pseudo-element creates a translucent overlay on hover. */
        .m3-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: currentColor; /* Use button's text color for ripple */
            opacity: 0;
            transition: opacity 0.2s ease;
            pointer-events: none; /* Allow clicks to pass through */
        }

        .m3-button:hover::before {
            opacity: 0.08; /* Hover state layer opacity */
        }

        .m3-button:active::before {
            opacity: 0.12; /* Pressed state layer opacity */
        }

        /* Filled Button (Primary) - Most prominent button type. */
        .m3-button-filled {
            background-color: var(--md-sys-color-primary);
            color: var(--md-sys-color-on-primary);
            box-shadow: 0px 1px 3px rgba(0, 0, 0, 0.1), 0px 1px 2px rgba(0, 0, 0, 0.06); /* Elevation 1 */
        }

        .m3-button-filled:hover {
            box-shadow: 0px 2px 6px rgba(0, 0, 0, 0.15), 0px 1px 2px rgba(0, 0, 0, 0.08); /* Elevation 2 on hover */
        }

        .m3-button-filled:active {
            box-shadow: 0px 1px 3px rgba(0, 0, 0, 0.1), 0px 1px 2px rgba(0, 0, 0, 0.06); /* Return to Elevation 1 on press */
            transform: scale(0.98); /* Slight shrink effect on press */
        }

        /* Tonal Button (Secondary) - Less prominent than filled, but more than outlined/text. */
        .m3-button-tonal {
            background-color: var(--md-sys-color-secondary-container);
            color: var(--md-sys-color-on-secondary-container);
            box-shadow: 0px 1px 3px rgba(0, 0, 0, 0.1), 0px 1px 2px rgba(0, 0, 0, 0.06); /* Elevation 1 */
        }

        .m3-button-tonal:hover {
            box-shadow: 0px 2px 6px rgba(0, 0, 0, 0.15), 0px 1px 2px rgba(0, 0, 0, 0.08); /* Elevation 2 on hover */
        }

        .m3-button-tonal:active {
            box-shadow: 0px 1px 3px rgba(0, 0, 0, 0.1), 0px 1px 2px rgba(0, 0, 0, 0.06); /* Return to Elevation 1 on press */
            transform: scale(0.98);
        }

        /* Outlined Button - Medium emphasis. */
        .m3-button-outlined {
            background-color: transparent;
            color: var(--md-sys-color-primary);
            border: 1px solid var(--md-sys-color-outline); /* Defined outline */
            box-shadow: none; /* No shadow by default */
        }

        .m3-button-outlined:hover {
            background-color: rgba(var(--md-sys-color-primary-rgb), 0.08); /* Hover state layer */
            box-shadow: none;
        }

        .m3-button-outlined:active {
            background-color: rgba(var(--md-sys-color-primary-rgb), 0.12); /* Pressed state layer */
            transform: scale(0.98);
        }

        /* Text Button - Low emphasis. */
        .m3-button-text {
            background-color: transparent;
            color: var(--md-sys-color-primary);
            box-shadow: none;
            padding: 0.625rem 0.75rem; /* Smaller horizontal padding */
            border-radius: 0.5rem; /* Less rounded for text buttons */
        }

        .m3-button-text:hover {
            background-color: rgba(var(--md-sys-color-primary-rgb), 0.08); /* Hover state layer */
            box-shadow: none;
        }

        .m3-button-text:active {
            background-color: rgba(var(--md-sys-color-primary-rgb), 0.12);
            transform: scale(0.98);
        }

        /* Utility classes for RGB conversion for state layers. */
        /* These are used in the CSS to create translucent overlays for hover/active states. */
        .primary-rgb { --md-sys-color-primary-rgb: 103, 80, 164; /* RGB for #6750A4 */ }
        .on-primary-rgb { --md-sys-color-on-primary-rgb: 255, 255, 255; }
        .secondary-rgb { --md-sys-color-secondary-rgb: 98, 91, 113; }
        .on-secondary-rgb { --md-sys-color-on-secondary-rgb: 255, 255, 255; }
        .secondary-container-rgb { --md-sys-color-secondary-container-rgb: 232, 222, 248; }
        .on-secondary-container-rgb { --md-sys-color-on-secondary-container-rgb: 29, 25, 43; }
        .outline-rgb { --md-sys-color-outline-rgb: 121, 116, 126; }
        .outline-variant-rgb { --md-sys-color-outline-variant-rgb: 202, 196, 208; }
        .surface-variant-rgb { --md-sys-color-surface-variant-rgb: 231, 224, 236; }
        .on-surface-variant-rgb { --md-sys-color-on-surface-variant-rgb: 73, 69, 79; }
        .surface-rgb { --md-sys-color-surface-rgb: 255, 251, 254; }
        .on-surface-rgb { --md-sys-color-on-surface-rgb: 28, 27, 31; }

        /* Font size variations for markdown content. */
        .markdown-content.large-font {
            font-size: 1.1em; /* Larger font size */
            line-height: 1.8; /* Adjusted line height for large font */
        }

        /* Specific styles for dark mode Prism theme */
        body.dark-mode pre code {
            /* Override Prism's light theme background in dark mode */
            background-color: var(--md-sys-color-surface-variant) !important;
            color: var(--md-sys-color-on-surface-variant) !important;
        }

        /* Search highlight styles */
        .search-highlight {
            background-color: yellow;
            color: black;
            padding: 2px 0;
            border-radius: 3px;
        }

        /* Fullscreen mode */
        body.fullscreen {
            padding: 0;
            margin: 0;
            overflow: auto;
        }

        body.fullscreen .header-viewer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 1000;
        }

        body.fullscreen .main-content-viewer {
            padding-top: 80px; /* Adjust for fixed header */
            padding-bottom: 80px; /* Adjust for fixed footer */
        }

        /* Image lightbox */
        #lightboxModal .modal-content {
            background: transparent;
            box-shadow: none;
            max-width: 90%;
            max-height: 90%;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #lightboxModal .modal-content img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            border-radius: 1rem;
        }

        #lightboxModal .close-button {
            color: white;
            text-shadow: 0 0 5px rgba(0,0,0,0.5);
        }

        /* Toast for messages */
        .toast-container {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 2000;
            display: flex;
            flex-direction: column;
            gap: 10px;
            pointer-events: none;
        }

        .toast {
            background-color: var(--md-sys-color-inverse-surface);
            color: var(--md-sys-color-inverse-on-surface);
            padding: 12px 20px;
            border-radius: 8px;
            box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2);
            opacity: 0;
            transform: translateY(20px);
            animation: toast-fade-in 0.3s forwards, toast-fade-out 0.3s 2.7s forwards;
            min-width: 250px;
            text-align: center;
            font-size: 0.9rem;
            pointer-events: auto;
        }

        .toast.error {
            background-color: var(--md-sys-color-error);
            color: var(--md-sys-color-on-error);
        }

        @keyframes toast-fade-in {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes toast-fade-out {
            from { opacity: 1; transform: translateY(0); }
            to { opacity: 0; transform: translateY(20px); }
        }

        /* Search within article styles */
        .search-in-article-container {
            position: relative;
            display: flex;
            align-items: center;
            gap: 8px;
            width: 300px; /* Adjust width as needed */
        }

        .search-in-article-input {
            width: 100%;
            padding: 8px 12px;
            border-radius: 1rem;
            border: 1px solid var(--md-sys-color-outline-variant);
            background-color: var(--md-sys-color-surface-variant);
            color: var(--md-sys-color-on-surface-variant);
            transition: all 0.2s ease;
        }

        .search-in-article-input:focus {
            border-color: var(--md-sys-color-primary);
            box-shadow: 0 0 0 2px rgba(var(--md-sys-color-primary-rgb), 0.2);
            outline: none;
        }

        .search-in-article-nav-btn {
            background-color: var(--md-sys-color-secondary-container);
            color: var(--md-sys-color-on-secondary-container);
            border-radius: 50%;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .search-in-article-nav-btn:hover {
            background-color: var(--md-sys-color-outline-variant);
        }

        .search-in-article-count {
            color: var(--md-sys-color-on-surface-variant);
            font-size: 0.875rem;
            white-space: nowrap;
        }

        /* TTS Controls */
        .tts-controls {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }
        .tts-controls button {
            @apply m3-button m3-button-tonal;
            padding: 0.5rem 1rem;
        }

        /* Like button */
        .like-button {
            @apply m3-button m3-button-outlined;
            gap: 0.5rem;
        }

        /* Comments/Related sections */
        .placeholder-section {
            background-color: var(--md-sys-color-surface-variant);
            border-radius: 1rem;
            padding: 1.5rem;
            margin-top: 2rem;
            color: var(--md-sys-color-on-surface-variant);
            text-align: center;
            font-style: italic;
        }

        /* Responsive adjustments for viewer */
        @media (max-width: 1024px) {
            .header-viewer {
                flex-direction: column;
                align-items: flex-start;
                padding: 1rem;
            }
            .header-viewer .nav-section,
            .header-viewer .controls-section {
                width: 100%;
                justify-content: center;
                margin-top: 1rem;
                flex-wrap: wrap;
            }
            .header-viewer .file-title {
                text-align: center;
                width: 100%;
                margin-top: 0.5rem;
                font-size: 1.5rem;
            }
            .header-viewer .controls-section button,
            .header-viewer .controls-section .font-size-controls,
            .header-viewer .controls-section .search-in-article-container,
            .header-viewer .controls-section .tts-controls {
                width: 100%;
                justify-content: center;
            }
            .search-in-article-container {
                flex-wrap: wrap;
            }
        }

        @media (max-width: 768px) {
            .header-viewer .controls-section {
                gap: 0.5rem;
            }
            .header-viewer .control-btn {
                padding: 0.5rem 0.75rem;
                font-size: 0.8rem;
            }
            .header-viewer .file-title {
                font-size: 1.2rem;
            }
        }
    </style>
</head>
<body class="primary-rgb on-primary-rgb secondary-rgb on-secondary-rgb secondary-container-rgb on-secondary-container-rgb outline-rgb outline-variant-rgb surface-variant-rgb on-surface-variant-rgb surface-rgb on-surface-rgb bg-gradient-to-br from-indigo-500 to-purple-600 min-h-screen p-5 flex flex-col items-center justify-center overflow-x-hidden relative">
    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer" aria-live="polite" aria-atomic="true"></div>

    <!-- Header Section (Menu) -->
    <header class="header-viewer">
        <div class="nav-section">
            <a href="index.html" class="back-btn m3-button m3-button-filled" aria-label="بازگشت به لیست مقالات">
                🏠 صفحه اصلی
            </a>
            <h1 class="file-title" id="fileTitle">در حال بارگذاری...</h1>
        </div>

        <div class="controls-section">
            <!-- Previous/Next Article Buttons -->
            <button class="control-btn m3-button m3-button-tonal" id="prevArticleBtn" aria-label="مقاله قبلی" disabled>
                ⬅️ قبلی
            </button>
            <button class="control-btn m3-button m3-button-tonal" id="nextArticleBtn" aria-label="مقاله بعدی" disabled>
                بعدی ➡️
            </button>

            <!-- Dark Mode Toggle Button -->
            <button class="control-btn m3-button m3-button-tonal" id="darkModeBtn" onclick="toggleDarkMode()" aria-label="تغییر حالت روز/شب">
                🌙
            </button>

            <!-- Share Button -->
            <button class="control-btn m3-button m3-button-tonal" onclick="shareArticle()" aria-label="اشتراک‌گذاری مقاله">
                🔗 اشتراک
            </button>

            <!-- Print Button -->
            <button class="control-btn m3-button m3-button-tonal" onclick="window.print()" aria-label="چاپ مقاله">
                🖨️ چاپ
            </button>

            <!-- Download Markdown Button -->
            <button class="control-btn m3-button m3-button-tonal" onclick="downloadMarkdown()" aria-label="دانلود فایل مارک‌دان">
                ⬇️ دانلود
            </button>
        </div>
    </header>

    <!-- Main Content Area (Now just for markdown content) -->
    <main class="container">
        <div id="markdownContent" class="markdown-content text-lg leading-relaxed">
            <div class="loading text-center py-16 text-gray-600 text-xl">در حال بارگذاری محتوا...</div>
        </div>

        <!-- Article Metadata -->
        <div id="articleMetadata" class="mt-8 p-4 bg-surface-variant rounded-lg text-on-surface-variant text-sm border border-outline-variant">
            <h4 class="font-semibold mb-2">جزئیات مقاله:</h4>
            <p><strong>تاریخ آخرین ویرایش:</strong> <span id="metaLastModified">نامشخص</span></p>
            <p><strong>اندازه فایل:</strong> <span id="metaFileSize">نامشخص</span></p>
            <p><strong>تعداد کلمات:</strong> <span id="metaWordCount">نامشخص</span></p>
            <p><strong>دسته بندی:</strong> <span id="metaCategory">نامشخص</span></p>
        </div>

        <!-- Article Rating/Like -->
        <div class="mt-8 flex items-center gap-4">
            <button class="like-button" id="likeBtn" aria-label="پسندیدن مقاله">
                👍 <span id="likeCount">0</span>
            </button>
            <span class="text-on-surface-variant text-sm">آیا این مقاله مفید بود؟</span>
        </div>

        <!-- Comments Section Placeholder -->
        <div class="placeholder-section mt-8 p-6">
            <h4 class="text-xl font-bold mb-4">بخش نظرات</h4>
            <p>اینجا مکانی برای نمایش نظرات کاربران خواهد بود. (در حال توسعه)</p>
        </div>

        <!-- Related Articles Section Placeholder -->
        <div class="placeholder-section mt-8 p-6">
            <h4 class="text-xl font-bold mb-4">مقالات مرتبط</h4>
            <p>مقالات مرتبط با این موضوع در اینجا نمایش داده خواهند شد. (در حال توسعه)</p>
        </div>
    </main>

    <!-- Image Lightbox Modal -->
    <div id="lightboxModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="lightboxTitle">
        <div class="modal-content">
            <span class="close-button" onclick="closeModal('lightboxModal')" aria-label="بستن">&times;</span>
            <img id="lightboxImage" src="" alt="تصویر بزرگ شده" class="rounded-lg">
            <h3 id="lightboxTitle" class="sr-only">تصویر بزرگ شده</h3>
        </div>
    </div>

    <!-- Feedback Modal -->
    <div id="feedbackModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="feedbackModalTitle">
        <div class="modal-content">
            <span class="close-button" onclick="closeModal('feedbackModal')" aria-label="بستن">&times;</span>
            <h3 id="feedbackModalTitle" class="text-2xl font-bold mb-4 text-gray-800">ارسال بازخورد</h3>
            <p class="text-gray-700 mb-4">
                نظرات و پیشنهادات شما برای بهبود محتوا و عملکرد سایت بسیار ارزشمند است.
            </p>
            <textarea id="feedbackTextarea" class="w-full p-3 border border-gray-300 rounded-lg mb-4 focus:ring-indigo-500 focus:border-indigo-500" rows="5" placeholder="بازخورد خود را اینجا بنویسید..." aria-label="متن بازخورد"></textarea>
            <button class="m3-button m3-button-filled mt-4" onclick="submitFeedback()">ارسال بازخورد</button>
            <div id="feedbackMessage" class="mt-3 text-sm text-center" style="display:none;" aria-live="polite"></div>
        </div>
    </div>

    <!-- Footer Section -->
    <footer class="text-center mt-12 py-6 bg-gray-100 text-gray-600 text-sm border-t border-gray-200 w-full">
        <p>&copy; 2024 ویکی لینوکس فارسی. تمامی حقوق محفوظ است.</p>
        <div class="flex justify-center gap-4 mt-2">
            <button class="m3-button m3-button-text" onclick="openModal('feedbackModal')" aria-label="ارسال بازخورد">ارسال بازخورد</button>
            <a href="index.html" class="m3-button m3-button-text" aria-label="بازگشت به صفحه اصلی">بازگشت به صفحه اصلی</a>
        </div>
    </footer>

    <button id="scrollToTopBtn" title="برو بالا" aria-label="بازگشت به بالا">⬆️</button>

    <script>
        // Global variables for managing application state.
        let currentFile = null;
        let isDarkMode = false;
        let allFileNames = []; // Hypothetical list of all article filenames for next/prev navigation

        const GITHUB_RAW_BASE = 'https://raw.githubusercontent.com/linuxpersian/linuxpersian.github.io/main/wiki/source';
        const GITHUB_API_BASE = 'https://api.github.com/repos/linuxpersian/linuxpersian.github.io/contents/wiki/source';

        /**
         * Initializes the viewer page by extracting the file name from the URL,
         * loading the file content, and applying user preferences.
         */
        async function init() {
            try {
                const urlParams = new URLSearchParams(window.location.search);
                const fileName = urlParams.get('file');

                if (!fileName) {
                    showError('نام فایل مشخص نشده است. لطفاً از صفحه اصلی فایل را انتخاب کنید.');
                    return;
                }

                await loadAllFileNames(); // Load all file names for next/previous navigation
                await loadFileFromGitHub(fileName);
                loadPreferences();
                setupEventListeners();
            } catch (error) {
                console.error('خطا در راه‌اندازی نمایشگر:', error);
                showError('خطا در بارگذاری صفحه. لطفاً دوباره تلاش کنید.');
                showToast('خطا در راه‌اندازی نمایشگر.', 'error');
            }
        }

        /**
         * Loads all markdown file names from GitHub API to enable next/previous article navigation.
         */
        async function loadAllFileNames() {
            try {
                const response = await fetch(GITHUB_API_BASE);
                if (!response.ok) {
                    throw new Error(`خطای HTTP در بارگذاری لیست فایل‌ها! وضعیت: ${response.status}`);
                }
                const files = await response.json();
                allFileNames = files
                    .filter(file => file.name.endsWith('.md'))
                    .map(file => file.name)
                    .sort(); // Sort alphabetically for consistent next/prev
                console.log('All file names loaded:', allFileNames);
            } catch (error) {
                console.error('خطا در بارگذاری لیست فایل‌ها:', error);
                showToast('خطا در بارگذاری لیست فایل‌ها برای ناوبری.', 'error');
            }
        }

        /**
         * Fetches the raw content of a specific markdown file from GitHub.
         * This function's core logic should not be changed as per user instructions.
         * It handles fetching the file and basic error checking.
         * @param {string} fileName - The name of the markdown file to fetch.
         */
        async function loadFileFromGitHub(fileName) {
            try {
                const response = await fetch(`${GITHUB_RAW_BASE}/${fileName}`);

                if (!response.ok) {
                    if (response.status === 404) {
                        throw new Error('فایل مورد نظر پیدا نشد. ممکن است حذف شده یا نام آن تغییر کرده باشد.');
                    } else {
                        throw new Error(`خطا در بارگذاری فایل: ${response.status} - ${response.statusText}`);
                    }
                }

                const content = await response.text();
                const metadata = extractMetadata(content, fileName);

                currentFile = {
                    name: fileName,
                    content: content,
                    title: metadata.title,
                    lastModified: metadata.lastModified,
                    size: metadata.size,
                    wordCount: metadata.wordCount,
                    category: metadata.category,
                };

                displayFile();
                updateArticleNavigationButtons();
                saveLastReadPosition();
            } catch (error) {
                console.error('خطا در بارگذاری فایل:', error);
                showError(error.message || 'خطا در بارگذاری فایل. لطفاً مطمئن شوید فایل وجود دارد.');
                showToast(`خطا در بارگذاری فایل: ${fileName}`, 'error');
            }
        }

        /**
         * Extracts metadata from the markdown content and file properties.
         * @param {string} content - The markdown content.
         * @param {string} fileName - The original filename.
         * @returns {object} An object containing extracted metadata.
         */
        function extractMetadata(content, fileName) {
            let title = fileName.replace('.md', '').replace(/-/g, ' ');
            let lastModified = 'نامشخص';
            let size = 0;
            let wordCount = 0;
            let category = 'general';

            // Extract title from H1
            const titleMatch = content.match(/^#\s+(.+)$/m);
            if (titleMatch) {
                title = titleMatch[1].trim();
            }

            // Estimate word count (still needed for metadata display, even if reading time is removed)
            wordCount = content.split(/\s+/).filter(word => word.length > 0).length;

            // Simulate last modified and size (actual values would come from API or build process)
            // For now, use current date for lastModified and content length for size
            lastModified = new Date().toLocaleDateString('fa-IR');
            size = new TextEncoder().encode(content).length; // Bytes

            // Category extraction (same logic as index.html)
            const lowerContent = content.toLowerCase();
            const lowerFileName = fileName.toLowerCase();

            if (lowerContent.includes('آرچ') || lowerFileName.includes('arch') || lowerContent.includes('arch linux')) {
                category = 'arch';
            } else if (lowerContent.includes('اوبونتو') || lowerFileName.includes('ubuntu')) {
                category = 'ubuntu';
            } else if (lowerContent.includes('دستور') || lowerFileName.includes('command') || lowerContent.includes('commands')) {
                category = 'command';
            } else if (lowerContent.includes('پیکربندی') || lowerFileName.includes('config') || lowerContent.includes('configuration')) {
                category = 'config';
            } else if (lowerContent.includes('عیب‌یابی') || lowerFileName.includes('troubleshoot') || lowerContent.includes('debugging')) {
                category = 'troubleshoot';
            } else if (lowerContent.includes('امنیت') || lowerFileName.includes('security')) {
                category = 'security';
            } else if (lowerContent.includes('شبکه') || lowerFileName.includes('network')) {
                category = 'network';
            } else if (lowerContent.includes('نصب') || lowerFileName.includes('install')) {
                category = 'installation';
            } else if (lowerContent.includes('مدیریت بسته') || lowerFileName.includes('package-management')) {
                category = 'package-management';
            } else {
                category = 'general';
            }

            return { title, lastModified, size, wordCount, category };
        }

        /**
         * Displays the markdown content by converting it to HTML and injecting it into the DOM.
         * Also applies syntax highlighting.
         */
        function displayFile() {
            if (!currentFile) return;

            document.getElementById('fileTitle').textContent = currentFile.title;
            document.title = `${currentFile.title} - ویکی لینوکس فارسی`;

            try {
                marked.setOptions({
                    breaks: true,
                    gfm: true,
                    headerIds: true,
                    headerPrefix: 'section-',
                });

                let htmlContent = marked.parse(currentFile.content);
                htmlContent = processHTMLForRTL(htmlContent);
                document.getElementById('markdownContent').innerHTML = htmlContent;

                highlightCodeBlocks();
                addCopyCodeButtons();
                displayArticleMetadata();
                loadLikes();
                restoreLastReadPosition();
            } catch (error) {
                console.error('خطا در تجزیه محتوای مارک‌دان:', error);
                showError('خطا در نمایش محتوای مقاله. لطفاً به مدیر سایت اطلاع دهید.');
                showToast('خطا در نمایش محتوای مقاله.', 'error');
            }
        }

        /**
         * Post-processes the generated HTML to ensure proper RTL direction for text
         * while keeping code blocks LTR, and applies additional Material 3 styling.
         * @param {string} html - The HTML string generated by marked.js.
         * @returns {string} The processed HTML string.
         */
        function processHTMLForRTL(html) {
            html = html.replace(/<p>/g, '<p dir="auto">');
            html = html.replace(/<li>/g, '<li dir="auto">');
            html = html.replace(/<blockquote>/g, '<blockquote dir="auto">');
            html = html.replace(/<h([1-6])>/g, '<h$1 dir="auto">');

            html = html.replace(/<code([^>]*)>/g, '<code$1 dir="ltr">');
            html = html.replace(/<pre>/g, '<pre dir="ltr">');

            html = html.replace(/<img/g, '<img class="max-w-full h-auto rounded-lg shadow-md my-4 block mx-auto"');

            html = html.replace(/<table>/g, '<table class="w-full border-collapse my-6 shadow-md rounded-lg overflow-hidden">');
            html = html.replace(/<thead>/g, '<thead class="bg-secondary-container dark:bg-gray-700">');
            html = html.replace(/<th>/g, '<th class="border border-outline-variant dark:border-gray-600 p-3 text-right font-semibold text-on-secondary-container dark:text-gray-200">');
            html = html.replace(/<td>/g, '<td class="border border-outline-variant dark:border-gray-600 p-3 text-right text-on-surface dark:text-gray-300">');

            return html;
        }

        /**
         * Applies syntax highlighting to code blocks using Prism.js.
         */
        function highlightCodeBlocks() {
            document.querySelectorAll('pre code').forEach((block) => {
                if (!block.classList.length) {
                    if (block.textContent.includes('sudo') || block.textContent.includes('apt') || block.textContent.includes('pacman') || block.textContent.includes('$')) {
                        block.classList.add('language-bash');
                    } else if (block.textContent.includes('function') || block.textContent.includes('const') || block.textContent.includes('let')) {
                        block.classList.add('language-javascript');
                    } else if (block.textContent.includes('<html') || block.textContent.includes('<div')) {
                        block.classList.add('language-markup');
                    }
                }
                Prism.highlightElement(block);
            });
        }

        /**
         * Adds a "Copy" button to each preformatted code block.
         * When clicked, it copies the code to the clipboard.
         */
        function addCopyCodeButtons() {
            document.querySelectorAll('pre').forEach(preBlock => {
                // Remove existing buttons to prevent duplicates
                preBlock.querySelectorAll('.copy-code-btn').forEach(btn => btn.remove());

                const button = document.createElement('button');
                button.className = 'copy-code-btn';
                button.textContent = 'کپی';
                button.onclick = () => copyCodeToClipboard(preBlock, button);
                preBlock.appendChild(button);
            });
        }

        /**
         * Copies the text content of a code block to the clipboard.
         * @param {HTMLElement} preBlock - The `<pre>` element containing the code.
         * @param {HTMLButtonElement} button - The copy button element to update its text.
         */
        function copyCodeToClipboard(preBlock, button) {
            const code = preBlock.querySelector('code');
            if (code) {
                const textToCopy = code.textContent;
                const textarea = document.createElement('textarea');
                textarea.value = textToCopy;
                textarea.style.position = 'fixed';
                textarea.style.opacity = '0';
                document.body.appendChild(textarea);
                textarea.focus();
                textarea.select();
                try {
                    const successful = document.execCommand('copy');
                    if (successful) {
                        button.textContent = 'کپی شد!';
                        button.classList.add('copied');
                        showToast('کد با موفقیت کپی شد.', 'success');
                        setTimeout(() => {
                            button.textContent = 'کپی';
                            button.classList.remove('copied');
                        }, 2000);
                    } else {
                        console.error('Failed to copy text using execCommand');
                        button.textContent = 'خطا در کپی!';
                        showToast('خطا در کپی کد.', 'error');
                    }
                } catch (err) {
                    console.error('Error copying text:', err);
                    button.textContent = 'خطا در کپی!';
                    showToast('خطا در کپی کد.', 'error');
                } finally {
                    document.body.removeChild(textarea);
                }
            }
        }

        /**
         * Toggles dark mode on and off.
         */
        function toggleDarkMode() {
            isDarkMode = !isDarkMode;
            document.body.classList.toggle('dark-mode', isDarkMode);

            const btn = document.getElementById('darkModeBtn');
            btn.innerHTML = isDarkMode ? '☀️' : '🌙'; // Changed to emojis
            if (isDarkMode) {
                btn.classList.remove('m3-button-tonal');
                btn.classList.add('m3-button-filled');
            } else {
                btn.classList.remove('m3-button-filled');
                btn.classList.add('m3-button-tonal');
            }
            localStorage.setItem('isDarkMode', isDarkMode); // Persist dark mode preference
            showToast(`حالت تاریک ${isDarkMode ? 'فعال' : 'غیرفعال'} شد.`, 'info');
        }

        /**
         * Loads user preferences from localStorage.
         */
        function loadPreferences() {
            isDarkMode = localStorage.getItem('isDarkMode') === 'true';

            if (isDarkMode) {
                document.body.classList.add('dark-mode');
                document.getElementById('darkModeBtn').innerHTML = '☀️'; // Changed to emoji
                document.getElementById('darkModeBtn').classList.remove('m3-button-tonal');
                document.getElementById('darkModeBtn').classList.add('m3-button-filled');
            } else {
                document.body.classList.remove('dark-mode');
                document.getElementById('darkModeBtn').innerHTML = '🌙'; // Changed to emoji
                document.getElementById('darkModeBtn').classList.remove('m3-button-filled');
                document.getElementById('darkModeBtn').classList.add('m3-button-tonal');
            }
        }

        /**
         * Displays an error message within the markdown content area.
         * @param {string} message - The error message to display.
         */
        function showError(message) {
            document.getElementById('markdownContent').innerHTML =
                `<div class="error text-center py-16 text-red-600 text-xl font-semibold">خطا: ${message}</div>`;
        }

        /**
         * Shares the current article's URL using the Web Share API if available,
         * otherwise copies the URL to the clipboard.
         */
        async function shareArticle() {
            const url = window.location.href;
            const title = document.title;
            const text = `مقاله: ${currentFile ? currentFile.title : 'ویکی لینوکس فارسی'}`;

            if (navigator.share) {
                try {
                    await navigator.share({
                        title: title,
                        text: text,
                        url: url,
                    });
                    showToast('محتوا با موفقیت به اشتراک گذاشته شد.', 'success');
                } catch (error) {
                    console.error('خطا در اشتراک‌گذاری:', error);
                    copyUrlToClipboard(url, 'لینک مقاله کپی شد!');
                }
            } else {
                copyUrlToClipboard(url, 'لینک مقاله کپی شد!');
            }
        }

        /**
         * Copies a given URL to the clipboard and shows a temporary message.
         * @param {string} url - The URL to copy.
         * @param {string} message - The message to display after copying.
         */
        function copyUrlToClipboard(url, message) {
            const textarea = document.createElement('textarea');
            textarea.value = url;
            textarea.style.position = 'fixed';
            textarea.style.opacity = '0';
            document.body.appendChild(textarea);
            textarea.focus();
            textarea.select();
            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    showToast(message, 'success');
                } else {
                    showToast('خطا در کپی لینک!', 'error');
                }
            } catch (err) {
                console.error('Error copying URL:', err);
                showToast('خطا در کپی لینک!', 'error');
            } finally {
                document.body.removeChild(textarea);
            }
        }

        /**
         * Downloads the current markdown content as a .md file.
         */
        function downloadMarkdown() {
            if (!currentFile || !currentFile.content) {
                showToast('محتوایی برای دانلود وجود ندارد.', 'error');
                return;
            }
            const blob = new Blob([currentFile.content], { type: 'text/markdown' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = currentFile.name;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            showToast('فایل مارک‌دان دانلود شد.', 'info');
        }

        /**
         * Opens a modal by setting its display style to 'flex'.
         * @param {string} modalId - The ID of the modal element to open.
         */
        function openModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.style.display = 'flex';
            modal.setAttribute('aria-hidden', 'false');
            setTimeout(() => {
                modal.focus();
            }, 0);
        }

        /**
         * Closes a modal by setting its display style to 'none'.
         * @param {string} modalId - The ID of the modal element to close.
         */
        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.style.display = 'none';
            modal.setAttribute('aria-hidden', 'true');
            const feedbackMessage = document.getElementById('feedbackMessage');
            if (feedbackMessage) {
                feedbackMessage.style.display = 'none';
                feedbackMessage.textContent = '';
            }
            const feedbackTextarea = document.getElementById('feedbackTextarea');
            if (feedbackTextarea) {
                feedbackTextarea.value = '';
            }
        }

        /**
         * Simulates submitting feedback.
         */
        function submitFeedback() {
            const feedbackText = document.getElementById('feedbackTextarea').value.trim();
            const feedbackMessage = document.getElementById('feedbackMessage');

            if (feedbackText.length < 10) {
                feedbackMessage.textContent = 'لطفاً بازخورد کامل‌تری (حداقل ۱۰ کاراکتر) ارائه دهید.';
                feedbackMessage.className = 'mt-3 text-sm text-center text-red-500';
                feedbackMessage.style.display = 'block';
                return;
            }

            feedbackMessage.textContent = 'در حال ارسال...';
            feedbackMessage.className = 'mt-3 text-sm text-center text-gray-600';
            feedbackMessage.style.display = 'block';

            setTimeout(() => {
                console.log('Feedback submitted:', feedbackText);
                feedbackMessage.textContent = 'بازخورد شما با موفقیت ارسال شد. از شما متشکریم!';
                feedbackMessage.className = 'mt-3 text-sm text-center text-green-600';
                showToast('بازخورد شما ارسال شد. از شما متشکریم!', 'success');
            }, 1500);
        }

        /**
         * Sets up all necessary event listeners for interactive elements on the page.
         */
        function setupEventListeners() {
            // Scroll to top button
            const scrollToTopBtn = document.getElementById('scrollToTopBtn');
            window.addEventListener('scroll', function() {
                if (document.body.scrollTop > 300 || document.documentElement.scrollTop > 300) {
                    scrollToTopBtn.style.display = 'flex';
                } else {
                    scrollToTopBtn.style.display = 'none';
                }
            });
            scrollToTopBtn.addEventListener('click', function() {
                window.scrollTo({ top: 0, behavior: 'smooth' });
                showToast('به بالای صفحه رفتید.', 'info');
            });

            // Keyboard navigation for scrolling
            document.addEventListener('keydown', handleKeyboardNavigation);

            // Image Lightbox
            document.getElementById('markdownContent').addEventListener('click', function(e) {
                if (e.target.tagName === 'IMG') {
                    openLightbox(e.target.src, e.target.alt);
                }
            });

            // Like button
            document.getElementById('likeBtn').addEventListener('click', toggleLike);
        }

        /**
         * Handles keyboard navigation for scrolling.
         * @param {KeyboardEvent} event - The keyboard event.
         */
        function handleKeyboardNavigation(event) {
            const scrollAmount = 200; // Pixels to scroll

            if (event.key === 'ArrowUp') {
                window.scrollBy({ top: -scrollAmount, behavior: 'smooth' });
                event.preventDefault();
            } else if (event.key === 'ArrowDown') {
                window.scrollBy({ top: scrollAmount, behavior: 'smooth' });
                event.preventDefault();
            } else if (event.key === 'PageUp') {
                window.scrollBy({ top: -window.innerHeight, behavior: 'smooth' });
                event.preventDefault();
            } else if (event.key === 'PageDown') {
                window.scrollBy({ top: window.innerHeight, behavior: 'smooth' });
                event.preventDefault();
            }
        }

        /**
         * Opens the image lightbox modal.
         * @param {string} src - The source URL of the image.
         * @param {string} alt - The alt text of the image.
         */
        function openLightbox(src, alt) {
            document.getElementById('lightboxImage').src = src;
            document.getElementById('lightboxImage').alt = alt;
            document.getElementById('lightboxTitle').textContent = alt; // For accessibility
            openModal('lightboxModal');
        }

        /**
         * Displays article metadata.
         */
        function displayArticleMetadata() {
            if (currentFile) {
                document.getElementById('metaLastModified').textContent = currentFile.lastModified;
                document.getElementById('metaFileSize').textContent = formatFileSize(currentFile.size);
                document.getElementById('metaWordCount').textContent = currentFile.wordCount.toLocaleString('fa-IR');
                document.getElementById('metaCategory').textContent = getCategoryName(currentFile.category);
            }
        }

        /**
         * Formats file size into human-readable format.
         * @param {number} bytes - File size in bytes.
         * @returns {string} Formatted file size.
         */
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
        }

        /**
         * Returns the Persian name for a given category.
         * @param {string} category - The category slug.
         * @returns {string} The Persian category name.
         */
        function getCategoryName(category) {
            const names = {
                'arch': 'آرچ لینوکس',
                'ubuntu': 'اوبونتو',
                'command': 'دستورات',
                'config': 'پیکربندی',
                'troubleshoot': 'عیب‌یابی',
                'general': 'عمومی',
                'security': 'امنیت',
                'network': 'شبکه',
                'installation': 'نصب و راه‌اندازی',
                'package-management': 'مدیریت بسته',
                'unknown': 'نامشخص'
            };
            return names[category] || category;
        }

        /**
         * Updates the state of next/previous article navigation buttons.
         */
        function updateArticleNavigationButtons() {
            const currentIndex = allFileNames.indexOf(currentFile.name);
            document.getElementById('prevArticleBtn').disabled = currentIndex <= 0;
            document.getElementById('nextArticleBtn').disabled = currentIndex >= allFileNames.length - 1;
        }

        /**
         * Navigates to the next or previous article.
         * @param {number} direction - 1 for next, -1 for previous.
         */
        function navigateArticle(direction) {
            const currentIndex = allFileNames.indexOf(currentFile.name);
            const newIndex = currentIndex + direction;

            if (newIndex >= 0 && newIndex < allFileNames.length) {
                const newFileName = allFileNames[newIndex];
                window.location.href = `viewer.html?file=${encodeURIComponent(newFileName)}`;
            } else {
                showToast('مقاله دیگری در این جهت وجود ندارد.', 'info');
            }
        }

        // Add event listeners for next/previous article buttons
        document.getElementById('prevArticleBtn').addEventListener('click', () => navigateArticle(-1));
        document.getElementById('nextArticleBtn').addEventListener('click', () => navigateArticle(1));

        /**
         * Saves the current scroll position for the article to localStorage.
         */
        function saveLastReadPosition() {
            if (currentFile) {
                localStorage.setItem(`lastReadPosition_${currentFile.name}`, window.scrollY);
            }
        }

        /**
         * Restores the last saved scroll position for the article from localStorage.
         */
        function restoreLastReadPosition() {
            if (currentFile) {
                const savedPosition = localStorage.getItem(`lastReadPosition_${currentFile.name}`);
                if (savedPosition) {
                    window.scrollTo(0, parseInt(savedPosition, 10));
                    showToast('موقعیت مطالعه قبلی بازیابی شد.', 'info');
                }
            }
        }

        // Save position on scroll (with a debounce for performance)
        let scrollTimeout;
        window.addEventListener('scroll', () => {
            clearTimeout(scrollTimeout);
            scrollTimeout = setTimeout(saveLastReadPosition, 500);
        });

        /**
         * Loads the like count for the current article from localStorage.
         */
        function loadLikes() {
            if (currentFile) {
                const likes = localStorage.getItem(`articleLikes_${currentFile.name}`);
                document.getElementById('likeCount').textContent = likes ? parseInt(likes, 10) : 0;
            }
        }

        /**
         * Toggles the like status and updates the count.
         */
        function toggleLike() {
            if (currentFile) {
                let likes = parseInt(localStorage.getItem(`articleLikes_${currentFile.name}`) || '0', 10);
                let hasLiked = localStorage.getItem(`articleHasLiked_${currentFile.name}`) === 'true';

                if (hasLiked) {
                    likes--;
                    localStorage.setItem(`articleHasLiked_${currentFile.name}`, 'false');
                    showToast('پسندیدن مقاله لغو شد.', 'info');
                } else {
                    likes++;
                    localStorage.setItem(`articleHasLiked_${currentFile.name}`, 'true');
                    showToast('مقاله پسندیده شد! از بازخورد شما متشکریم.', 'success');
                }
                localStorage.setItem(`articleLikes_${currentFile.name}`, likes);
                document.getElementById('likeCount').textContent = likes;
            }
        }

        /**
         * Displays a toast message.
         * @param {string} message - The message to display.
         * @param {'info' | 'success' | 'error'} type - The type of toast.
         */
        function showToast(message, type = 'info') {
            const toastContainer = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            toast.setAttribute('role', 'status');
            toast.setAttribute('aria-live', 'polite');

            toastContainer.appendChild(toast);

            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        // Initialize the page when the DOM is fully loaded.
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>

