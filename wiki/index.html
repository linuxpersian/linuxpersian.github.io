<!DOCTYPE html>
<html dir="rtl" lang="fa">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ویکی لینوکس فارسی</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;600;700&display=swap');

        :root {
            --md-sys-color-primary: #6750A4;
            --md-sys-color-on-primary: #FFFFFF;
            --md-sys-color-primary-container: #EADDFF;
            --md-sys-color-on-primary-container: #21005D;
            --md-sys-color-secondary: #625B71;
            --md-sys-color-on-secondary: #FFFFFF;
            --md-sys-color-secondary-container: #E8DEF8;
            --md-sys-color-on-secondary-container: #1D192B;
            --md-sys-color-tertiary: #7D5260;
            --md-sys-color-on-tertiary: #FFFFFF;
            --md-sys-color-tertiary-container: #FFD8E4;
            --md-sys-color-on-tertiary-container: #31111D;
            --md-sys-color-error: #B3261E;
            --md-sys-color-on-error: #FFFFFF;
            --md-sys-color-error-container: #F9DEDC;
            --md-sys-color-on-error-container: #410E0B;
            --md-sys-color-background: #FFFBFE;
            --md-sys-color-on-background: #1C1B1F;
            --md-sys-color-surface: #FFFBFE;
            --md-sys-color-on-surface: #1C1B1F;
            --md-sys-color-surface-variant: #E7E0EC;
            --md-sys-color-on-surface-variant: #49454F;
            --md-sys-color-outline: #79747E;
            --md-sys-color-shadow: #000000;
            --md-sys-color-inverse-surface: #313033;
            --md-sys-color-inverse-on-surface: #F4EFF4;
            --md-sys-color-inverse-primary: #D0BCFF;
            --md-sys-color-surface-tint: #6750A4;
            --md-sys-color-outline-variant: #CAC4D0;
            --md-sys-color-scrim: #000000;
            --md-sys-color-success: #388E3C;
            --md-sys-color-on-success: #FFFFFF;
            --md-sys-color-warning: #F57C00;
            --md-sys-color-on-warning: #FFFFFF;
        }

        body.dark-mode {
            --md-sys-color-primary: #D0BCFF;
            --md-sys-color-on-primary: #381E72;
            --md-sys-color-primary-container: #4F378B;
            --md-sys-color-on-primary-container: #EADDFF;
            --md-sys-color-secondary: #CCC2DC;
            --md-sys-color-on-secondary: #332D41;
            --md-sys-color-secondary-container: #4A4458;
            --md-sys-color-on-secondary-container: #E8DEF8;
            --md-sys-color-tertiary: #EFB8C8;
            --md-sys-color-on-tertiary: #492532;
            --md-sys-color-tertiary-container: #633B48;
            --md-sys-color-on-tertiary-container: #FFD8E4;
            --md-sys-color-error: #F2B8B5;
            --md-sys-color-on-error: #601410;
            --md-sys-color-error-container: #8C1D18;
            --md-sys-color-on-error-container: #F9DEDC;
            --md-sys-color-background: #1C1B1F;
            --md-sys-color-on-background: #E6E1E6;
            --md-sys-color-surface: #1C1B1F;
            --md-sys-color-on-surface: #E6E1E6;
            --md-sys-color-surface-variant: #49454F;
            --md-sys-color-on-surface-variant: #CAC4D0;
            --md-sys-color-outline: #938F99;
            --md-sys-color-shadow: #000000;
            --md-sys-color-inverse-surface: #E6E1E6;
            --md-sys-color-inverse-on-surface: #313033;
            --md-sys-color-inverse-primary: #6750A4;
            --md-sys-color-surface-tint: #D0BCFF;
            --md-sys-color-outline-variant: #49454F;
            --md-sys-color-scrim: #000000;
            --md-sys-color-success: #4CAF50;
            --md-sys-color-on-success: #FFFFFF;
            --md-sys-color-warning: #FF9800;
            --md-sys-color-on-warning: #FFFFFF;
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: 'Vazirmatn', sans-serif; /* Applied Vazirmatn font to the entire body */
            background: linear-gradient(135deg, var(--md-sys-color-primary-container) 0%, var(--md-sys-color-tertiary-container) 100%);
            color: var(--md-sys-color-on-background);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            padding: 0;
            margin: 0;
            overflow-x: hidden;
            position: relative;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 80%, rgba(103, 80, 164, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(125, 82, 96, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(98, 91, 113, 0.05) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            body {
                padding: 0.5rem;
            }
            
            .container {
                width: 100% !important;
                max-width: 100% !important;
                margin: 0.5rem 0 !important;
                padding: 1rem !important;
                border-radius: 1rem !important;
            }

            .header h1 {
                font-size: 2.5rem !important;
            }

            .header p {
                font-size: 1rem !important;
            }

            .search-input {
                width: 100% !important;
                max-width: 100% !important;
            }

            .file-grid {
                grid-template-columns: 1fr !important;
                gap: 1rem !important;
            }

            .controls-row {
                flex-direction: column !important;
                gap: 0.75rem !important;
            }

            .view-controls, .sort-controls {
                width: 100% !important;
                justify-content: center !important;
            }
        }

        @media (max-width: 1024px) {
            .container {
                width: 95%;
                max-width: 95%;
            }

            .file-grid.grid-view {
                grid-template-columns: repeat(2, 1fr) !important;
            }
        }

        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--md-sys-color-surface-variant);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--md-sys-color-primary);
            border-radius: 10px;
            transition: background 0.3s ease;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--md-sys-color-on-primary-container);
        }

        /* Animations */
        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInScale {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.7;
            }
        }

        @keyframes shimmer {
            0% {
                background-position: -468px 0;
            }
            100% {
                background-position: 468px 0;
            }
        }

        .animate-fade-in-down {
            animation: fadeInDown 0.8s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }

        .animate-fade-in-up {
            animation: fadeInUp 0.6s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }

        .animate-fade-in-scale {
            animation: fadeInScale 0.5s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }

        /* Container */
        .container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 2rem;
            box-shadow: 
                0 20px 25px -5px rgba(0, 0, 0, 0.1),
                0 10px 10px -5px rgba(0, 0, 0, 0.04),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            width: 90%;
            max-width: 1200px;
            margin: 2rem auto;
            padding: 2rem;
            position: relative;
            overflow: hidden;
        }

        .dark-mode .container {
            background: rgba(28, 27, 31, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Header */
        .header {
            text-align: center; /* Ensures content inside header is centered */
            margin-bottom: 3rem;
        }

        .header h1 {
            color: var(--md-sys-color-on-background); /* Black/dark color */
            font-size: 4.5rem; /* Larger font size */
            font-weight: 800;
            margin-bottom: 1rem;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            letter-spacing: -0.02em;
        }

        .header p {
            color: var(--md-sys-color-on-background); /* Black/dark color */
            font-size: 1.75rem; /* Larger font size */
            font-weight: 400;
            line-height: 1.6;
            opacity: 0.8;
        }

        /* Search Section */
        .search-section {
            margin-bottom: 3rem;
            text-align: center; /* Ensures the search container is centered */
        }

        .search-container {
            position: relative;
            width: 100%;
            max-width: 700px;
            margin: 0 auto 2rem; /* Ensures it's centered */
        }

        .search-input {
            width: 100%;
            background: var(--md-sys-color-surface);
            color: var(--md-sys-color-on-surface);
            border: 2px solid var(--md-sys-color-outline-variant);
            border-radius: 2rem;
            /* Adjusted padding for left-aligned buttons */
            padding: 1rem 1.5rem 1rem 4rem; 
            font-size: 1.1rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .search-input:focus {
            border-color: var(--md-sys-color-primary);
            box-shadow: 0 0 0 3px rgba(103, 80, 164, 0.1), 0 4px 12px rgba(0, 0, 0, 0.15);
            outline: none;
            transform: translateY(-1px);
        }

        .search-btn, .clear-search-btn {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            border: none;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .search-btn {
            /* Changed from right to left */
            left: 0.75rem; 
            width: 2.5rem;
            height: 2.5rem;
            background: var(--md-sys-color-primary);
            color: var(--md-sys-color-on-primary);
            box-shadow: 0 2px 8px rgba(103, 80, 164, 0.3);
        }

        .search-btn:hover {
            transform: translateY(-50%) scale(1.05);
            box-shadow: 0 4px 12px rgba(103, 80, 164, 0.4);
        }

        .clear-search-btn {
            /* Changed from right to left */
            left: 3.5rem; 
            width: 2rem;
            height: 2rem;
            background: var(--md-sys-color-surface-variant);
            color: var(--md-sys-color-on-surface-variant);
            font-size: 1rem;
        }

        .clear-search-btn:hover {
            background: var(--md-sys-color-error);
            color: var(--md-sys-color-on-error);
            transform: translateY(-50%) scale(1.1);
        }

        /* Controls */
        .controls-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .view-controls, .sort-controls {
            display: flex;
            gap: 0.75rem;
            align-items: center;
        }

        /* Buttons */
        .m3-button {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.75rem 1.5rem;
            border-radius: 1.5rem;
            font-weight: 500;
            font-size: 0.9rem;
            line-height: 1.2;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-decoration: none;
            position: relative;
            overflow: hidden;
            user-select: none;
            border: none;
            white-space: nowrap;
            gap: 0.5rem;
        }

        .m3-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: currentColor;
            opacity: 0;
            transition: opacity 0.2s ease;
            pointer-events: none;
            border-radius: inherit;
        }

        .m3-button:hover::before {
            opacity: 0.08;
        }

        .m3-button:active {
            transform: scale(0.96);
        }

        .m3-button-filled {
            background: var(--md-sys-color-primary);
            color: var(--md-sys-color-on-primary);
            box-shadow: 0 2px 8px rgba(103, 80, 164, 0.3);
        }

        .m3-button-filled:hover {
            box-shadow: 0 4px 12px rgba(103, 80, 164, 0.4);
            transform: translateY(-1px);
        }

        .m3-button-tonal {
            background: var(--md-sys-color-secondary-container);
            color: var(--md-sys-color-on-secondary-container);
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.1);
        }

        .m3-button-tonal:hover {
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            transform: translateY(-1px);
        }

        .m3-button-outlined {
            background: transparent;
            color: var(--md-sys-color-primary);
            border: 2px solid var(--md-sys-color-outline);
        }

        .m3-button-outlined:hover {
            background: rgba(103, 80, 164, 0.05);
            border-color: var(--md-sys-color-primary);
        }

        .m3-button-text {
            background: transparent;
            color: var(--md-sys-color-primary);
            padding: 0.5rem 1rem;
        }

        .m3-button-text:hover {
            background: rgba(103, 80, 164, 0.05);
        }

        /* View Mode Buttons */
        .view-mode-btn.active {
            background: var(--md-sys-color-primary) !important;
            color: var(--md-sys-color-on-primary) !important;
            box-shadow: 0 2px 8px rgba(103, 80, 164, 0.3) !important;
        }

        /* Sort Select */
        .sort-select {
            padding: 0.75rem 3rem 0.75rem 1.5rem;
            border-radius: 1.5rem;
            font-weight: 500;
            font-size: 0.9rem;
            cursor: pointer;
            background: var(--md-sys-color-secondary-container);
            color: var(--md-sys-color-on-secondary-container);
            border: 2px solid var(--md-sys-color-outline-variant);
            appearance: none;
            background-image: url('data:image/svg+xml;charset=UTF-8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2220%22%20height%3D%2220%22%20viewBox%3D%220%200%2020%2020%22%20fill%3D%22none%22%20stroke%3D%22%2349454F%22%20stroke-width%3D%222%22%20stroke-linecap%3D%22round%22%20stroke-linejoin%3D%22round%22%3E%3Cpolyline%20points%3D%226%209%2012%2015%2018%209%22%3E%3C%2Fpolyline%3E%3C%2Fsvg%3E');
            background-repeat: no-repeat;
            background-position: left 1rem center;
            background-size: 1.2em;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.1);
        }

        .sort-select:focus {
            border-color: var(--md-sys-color-primary);
            box-shadow: 0 0 0 3px rgba(103, 80, 164, 0.1), 0 2px 8px rgba(0, 0, 0, 0.15);
            outline: none;
        }

        /* File Grid */
        .files-section {
            margin-bottom: 3rem;
        }

        .section-title {
            color: var(--md-sys-color-on-background); /* Changed color to match body text */
            font-size: 2rem; /* Smaller font size */
            font-weight: 700;
            margin-bottom: 2rem;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .file-grid {
            display: grid; /* Base display for grid */
            gap: 1.5rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .file-grid.grid-view {
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
        }

        .file-grid.list-view {
            grid-template-columns: 1fr;
        }

        .file-card {
            background: var(--md-sys-color-surface);
            border: 1px solid var(--md-sys-color-outline-variant);
            border-radius: 1.5rem;
            padding: 1.75rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            opacity: 1; /* Ensure visibility by default */
            transform: translateY(0); /* Ensure position by default */
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        .file-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--md-sys-color-primary), var(--md-sys-color-tertiary));
            transform: scaleX(0);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .file-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            border-color: var(--md-sys-color-primary);
        }

        .file-card:hover::before {
            transform: scaleX(1);
        }

        .file-card.animate {
            animation: fadeInUp 0.6s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }

        .file-title {
            font-size: 1.4rem;
            font-weight: 600;
            color: var(--md-sys-color-on-surface);
            margin-bottom: 0.75rem;
            line-height: 1.3;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .file-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-bottom: 1rem;
            font-size: 0.85rem;
            color: var(--md-sys-color-on-surface-variant);
        }

        .file-meta span {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            padding: 0.25rem 0.5rem;
            background: var(--md-sys-color-surface-variant);
            border-radius: 0.75rem;
            font-weight: 500;
        }

        .file-preview {
            color: var(--md-sys-color-on-surface);
            line-height: 1.6;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
            font-size: 0.95rem;
        }

        /* List View Specific */
        .file-card.list-view {
            display: flex;
            gap: 1.5rem;
            align-items: flex-start;
            padding: 1.5rem;
        }

        .file-card.list-view .file-icon {
            flex-shrink: 0;
            width: 3.5rem;
            height: 3.5rem;
            border-radius: 1rem;
            background: var(--md-sys-color-primary-container);
            color: var(--md-sys-color-on-primary-container);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .file-card.list-view .file-content {
            flex: 1;
            min-width: 0;
        }

        .file-card.list-view .file-title {
            font-size: 1.2rem;
            margin-bottom: 0.5rem;
        }

        .file-card.list-view .file-meta {
            margin-bottom: 0.75rem;
        }

        .file-card.list-view .file-preview {
            -webkit-line-clamp: 2;
        }

        /* Skeleton Loading */
        .skeleton-card {
            background: var(--md-sys-color-surface-variant);
            border-radius: 1.5rem;
            padding: 1.75rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            position: relative;
            overflow: hidden;
        }

        .skeleton-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -468px;
            width: 468px;
            height: 100%;
            background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(255, 255, 255, 0.2) 50%, 
                transparent 100%);
            animation: shimmer 1.2s infinite ease-in-out;
        }

        .skeleton-title, .skeleton-meta, .skeleton-preview {
            background: var(--md-sys-color-outline-variant);
            border-radius: 0.5rem;
            margin-bottom: 0.75rem;
        }

        .skeleton-title {
            height: 1.5rem;
            width: 80%;
        }

        .skeleton-meta {
            height: 1rem;
            width: 60%;
        }

        .skeleton-preview {
            height: 3rem;
            width: 100%;
        }

        /* Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 1rem;
            margin-top: 3rem;
            flex-wrap: wrap;
        }

        .page-btn:disabled {
            background: var(--md-sys-color-surface-variant) !important;
            color: var(--md-sys-color-outline) !important;
            border-color: var(--md-sys-color-outline-variant) !important;
            cursor: not-allowed !important;
            transform: none !important;
            box-shadow: none !important;
        }

        #pageJumpInput {
            width: 4rem;
            text-align: center;
            padding: 0.5rem;
            border: 2px solid var(--md-sys-color-outline);
            border-radius: 0.75rem;
            background: var(--md-sys-color-surface);
            color: var(--md-sys-color-on-surface);
            font-weight: 500;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        #pageJumpInput:focus {
            border-color: var(--md-sys-color-primary);
            box-shadow: 0 0 0 2px rgba(103, 80, 164, 0.1);
            outline: none;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(8px);
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.3s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }

        .modal-content {
            background: var(--md-sys-color-surface);
            padding: 2rem;
            border-radius: 2rem;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            animation: fadeInScale 0.3s cubic-bezier(0.4, 0, 0.2, 1) forwards;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.2);
            border: 1px solid var(--md-sys-color-outline-variant);
        }

        .close-button {
            position: absolute;
            top: 15px;
            right: 20px;
            color: var(--md-sys-color-outline);
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .close-button:hover,
        .close-button:focus {
            color: var(--md-sys-color-on-surface);
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes zoomIn {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .m3-button {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.625rem 1.5rem;
            border-radius: 1.25rem;
            font-weight: 500;
            font-size: 0.875rem;
            line-height: 1.25rem;
            cursor: pointer;
            transition: background-color 0.2s ease, color 0.2s ease, box-shadow 0.2s ease, transform 0.2s ease;
            text-decoration: none;
            position: relative;
            overflow: hidden;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            border: none;
        }

        .m3-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: currentColor;
            opacity: 0;
            transition: opacity 0.2s ease;
            pointer-events: none;
        }

        .m3-button:hover::before {
            opacity: 0.08;
        }

        .m3-button:active::before {
            opacity: 0.12;
        }

        .m3-button-filled {
            background-color: var(--md-sys-color-primary);
            color: var(--md-sys-color-on-primary);
            box-shadow: 0px 1px 3px rgba(0, 0, 0, 0.1), 0px 1px 2px rgba(0, 0, 0, 0.06);
        }

        .m3-button-filled:hover {
            box-shadow: 0px 2px 6px rgba(0, 0, 0, 0.15), 0px 1px 2px rgba(0, 0, 0, 0.08);
        }

        .m3-button-filled:active {
            box-shadow: 0px 1px 3px rgba(0, 0, 0, 0.1), 0px 1px 2px rgba(0, 0, 0, 0.06);
            transform: scale(0.98);
        }

        .m3-button-tonal {
            background-color: var(--md-sys-color-secondary-container);
            color: var(--md-sys-color-on-secondary-container);
            box-shadow: 0px 1px 3px rgba(0, 0, 0, 0.1), 0px 1px 2px rgba(0, 0, 0, 0.06);
        }

        .m3-button-tonal:hover {
            box-shadow: 0px 2px 6px rgba(0, 0, 0, 0.15), 0px 1px 2px rgba(0, 0, 0, 0.08);
        }

        .m3-button-tonal:active {
            box-shadow: 0px 1px 3px rgba(0, 0, 0, 0.1), 0px 1px 2px rgba(0, 0, 0, 0.06);
            transform: scale(0.98);
        }

        .m3-button-outlined {
            background-color: transparent;
            color: var(--md-sys-color-primary);
            border: 1px solid var(--md-sys-color-outline);
            box-shadow: none;
        }

        .m3-button-outlined:hover {
            background-color: rgba(var(--md-sys-color-primary-rgb), 0.08);
            box-shadow: none;
        }

        .m3-button-outlined:active {
            background-color: rgba(var(--md-sys-color-primary-rgb), 0.12);
            transform: scale(0.98);
        }

        .m3-button-text {
            background-color: transparent;
            color: var(--md-sys-color-primary);
            box-shadow: none;
            padding: 0.625rem 0.75rem;
            border-radius: 0.5rem;
        }

        .m3-button-text:hover {
            background-color: rgba(var(--md-sys-color-primary-rgb), 0.08);
            box-shadow: none;
        }

        .m3-button-text:active {
            background-color: rgba(var(--md-sys-color-primary-rgb), 0.12);
            transform: scale(0.98);
        }

        .m3-fab {
            background-color: var(--md-sys-color-primary-container);
            color: var(--md-sys-color-on-primary-container);
            border-radius: 1rem;
            width: 48px;
            height: 48px;
            padding: 0;
            box-shadow: 0px 3px 6px rgba(0, 0, 0, 0.2), 0px 2px 4px rgba(0, 0, 0, 0.12);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .m3-fab:hover {
            box-shadow: 0px 6px 10px rgba(0, 0, 0, 0.2), 0px 3px 6px rgba(0, 0, 0, 0.15);
        }

        .m3-fab:active {
            box-shadow: 0px 3px 6px rgba(0, 0, 0, 0.2), 0px 2px 4px rgba(0, 0, 0, 0.12);
            transform: scale(0.98);
        }

        .container {
            background-color: var(--md-sys-color-surface);
            color: var(--md-sys-color-on-surface);
            border-radius: 1.5rem;
            box-shadow: 0px 5px 10px rgba(0, 0, 0, 0.2);
            transition: background-color 0.3s ease, color 0.3s ease, box-shadow 0.3s ease;
            width: 900px;
            max-width: 900px;
        }

        .header h1 {
            color: var(--md-sys-color-on-background); /* Updated color to black/dark */
            text-shadow: none;
            font-size: 4.5rem; /* Larger font size for main title */
        }

        .header p {
            color: var(--md-sys-color-on-background); /* Updated color to black/dark */
            font-size: 1.75rem; /* Larger font size for description */
        }

        .search-input {
            background-color: var(--md-sys-color-surface-variant);
            color: var(--md-sys-color-on-surface-variant);
            border: 1px solid var(--md-sys-color-outline);
            border-radius: 1.75rem;
            /* Adjusted padding for left-aligned buttons */
            padding-left: 3.5rem;
            padding-right: 1.5rem; 
            width: 600px; /* Wider search input */
            max-width: 600px;
        }

        .search-input:focus {
            border-color: var(--md-sys-color-primary);
            box-shadow: 0 0 0 2px rgba(var(--md-sys-color-primary-rgb), 0.2);
            background-color: var(--md-sys-color-surface);
        }

        .search-btn, .clear-search-btn {
            border-radius: 1.25rem;
            box-shadow: none;
            transition: all 0.2s cubic-bezier(0.2, 0.0, 0, 1.0);
        }

        .search-btn {
            background-color: var(--md-sys-color-primary);
            color: var(--md-sys-color-on-primary);
            padding: 0.75rem;
            font-size: 14px;
        }
        .search-btn:hover {
            background-color: var(--md-sys-color-primary);
            opacity: 0.9;
        }
        .search-btn:active {
            transform: scale(0.95);
        }

        .clear-search-btn {
            background-color: var(--md-sys-color-surface-variant);
            color: var(--md-sys-color-on-surface-variant);
            padding: 0.5rem;
            font-size: 0.75rem;
        }
        .clear-search-btn:hover {
            background-color: var(--md-sys-color-outline-variant);
        }
        .clear-search-btn:active {
            transform: scale(0.95);
        }

        .view-mode-btn {
            @apply m3-button m3-button-tonal;
        }

        .view-mode-btn.active {
            @apply m3-button-filled;
        }

        .sort-select {
            padding: 0.625rem 1.5rem;
            border-radius: 1.25rem;
            font-weight: 500;
            font-size: 0.875rem;
            line-height: 1.25rem;
            cursor: pointer;
            background-color: var(--md-sys-color-secondary-container);
            color: var(--md-sys-color-on-secondary-container);
            border: 1px solid var(--md-sys-color-outline);
            appearance: none; /* Remove default select arrow */
            background-image: url('data:image/svg+xml;charset=UTF-8,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2220%22%20height%3D%2220%22%20viewBox%3D%220%200%2020%2020%22%20fill%3D%22none%22%20stroke%3D%22%2349454F%22%20stroke-width%3D%222%22%20stroke-linecap%3D%22round%22%20stroke-linejoin%3D%22round%22%3E%3Cpolyline%20points%3D%226%209%2012%2015%2018%209%22%3E%3C%2Fpolyline%3E%3C%2Fsvg%3E');
            background-repeat: no-repeat;
            background-position: left 1rem center;
            background-size: 1em;
            padding-left: 2.5rem; /* Space for custom arrow */
        }

        .sort-select:focus {
            border-color: var(--md-sys-color-primary);
            box-shadow: 0 0 0 2px rgba(var(--md-sys-color-primary-rgb), 0.2);
            outline: none;
        }

        #sortDropdownContent {
            background-color: var(--md-sys-color-surface);
            border: 1px solid var(--md-sys-color-outline-variant);
            border-radius: 0.75rem;
            box-shadow: 0px 2px 5px rgba(0, 0, 0, 0.1);
            padding: 8px 0;
        }

        #sortDropdownContent a {
            color: var(--md-sys-color-on-surface);
            display: block;
            padding: 8px 16px;
            transition: background-color 0.1s ease;
            text-decoration: none;
        }

        #sortDropdownContent a:hover {
            background-color: var(--md-sys-color-surface-variant);
        }

        .section-title {
            color: var(--md-sys-color-on-background); /* Updated color to black/dark */
        }

        #fileCount {
            color: var(--md-sys-color-on-background); /* Updated color to black/dark */
            font-size: 1.25rem; /* Smaller font size */
        }

        .pagination .page-btn {
            @apply m3-button m3-button-outlined;
        }

        .pagination .page-btn:disabled {
            background-color: var(--md-sys-color-surface-variant);
            color: var(--md-sys-color-outline);
            border-color: var(--md-sys-color-outline-variant);
            cursor: not-allowed;
            box-shadow: none;
            transform: none;
            opacity: 1;
        }

        #pageInfo {
            color: var(--md-sys-color-on-surface);
        }

        footer {
            color: var(--md-sys-color-on-surface-variant);
        }

        footer button, footer a {
            @apply m3-button m3-button-text;
            color: var(--md-sys-color-primary);
        }

        #scrollToTopBtn {
            @apply m3-fab;
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 99;
            background-color: var(--md-sys-color-primary);
            color: var(--md-sys-color-on-primary);
            box-shadow: 0px 6px 10px rgba(0, 0, 0, 0.2), 0px 3px 6px rgba(0, 0, 0, 0.15);
            font-size: 1.5rem; /* Larger emoji size for FAB */
        }

        #scrollToTopBtn:hover {
            box-shadow: 0px 8px 12px rgba(0, 0, 0, 0.25), 0px 4px 8px rgba(0, 0, 0, 0.18);
        }

        .primary-rgb { --md-sys-color-primary-rgb: 103, 80, 164; }
        .on-primary-rgb { --md-sys-color-on-primary-rgb: 255, 255, 255; }
        .secondary-rgb { --md-sys-color-secondary-rgb: 98, 91, 113; }
        .on-secondary-rgb { --md-sys-color-on-secondary-rgb: 255, 255, 255; }
        .secondary-container-rgb { --md-sys-color-secondary-container-rgb: 232, 222, 248; }
        .on-secondary-container-rgb { --md-sys-color-on-secondary-container-rgb: 29, 25, 43; }
        .outline-rgb { --md-sys-color-outline-rgb: 121, 116, 126; }
        .outline-variant-rgb { --md-sys-color-outline-variant-rgb: 202, 196, 208; }
        .surface-variant-rgb { --md-sys-color-surface-variant-rgb: 231, 224, 236; }
        .on-surface-variant-rgb { --md-sys-color-on-surface-variant-rgb: 73, 69, 79; }
        .surface-rgb { --md-sys-color-surface-rgb: 255, 251, 254; }
        .on-surface-rgb { --md-sys-color-on-surface-rgb: 28, 27, 31; }

        .toast-container {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 2000;
            display: flex;
            flex-direction: column;
            gap: 10px;
            pointer-events: none;
        }

        .toast {
            background-color: var(--md-sys-color-inverse-surface);
            color: var(--md-sys-color-inverse-on-surface);
            padding: 12px 20px;
            border-radius: 8px;
            box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2);
            opacity: 0;
            transform: translateY(20px);
            animation: toast-fade-in 0.3s forwards, toast-fade-out 0.3s 2.7s forwards;
            min-width: 250px;
            text-align: center;
            font-size: 0.9rem;
            pointer-events: auto;
        }

        .toast.error {
            background-color: var(--md-sys-color-error);
            color: var(--md-sys-color-on-error);
        }

        @keyframes toast-fade-in {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes toast-fade-out {
            from { opacity: 1; transform: translateY(0); }
            to { opacity: 0; transform: translateY(20px); }
        }

        .settings-modal-content .input-group {
            margin-bottom: 15px;
        }

        .settings-modal-content label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: var(--md-sys-color-on-surface-variant);
        }

        .settings-modal-content input[type="number"],
        .settings-modal-content select {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--md-sys-color-outline);
            border-radius: 8px;
            background-color: var(--md-sys-color-surface-variant);
            color: var(--md-sys-color-on-surface-variant);
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }

        .settings-modal-content input[type="number"]:focus,
        .settings-modal-content select:focus {
            border-color: var(--md-sys-color-primary);
            box-shadow: 0 0 0 2px rgba(var(--md-sys-color-primary-rgb), 0.2);
            outline: none;
        }

        .sort-dialog-content .radio-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 20px;
        }

        .sort-dialog-content .radio-item {
            display: flex;
            align-items: center;
            padding: 10px;
            border-radius: 8px;
            background-color: var(--md-sys-color-surface-variant);
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .sort-dialog-content .radio-item:hover {
            background-color: var(--md-sys-color-outline-variant);
        }

        .sort-dialog-content input[type="radio"] {
            margin-left: 10px;
            transform: scale(1.2);
            accent-color: var(--md-sys-color-primary);
        }

        .sort-dialog-content label {
            font-weight: 500;
            color: var(--md-sys-color-on-surface-variant);
            cursor: pointer;
        }
    </style>
</head>
<body class="primary-rgb on-primary-rgb secondary-rgb on-secondary-rgb secondary-container-rgb on-secondary-container-rgb outline-rgb outline-variant-rgb surface-variant-rgb on-surface-variant-rgb surface-rgb on-surface-rgb bg-gradient-to-br from-indigo-500 to-purple-600 min-h-screen p-5 flex flex-col items-center justify-center overflow-x-hidden relative">

    <div class="toast-container" id="toastContainer" aria-live="polite" aria-atomic="true"></div>

    <div class="container bg-white bg-opacity-95 rounded-3xl p-8 shadow-2xl backdrop-blur-md w-full my-8">

        <header class="text-center mb-10 animate-fade-in-down">
            <h1 class="text-5xl font-extrabold text-gray-900 mb-3">ویکی لینوکس فارسی</h1>
            <p class="text-lg text-gray-600">مجموعه کامل سوالات و پاسخ‌های لینوکس به زبان فارسی</p>
        </header>

        <section class="search-section mb-10 text-center">
            <div class="search-container relative mx-auto">
                <!-- Search input field -->
                <input type="text" class="search-input py-4 pl-14 pr-6 text-lg border-2 border-gray-300 rounded-full outline-none focus:border-indigo-500 focus:shadow-lg transition-all duration-300" id="searchInput" placeholder="جستجو در عنوان‌ها و محتوا..." aria-label="جستجو در مقالات">
                <!-- Search button, now on the left -->
                <button class="search-btn absolute right-3 top-1/2 -translate-y-1/2 p-3 rounded-full cursor-pointer" onclick="performSearch()" aria-label="جستجو">🔍</button>
                <!-- Clear search button, now on the left -->
                <button class="clear-search-btn absolute right-12 top-1/2 -translate-y-1/2 p-2 rounded-full cursor-pointer text-sm" id="clearSearchBtn" style="display:none;" onclick="clearSearch()" aria-label="پاک کردن جستجو">✖️</button>
            </div>

            <div class="flex justify-center gap-4 mt-6 flex-nowrap overflow-x-auto pb-2">
                <button class="m3-button m3-button-tonal" onclick="openSortSettingsModal()" aria-label="مرتب‌سازی">
                    ⇅ مرتب‌سازی
                </button>
                <button class="view-mode-btn m3-button m3-button-tonal active" data-view="grid" aria-label="نمایش شبکه‌ای">
                    ▦ شبکه
                </button>
                <button class="view-mode-btn m3-button m3-button-tonal" data-view="list" aria-label="نمایش لیستی">
                    ☰ لیست
                </button>
                <button class="m3-button m3-button-tonal" onclick="openModal('settingsModal')" aria-label="تنظیمات">⚙️ تنظیمات</button>
            </div>
        </section>

        <section class="files-section mb-8">
            <h2 class="section-title text-3xl font-bold text-gray-800 mb-6 flex items-center gap-3">
                فایل‌های آموزشی
                <span id="fileCount" class="text-gray-500 text-xl font-normal">(در حال بارگذاری...)</span>
            </h2>

            <div id="fileGrid" class="file-grid grid gap-6" role="list">
                <div class="loading text-center py-10 text-gray-600 text-lg">در حال بارگذاری فایل‌ها...</div>
            </div>
        </section>

        <div class="pagination flex justify-center items-center mt-10 gap-4" id="pagination" style="display: none;" role="navigation" aria-label="صفحه‌بندی مقالات">
            <button class="page-btn m3-button m3-button-outlined" onclick="changePage('prev')" id="prevBtn" aria-label="صفحه قبلی">قبلی</button>
            <span id="pageInfo" class="text-xl font-semibold text-gray-700" aria-live="polite">صفحه 1 از 1</span>
            <input type="number" id="pageJumpInput" class="w-20 text-center py-2 border border-gray-300 rounded-lg" min="1" onkeypress="handlePageJump(event)" aria-label="پرش به صفحه">
            <button class="page-btn m3-button m3-button-outlined" onclick="changePage('next')" id="nextBtn" aria-label="صفحه بعدی">بعدی</button>
        </div>

        <div id="aboutModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="aboutModalTitle">
            <div class="modal-content">
                <span class="close-button" onclick="closeModal('aboutModal')" aria-label="بستن">&times;</span>
                <h3 id="aboutModalTitle" class="text-2xl font-bold mb-4 text-gray-800">درباره ویکی لینوکس فارسی</h3>
                <p class="text-gray-700 mb-4">
                    این پروژه با هدف ایجاد یک منبع جامع و رایگان برای آموزش و حل مشکلات لینوکس به زبان فارسی راه‌اندازی شده است. ما تلاش می‌کنیم تا با جمع‌آوری و سازماندهی مقالات، دستورات، و راهنماهای کاربردی، تجربه کار با لینوکس را برای کاربران فارسی‌زبان آسان‌تر و لذت‌بخش‌تر کنیم.
                </p>
                <p class="text-gray-700">
                    تمامی محتوا از طریق مخزن گیت‌هاب <a href="https://github.com/linuxpersian/linuxpersian.github.io" target="_blank" class="text-indigo-600 hover:underline">linuxpersian/linuxpersian.github.io</a> قابل دسترسی و مشارکت است. از همراهی شما سپاسگزاریم!
                </p>
            </div>
        </div>

        <div id="helpModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="helpModalTitle">
            <div class="modal-content">
                <span class="close-button" onclick="closeModal('helpModal')" aria-label="بستن">&times;</span>
                <h3 id="helpModalTitle" class="text-2xl font-bold mb-4 text-gray-800">راهنما</h3>
                <p class="text-gray-700 mb-2">
                    <strong>جستجو:</strong> می‌توانید با استفاده از کادر جستجو، مقالات را بر اساس عنوان، پیش‌نمایش یا نام فایل جستجو کنید.
                </p>
                <p class="text-gray-700 mb-2">
                    <strong>مرتب‌سازی:</strong> از منوی "مرتب‌سازی بر اساس" می‌توانید ترتیب نمایش مقالات را تغییر دهید (بر اساس تاریخ، عنوان یا اندازه).
                </p>
                <p class="text-gray-700 mb-2">
                    <strong>حالت نمایش:</strong> بین حالت نمایش شبکه‌ای (Grid) و لیستی (List) جابجا شوید.
                </p>
                <p class="text-gray-700">
                    برای مشاهده جزئیات هر مقاله، کافیست روی کارت آن کلیک کنید.
                </p>
            </div>
        </div>

        <div id="settingsModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="settingsModalTitle">
            <div class="modal-content settings-modal-content">
                <span class="close-button" onclick="closeModal('settingsModal')" aria-label="بستن">&times;</span>
                <h3 id="settingsModalTitle" class="text-2xl font-bold mb-4 text-gray-800">تنظیمات</h3>
                <div class="input-group">
                    <label for="settingsFilesPerPage">تعداد فایل در هر صفحه:</label>
                    <input type="number" id="settingsFilesPerPage" min="1" value="12" aria-label="تعداد فایل در هر صفحه">
                </div>
                <div class="input-group">
                    <label for="settingsDarkModeToggle">حالت تاریک:</label>
                    <input type="checkbox" id="settingsDarkModeToggle" class="toggle-switch" aria-label="فعال/غیرفعال کردن حالت تاریک">
                </div>
                <button class="m3-button m3-button-filled mt-4" onclick="applySettings()">اعمال تنظیمات</button>
            </div>
        </div>

        <div id="sortSettingsModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="sortSettingsModalTitle">
            <div class="modal-content sort-dialog-content">
                <span class="close-button" onclick="closeModal('sortSettingsModal')" aria-label="بستن">&times;</span>
                <h3 id="sortSettingsModalTitle" class="text-2xl font-bold mb-4 text-gray-800">تنظیمات مرتب‌سازی</h3>
                <div class="radio-group" role="radiogroup" aria-labelledby="sortSettingsModalTitle">
                    <div class="radio-item">
                        <input type="radio" id="sortDateDesc" name="sortOption" value="date-desc" checked aria-checked="true">
                        <label for="sortDateDesc">تاریخ (جدیدترین)</label>
                    </div>
                    <div class="radio-item">
                        <input type="radio" id="sortDateAsc" name="sortOption" value="date-asc" aria-checked="false">
                        <label for="sortDateAsc">تاریخ (قدیمی‌ترین)</label>
                    </div>
                    <div class="radio-item">
                        <input type="radio" id="sortTitleAsc" name="sortOption" value="title-asc" aria-checked="false">
                        <label for="sortTitleAsc">عنوان (الفبا)</label>
                    </div>
                    <div class="radio-item">
                        <input type="radio" id="sortSizeDesc" name="sortOption" value="size-desc" aria-checked="false">
                        <label for="sortSizeDesc">اندازه (بزرگترین)</label>
                    </div>
                </div>
                <button class="m3-button m3-button-filled mt-4" onclick="applySortSettings()">اعمال مرتب‌سازی</button>
            </div>
        </div>

        <footer class="text-center mt-12 text-gray-600 text-sm">
            <p>&copy; 2024 ویکی لینوکس فارسی. تمامی حقوق محفوظ است.</p>
            <div class="flex justify-center gap-4 mt-2">
                <button class="m3-button m3-button-text" onclick="openModal('aboutModal')">درباره ما</button>
                <button class="m3-button m3-button-text" onclick="openModal('helpModal')">راهنما</button>
                <a href="https://github.com/linuxpersian" target="_blank" class="m3-button m3-button-text">گیت‌هاب</a>
            </div>
        </footer>
    </div>

    <button id="scrollToTopBtn" title="برو بالا" aria-label="بازگشت به بالا">⬆️</button>

    <script>
        let allFiles = [];
        let filteredFiles = [];
        let currentPage = 1;
        let filesPerPage = 12;
        let searchQuery = '';
        let currentSort = 'date-desc';
        let currentViewMode = 'grid';
        let isDarkMode = false;

        const GITHUB_API_BASE = 'https://api.github.com/repos/linuxpersian/linuxpersian.github.io/contents/wiki/source';
        const GITHUB_RAW_BASE = 'https://raw.githubusercontent.com/linuxpersian/linuxpersian.github.io/main/wiki/source';

        async function init() {
            console.log('Initializing app...');
            initializePreferences();
            displayLoadingSkeletons();
            await loadFilesFromGitHub();
            applySortAndFilter();
            setupEventListeners();
            updateFileCount();
        }

        function initializePreferences() {
            const savedFilesPerPage = parseInt(sessionStorage.getItem('filesPerPage'), 10);
            if (!isNaN(savedFilesPerPage) && savedFilesPerPage > 0) {
                filesPerPage = savedFilesPerPage;
            }
            const savedSort = sessionStorage.getItem('currentSort');
            if (savedSort) {
                currentSort = savedSort;
                const sortLabel = document.getElementById('sortSettingsModalTitle');
                if (sortLabel) {
                    const sortOptions = {
                        'date-desc': 'تاریخ (جدیدترین)',
                        'date-asc': 'تاریخ (قدیمی‌ترین)',
                        'title-asc': 'عنوان (الفبا)',
                        'size-desc': 'اندازه (بزرگترین)'
                    };
                    // This line should not change the modal title based on sort, but rather select the radio button.
                    // The modal title should be static "تنظیمات مرتب‌سازی"
                    // sortLabel.textContent = sortOptions[currentSort] || 'تنظیمات مرتب‌سازی';
                }
            }
            const savedViewMode = sessionStorage.getItem('currentViewMode');
            if (savedViewMode) {
                currentViewMode = savedViewMode;
                document.querySelectorAll('.view-mode-btn').forEach(btn => {
                    btn.classList.remove('active', 'm3-button-filled');
                    btn.classList.add('m3-button-tonal');
                    if (btn.dataset.view === currentViewMode) {
                        btn.classList.add('active', 'm3-button-filled');
                        btn.classList.remove('m3-button-tonal');
                    }
                });
            }
            isDarkMode = sessionStorage.getItem('isDarkMode') === 'true';
            if (isDarkMode) {
                document.body.classList.add('dark-mode');
            } else {
                document.body.classList.remove('dark-mode');
            }
        }

        function displayLoadingSkeletons() {
            const fileGrid = document.getElementById('fileGrid');
            fileGrid.innerHTML = '';
            // Apply the correct view mode class
            fileGrid.classList.remove('grid-view', 'list-view'); // Clear previous view classes
            fileGrid.classList.add(currentViewMode + '-view'); // Apply current view class

            for (let i = 0; i < filesPerPage; i++) {
                const skeletonCardHtml = `
                    <div class="skeleton-card" role="listitem" aria-busy="true">
                        <div class="skeleton-title"></div>
                        <div class="skeleton-meta"></div>
                        <div class="skeleton-preview"></div>
                    </div>
                `;
                fileGrid.insertAdjacentHTML('beforeend', skeletonCardHtml);
            }
        }

        async function loadFilesFromGitHub() {
            console.log('Fetching files from GitHub...');
            try {
                const response = await fetch(GITHUB_API_BASE);
                if (!response.ok) {
                    throw new Error(`خطای HTTP! وضعیت: ${response.status}`);
                }

                const files = await response.json();
                const mdFiles = files.filter(file => file.name.endsWith('.md'));

                const filePromises = mdFiles.map(async (file) => {
                    try {
                        const content = await loadFileContent(file.name);
                        const metadata = extractMetadata(content, file.name);
                        return {
                            name: file.name,
                            ...metadata,
                            lastModified: new Date(file.last_modified || Date.now()).toLocaleDateString('fa-IR'),
                            size: file.size || 0,
                            rawContent: content
                        };
                    } catch (error) {
                        console.error(`خطا در بارگذاری ${file.name}:`, error);
                        showToast(`خطا در بارگذاری فایل: ${file.name}`, 'error');
                        return {
                            name: file.name,
                            title: file.name.replace('.md', '').replace(/-/g, ' '),
                            preview: 'خطا در بارگذاری محتوا',
                            category: 'unknown',
                            lastModified: 'نامشخص',
                            size: file.size || 0,
                            rawContent: ''
                        };
                    }
                });

                const results = await Promise.allSettled(filePromises);
                allFiles = results
                    .filter(result => result.status === 'fulfilled')
                    .map(result => result.value);

                console.log('Files loaded:', allFiles.length, 'files');
                filteredFiles = [...allFiles];
                showToast('فایل‌ها با موفقیت بارگذاری شدند.', 'success');
            } catch (error) {
                console.error('خطا در بارگذاری از گیت‌هاب:', error);
                showError('خطا در بارگذاری فایل‌ها. لطفاً اتصال اینترنت خود را بررسی کرده و دوباره تلاش کنید.');
                showToast('خطا در بارگذاری اصلی فایل‌ها.', 'error');
            }
        }

        async function loadFileContent(fileName) {
            const response = await fetch(`${GITHUB_RAW_BASE}/${fileName}`);
            if (!response.ok) {
                throw new Error(`بارگذاری ${fileName} ناموفق بود.`);
            }
            return await response.text();
        }

        function extractMetadata(content, fileName) {
            let title = fileName.replace('.md', '').replace(/-/g, ' ');
            let preview = '';
            let category = 'general';

            const titleMatch = content.match(/^#\s+(.+)$/m);
            if (titleMatch) {
                title = titleMatch[1].trim();
            }

            const paragraphs = content.split('\n\n');
            for (let para of paragraphs) {
                para = para.trim();
                if (para && !para.startsWith('#') && !para.startsWith('```') && !para.startsWith('-') && !para.startsWith('>') && !para.startsWith('|')) {
                    preview = para.substring(0, 150) + (para.length > 150 ? '...' : '');
                    break;
                }
            }

            const lowerContent = content.toLowerCase();
            const lowerFileName = fileName.toLowerCase();

            if (lowerContent.includes('آرچ') || lowerFileName.includes('arch') || lowerContent.includes('arch linux')) {
                category = 'arch';
            } else if (lowerContent.includes('اوبونتو') || lowerFileName.includes('ubuntu')) {
                category = 'ubuntu';
            } else if (lowerContent.includes('دستور') || lowerFileName.includes('command') || lowerContent.includes('commands')) {
                category = 'command';
            } else if (lowerContent.includes('پیکربندی') || lowerFileName.includes('config') || lowerContent.includes('configuration')) {
                category = 'config';
            } else if (lowerContent.includes('عیب‌یابی') || lowerFileName.includes('troubleshoot') || lowerContent.includes('debugging')) {
                category = 'troubleshoot';
            } else if (lowerContent.includes('امنیت') || lowerFileName.includes('security')) {
                category = 'security';
            } else if (lowerContent.includes('شبکه') || lowerFileName.includes('network')) {
                category = 'network';
            } else if (lowerContent.includes('نصب') || lowerFileName.includes('install')) {
                category = 'installation';
            } else if (lowerContent.includes('مدیریت بسته') || lowerFileName.includes('package-management')) {
                category = 'package-management';
            } else {
                category = 'general';
            }

            return { title, preview, category };
        }

        function displayFiles() {
            const startIndex = (currentPage - 1) * filesPerPage;
            const endIndex = startIndex + filesPerPage;
            const filesToShow = filteredFiles.slice(startIndex, endIndex);

            const fileGrid = document.getElementById('fileGrid');
            fileGrid.innerHTML = '';
            // Apply view mode specific classes
            fileGrid.classList.remove('grid-view', 'list-view'); // Clear previous view classes
            fileGrid.classList.add(currentViewMode + '-view'); // Apply current view class

            console.log('Displaying files. Current page:', currentPage, 'Files to show:', filesToShow.length);

            if (filesToShow.length === 0) {
                console.log('No files to display.');
                fileGrid.innerHTML = '<div class="no-results text-center py-10 text-gray-600 text-lg">هیچ فایلی پیدا نشد.</div>';
            } else {
                filesToShow.forEach((file, index) => {
                    // Add 'animate' class to trigger the fadeInUp animation
                    const cardHtml = `
                        <div class="file-card ${currentViewMode === 'list' ? 'list-view' : ''} animate" onclick="openFile('${file.name}')" style="animation-delay: ${index * 0.05}s;" role="listitem" aria-label="فایل ${file.title}">
                            <div class="file-icon ${currentViewMode === 'list' ? 'flex-shrink-0 w-14 h-14 rounded-xl flex items-center justify-center text-3xl' : 'hidden'}" style="background-color: var(--md-sys-color-primary-container); color: var(--md-sys-color-on-primary-container);">
                                📄
                            </div>
                            <div class="file-content ${currentViewMode === 'list' ? 'flex-grow min-w-0' : ''}">
                                <div class="file-title text-xl font-bold" style="color: var(--md-sys-color-on-surface);">${file.title}</div>
                                <div class="file-meta text-sm mb-2 flex flex-wrap gap-x-3" style="color: var(--md-sys-color-on-surface-variant);">
                                    <span class="flex items-center gap-1">
                                        📅 ${file.lastModified}
                                    </span>
                                    <span class="flex items-center gap-1">
                                        🏷️ ${getCategoryName(file.category)}
                                    </span>
                                    <span class="flex items-center gap-1">
                                        📏 ${formatFileSize(file.size)}
                                    </span>
                                </div>
                                <div class="file-preview line-clamp-3" style="color: var(--md-sys-color-on-surface);">${file.preview}</div>
                            </div>
                        </div>
                    `;
                    fileGrid.insertAdjacentHTML('beforeend', cardHtml);
                });
            }

            updatePagination();
        }

        function getCategoryName(category) {
            const names = {
                'arch': 'آرچ لینوکس',
                'ubuntu': 'اوبونتو',
                'command': 'دستورات',
                'config': 'پیکربندی',
                'troubleshoot': 'عیب‌یابی',
                'general': 'عمومی',
                'security': 'امنیت',
                'network': 'شبکه',
                'installation': 'نصب و راه‌اندازی',
                'package-management': 'مدیریت بسته',
                'unknown': 'نامشخص'
            };
            return names[category] || category;
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
        }

        function updatePagination() {
            const totalPages = Math.ceil(filteredFiles.length / filesPerPage);
            const pagination = document.getElementById('pagination');
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const pageInfo = document.getElementById('pageInfo');
            const pageJumpInput = document.getElementById('pageJumpInput');

            if (totalPages <= 1) {
                pagination.style.display = 'none';
            } else {
                pagination.style.display = 'flex';
                prevBtn.disabled = currentPage === 1;
                nextBtn.disabled = currentPage === totalPages;
                pageInfo.textContent = `صفحه ${currentPage} از ${totalPages}`;
                pageJumpInput.max = totalPages;
                pageJumpInput.value = currentPage;
            }
        }

        function changePage(direction) {
            const totalPages = Math.ceil(filteredFiles.length / filesPerPage);

            if (direction === 'prev' && currentPage > 1) {
                currentPage--;
            } else if (direction === 'next' && currentPage < totalPages) {
                currentPage++;
            } else if (typeof direction === 'number') {
                if (direction >= 1 && direction <= totalPages) {
                    currentPage = direction;
                } else {
                    showToast('شماره صفحه نامعتبر است.', 'error');
                    return;
                }
            }

            displayFiles();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function handlePageJump(event) {
            if (event.key === 'Enter') {
                const pageNumber = parseInt(event.target.value, 10);
                changePage(pageNumber);
            }
        }

        function performSearch() {
            searchQuery = document.getElementById('searchInput').value.toLowerCase().trim();
            currentPage = 1;
            if (searchQuery.length > 0) {
                document.getElementById('clearSearchBtn').style.display = 'inline-block';
            } else {
                document.getElementById('clearSearchBtn').style.display = 'none';
            }
            applySortAndFilter();
        }

        function clearSearch() {
            document.getElementById('searchInput').value = '';
            performSearch();
        }

        function applySortAndFilter() {
            console.log('Applying sort and filter. Search query:', searchQuery, 'Sort:', currentSort);
            let tempFiles = [...allFiles];

            if (searchQuery !== '') {
                tempFiles = tempFiles.filter(file =>
                    file.title.toLowerCase().includes(searchQuery) ||
                    file.preview.toLowerCase().includes(searchQuery) ||
                    file.name.toLowerCase().includes(searchQuery) ||
                    (file.rawContent && file.rawContent.toLowerCase().includes(searchQuery))
                );
            }

            tempFiles.sort((a, b) => {
                switch (currentSort) {
                    case 'date-desc':
                        return new Date(b.lastModified).getTime() - new Date(a.lastModified).getTime();
                    case 'date-asc':
                        return new Date(a.lastModified).getTime() - new Date(b.lastModified).getTime();
                    case 'title-asc':
                        return a.title.localeCompare(b.title, 'fa', { sensitivity: 'base' });
                    case 'size-desc':
                        return b.size - a.size;
                    default:
                        return 0;
                }
            });

            filteredFiles = tempFiles;
            console.log('Filtered files count:', filteredFiles.length);
            displayFiles();
            updateFileCount();
            updatePagination();
        }

        function updateFileCount() {
            const count = filteredFiles.length;
            document.getElementById('fileCount').textContent = `(${count} فایل)`;
        }

        function openFile(fileName) {
            window.location.href = `viewer.html?file=${encodeURIComponent(fileName)}`;
        }

        function showError(message) {
            document.getElementById('fileGrid').innerHTML =
                `<div class="error text-center py-10 text-red-600 text-lg font-semibold">خطا: ${message}</div>`;
        }

        function setupEventListeners() {
            document.getElementById('searchInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    performSearch();
                }
            });

            document.getElementById('searchInput').addEventListener('input', function() {
                if (this.value.length > 0) {
                    document.getElementById('clearSearchBtn').style.display = 'inline-block';
                } else {
                    document.getElementById('clearSearchBtn').style.display = 'none';
                }
            });

            document.querySelectorAll('.view-mode-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.view-mode-btn').forEach(b => {
                        b.classList.remove('active', 'm3-button-filled');
                        b.classList.add('m3-button-tonal');
                    });
                    this.classList.add('active', 'm3-button-filled');
                    this.classList.remove('m3-button-tonal');
                    currentViewMode = this.dataset.view;
                    sessionStorage.setItem('currentViewMode', currentViewMode); // Save view mode to session storage
                    displayFiles();
                    showToast(`حالت نمایش به ${this.textContent.trim()} تغییر یافت.`, 'info');
                });
            });

            window.addEventListener('scroll', function() {
                const scrollToTopBtn = document.getElementById('scrollToTopBtn');
                if (document.body.scrollTop > 300 || document.documentElement.scrollTop > 300) {
                    scrollToTopBtn.style.display = 'flex';
                } else {
                    scrollToTopBtn.style.display = 'none';
                }
            });

            document.getElementById('scrollToTopBtn').addEventListener('click', function() {
                window.scrollTo({ top: 0, behavior: 'smooth' });
                showToast('به بالای صفحه رفتید.', 'info');
            });

            document.getElementById('settingsDarkModeToggle').addEventListener('change', function() {
                isDarkMode = this.checked;
                document.body.classList.toggle('dark-mode', isDarkMode);
                sessionStorage.setItem('isDarkMode', isDarkMode);
                // Toast message for dark mode change is now handled by applySettings
            });

            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    closeAllModals();
                }
            });
        }

        function openModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.style.display = 'flex';
            modal.setAttribute('aria-hidden', 'false');
            // Using setTimeout to ensure the modal is displayed before attempting to focus
            setTimeout(() => {
                modal.focus();
            }, 0);


            if (modalId === 'settingsModal') {
                document.getElementById('settingsFilesPerPage').value = filesPerPage;
                document.getElementById('settingsDarkModeToggle').checked = isDarkMode;
            } else if (modalId === 'sortSettingsModal') {
                const currentSortRadio = document.querySelector(`input[name="sortOption"][value="${currentSort}"]`);
                if (currentSortRadio) {
                    currentSortRadio.checked = true;
                    // No need to set aria-checked here, browser handles it on 'checked' property change.
                }
            }
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            modal.style.display = 'none';
            modal.setAttribute('aria-hidden', 'true');
        }

        function closeAllModals() {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                modal.style.display = 'none';
                modal.setAttribute('aria-hidden', 'true');
            });
        }

        function applySettings() {
            const newFilesPerPage = parseInt(document.getElementById('settingsFilesPerPage').value, 10);
            const newIsDarkMode = document.getElementById('settingsDarkModeToggle').checked;

            if (newFilesPerPage > 0 && newFilesPerPage !== filesPerPage) {
                filesPerPage = newFilesPerPage;
                sessionStorage.setItem('filesPerPage', filesPerPage);
                currentPage = 1;
                applySortAndFilter();
                showToast(`تعداد فایل در هر صفحه به ${filesPerPage} تغییر یافت.`, 'success');
            }

            if (newIsDarkMode !== isDarkMode) {
                isDarkMode = newIsDarkMode;
                document.body.classList.toggle('dark-mode', isDarkMode);
                sessionStorage.setItem('isDarkMode', isDarkMode);
                showToast(`حالت تاریک ${isDarkMode ? 'فعال' : 'غیرفعال'} شد.`, 'info');
            }

            closeModal('settingsModal');
        }

        function openSortSettingsModal() {
            openModal('sortSettingsModal');
        }

        function applySortSettings() {
            const selectedSortOption = document.querySelector('input[name="sortOption"]:checked');
            if (selectedSortOption) {
                const newSort = selectedSortOption.value;
                if (newSort !== currentSort) {
                    currentSort = newSort;
                    sessionStorage.setItem('currentSort', currentSort);
                    currentPage = 1;
                    applySortAndFilter();
                    showToast('مرتب‌سازی اعمال شد.', 'success');
                }
            }
            closeModal('sortSettingsModal');
        }

        function showToast(message, type = 'info') {
            const toastContainer = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.textContent = message;
            toast.setAttribute('role', 'status');
            toast.setAttribute('aria-live', 'polite');

            toastContainer.appendChild(toast);

            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>

